!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cornerstone-tools",[],t):"object"==typeof exports?exports["cornerstone-tools"]=t():e.cornerstoneTools=t()}(window,function(){var _Mathround=Math.round,_Mathabs=Math.abs;return function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(e,t){for(var n=0,a;n<t.length;n++){a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}e.exports=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}},function(e,t,n){var a=n(20);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var a=n(6),o=n(1);e.exports=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?o(e):t}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=a=function(e){return n(e)}:e.exports=a=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},a(t)}e.exports=a},function(e,t,n){var a=n(16),o=n(15),i=n(14);e.exports=function(e){return a(e)||o(e)||i()}},function(e,t,n){(function(a){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let a=0,o=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&"%c"===e&&(o=++a)}),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==a&&"env"in a&&(e=a.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(18)(t);const{formatters:o}=e.exports;o.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(19))},function(e,t,n){e.exports=n(13)},function(e,t){function n(e,t,n,a,o,i,r){try{var s=e[i](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,o)}e.exports=function(e){return function(){var t=this,a=arguments;return new Promise(function(o,i){var r=e.apply(t,a);function s(e){n(r,o,i,s,l,"next",e)}function l(e){n(r,o,i,s,l,"throw",e)}s(void 0)})}}},function(e,t,n){"use strict";var _NumberMAX_VALUE=Number.MAX_VALUE,_Mathsqrt=Math.sqrt,_StringfromCharCode=String.fromCharCode,_Mathacos=Math.acos,_Mathpow=Math.pow,_Mathsin=Math.sin,_Mathcos=Math.cos,_MathPI=Math.PI,_Mathfloor=Math.floor,_Mathmin=Math.min,_Mathmax=Math.max;n.r(t);var a={};n.d(a,"angleCursor",function(){return Tt}),n.d(a,"arrowAnnotateCursor",function(){return Ct}),n.d(a,"bidirectionalCursor",function(){return bt}),n.d(a,"cobbAngleCursor",function(){return Et}),n.d(a,"ellipticalRoiCursor",function(){return Mt}),n.d(a,"freehandMouseCursor",function(){return wt}),n.d(a,"freehandSculpterMouseCursor",function(){return kt}),n.d(a,"lengthCursor",function(){return It}),n.d(a,"probeCursor",function(){return _t}),n.d(a,"rectangleRoiCursor",function(){return St}),n.d(a,"textMarkerCursor",function(){return Pt}),n.d(a,"crosshairsCursor",function(){return Ot}),n.d(a,"eraserCursor",function(){return Dt}),n.d(a,"magnifyCursor",function(){return Lt}),n.d(a,"panCursor",function(){return At}),n.d(a,"rotateCursor",function(){return Rt}),n.d(a,"stackScrollCursor",function(){return Ht}),n.d(a,"wwwcRegionCursor",function(){return Ut}),n.d(a,"wwwcCursor",function(){return Nt}),n.d(a,"zoomCursor",function(){return Bt});var o=n(0),i=n.n(o),r=n(2),s=n.n(r),l=n(5),c=n.n(l),u=n(4),d=n.n(u),h=n(3),v=n.n(h),g=window.cornerstone,f=window.cornerstoneMath,m=window.Hammer,p={set cornerstone(e){g=e},get cornerstone(){return g},set cornerstoneMath(e){f=e},get cornerstoneMath(){return f},set Hammer(e){m=e},get Hammer(){return m}},y=n(6),x=n.n(y),T={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll"};function C(e,t){var n,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:a,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,a),e.dispatchEvent(n)}var b={drawColorId:0,radius:10,minRadius:1,maxRadius:50,alpha:.4,renderBrushIfHiddenButActive:!0,hiddenButActiveAlpha:.2,colorMapId:"BrushColorMap",visibleSegmentations:{},imageBitmapCache:{},segmentationMetadata:{}},E={radius:function(e){b.radius=_Mathmin(_Mathmax(e,b.minRadius),b.maxRadius)},brushColorMap:function(e){var t=p.cornerstone.colors.getColormap(b.colorMapId);t.setNumberOfColors(e.length);for(var n=0;n<e.length;n++)t.setColor(n,e[n])},elementVisible:function(e){if(p.cornerstone){var t=p.cornerstone.getEnabledElement(e).uuid,n=p.cornerstone.colors.getColormap(b.colorMapId).getNumberOfColors();b.visibleSegmentations[t]=[];for(var a=0;a<n;a++)b.visibleSegmentations[t].push(!0)}},brushVisibilityForElement:function(e,t){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];b.visibleSegmentations[e]||(b.imageBitmapCache[e]=[]),b.visibleSegmentations[e][t]=n},imageBitmapCacheForElement:function(e,t,n){b.imageBitmapCache[e]||(b.imageBitmapCache[e]=[]),b.imageBitmapCache[e][t]=n},clearImageBitmapCacheForElement:function(e){b.imageBitmapCache[e]=[]},metadata:function(e,t,n){b.segmentationMetadata[e]||(b.segmentationMetadata[e]=[]),b.segmentationMetadata[e][t]=n}},M={state:b,onRegisterCallback:function(){!function(){var e=p.cornerstone.colors.getColormap(b.colorMapId);e.setNumberOfColors(19);for(var t=0;19>t;t++)t<w.length?e.setColor(t,w[t]):e.setColor(t,I())}()},enabledElementCallback:function(e){E.elementVisible(e)},getters:{imageBitmapCacheForElement:function(e){return b.imageBitmapCache[e]?b.imageBitmapCache[e]:null},visibleSegmentationsForElement:function(e){return b.visibleSegmentations[e]?b.visibleSegmentations[e]:null},metadata:function(e,t){if(b.segmentationMetadata[e])return void 0!==t?b.segmentationMetadata[e][t]:b.segmentationMetadata[e]}},setters:E},w=[[230,25,75,255],[60,180,175,255],[255,225,25,255],[0,130,200,255],[245,130,48,255],[145,30,180,255],[70,240,240,255],[240,50,230,255],[210,245,60,255],[250,190,190,255],[0,128,128,255],[230,190,255,255],[170,110,40,255],[255,250,200,255],[128,0,0,255],[170,255,195,255],[128,128,0,255],[255,215,180,255],[0,0,128,255]],k=0;function I(){for(var e=function(){var e=[k];k<w.length-1?(k++,e.push(k)):(k=0,e.push(k));return e}(),t=Math.random(),n=[],a=0;4>a;a++)n.push(_Mathfloor(t*w[e[0]][a]+(1-t)*w[e[1]][a]));return n}var _={iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:"\n    <path stroke=\"ACTIVE_COLOR\" d=\"M8 16L8 0\"></path>\n    <path stroke=\"ACTIVE_COLOR\" d=\"M16 8L0 8\"></path>\n  "},S={globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,activeMultiPartTool:null,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,svgCursorUrl:null},P={mouseTools:function(){return S.tools.filter(function(e){return e.supportedInteractionTypes.includes("Mouse")})},touchTools:function(){return S.tools.filter(function(e){return e.supportedInteractionTypes.includes("Touch")})},enabledElementByUID:function(e){return S.enabledElements.find(function(t){return p.cornerstone.getEnabledElement(t).uuid===e})}},O={brush:M,cursor:{getters:{defaultOptions:function(){return _}},setters:{defaultOptions:function(e){Object.assign(_,e)}}},globalConfiguration:{state:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1,showSVGCursors:!1},setters:{}}},D={modules:O,state:S,getters:P},L=function(e,t){return S.tools.find(function(n){return n.element===e&&n.name===t})},A=O.globalConfiguration;function R(e,t){if(A.state.showSVGCursors){var n=t.getIconWithPointerSVG(),a=t.mousePoint,o=window.URL.createObjectURL(n);e.style.cursor="url('".concat(o,"') ").concat(a,", auto"),S.svgCursorUrl=o}}function H(e){A.state.showSVGCursors&&U(e,"none")}function U(e,t){S.svgCursorUrl&&window.URL.revokeObjectURL(S.svgCursorUrl),S.svgCursorUrl=null,e.style.cursor=t}var N=n(8),B=n.n(N),F=B()("cornerstoneTools"),V=function(e){var t=F.extend(e);return{log:t,warn:t,error:console.error.bind(console)}},q=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"".concat("cornerstoneTools",":*");return B.a.enable(e)},j=function(){return B.a.disable()},z=D.modules.globalConfiguration,W=V("store:setToolMode"),G=function(e,t,n,a){void 0===a&&Array.isArray(n)&&(a=n,n=null);var o=L(e,t);o&&(function(e,t,n,a){t.supportedInteractionTypes.forEach(function(o){if(void 0===a||a.includes(o)){var i=oe[o];i?i(t,e,n):W.warn("Unable to resolve input conflicts for type %s",o)}}),D.state.tools.filter(function(t){return t.element===e&&"active"===t.mode&&0<t.supportedInteractionTypes.length}).forEach(function(t){var n=!1;t.supportedInteractionTypes.forEach(function(e){t.options["is".concat(e,"Active")]&&(n=!0)}),n||(W.log("Setting tool %s's to PASSIVE",t.name),J(e,t.name))})}(e,o,n,a),o.supportedInteractionTypes.forEach(function(e){void 0===a||a.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1}),z.state.showSVGCursors&&o.supportedInteractionTypes.includes("Mouse")&&function(e,t,n){var a;a="number"==typeof t?[t]:t.mouseButtonMask;a.includes(1)&&(n.svgCursor?R(n.element,n.svgCursor):n.hideDefaultCursor?H(e):function(e){U(e,"initial")}(e))}(e,n,o)),ee("active",null,e,t,n)},Y=function(e,t,n){ae("active",e,t,n),D.state.enabledElements.forEach(function(a){G(a,e,t,n)})},X=ee.bind(null,"disabled",null),K=te.bind(null,"disabled",null),Z=ee.bind(null,"enabled",null),$=te.bind(null,"enabled",null),J=ee.bind(null,"passive",T.TOOL_DEACTIVATED),Q=te.bind(null,"passive",T.TOOL_DEACTIVATED);function ee(e,t,n,a,o){var i=L(n,a);i?(o=ie(o),Array.isArray(o.mouseButtonMask)&&0!==o.mouseButtonMask.length&&Array.isArray(i.options.mouseButtonMask)&&(o.mouseButtonMask=o.mouseButtonMask.concat(i.options.mouseButtonMask).reduce(function(e,t){return-1===e.indexOf(t)&&e.push(t),e},[])),i.mode=e,i.mergeOptions(o),i["".concat(e,"Callback")]&&i["".concat(e,"Callback")](n,o),t&&C(n,t,{options:o,toolName:a,type:t})):W.warn("Unable to find tool \"%s\" for enabledElement",a)}function te(e,t,n,a){ae(e,n,a),D.state.enabledElements.forEach(function(o){ee(e,t,o,n,a)})}function ne(e,t,n,a){var o="is".concat(e,"Active"),i=D.state.tools.find(function(e){return e.element===n&&"active"===e.mode&&!0===e.options[o]});i&&(W.log("Setting tool %s's %s to false",i.name,o),i.options[o]=!1)}function ae(e,t,n,a){if(D.modules.globalConfiguration.state.globalToolSyncEnabled){var o={mode:e,args:[t,n]};a&&o.push(a),D.state.globalToolChangeHistory.push(o);50<D.state.globalToolChangeHistory.length&&D.state.globalToolChangeHistory.shift();var i=D.state.globalTools[t];if("active"===e){var r=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var a=[],o=D.state.globalTools[e];if(o){var i=new o.tool(o.configuration);i.supportedInteractionTypes.forEach(function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var o=ie(t).mouseButtonMask;Array.isArray(o)&&0<o.length?o.forEach(function(t){return a.push("".concat(e,"-").concat(t))}):Array.isArray(o)&&0===o.length&&a.push("".concat(e,"-DELETE"))}else"MultiTouch"===e?a.push("".concat(e,"-").concat(i.configuration.touchPointers)):a.push(e)})}return a}(t,n,a);Object.keys(D.state.globalTools).forEach(function(e){var t=D.state.globalTools[e];t.activeBindings=t.activeBindings.filter(function(e){return!r.includes(e)})}),r.some(function(e){return e.includes("Mouse-DELETE")})&&(i.activeBindings=i.activeBindings.filter(function(e){return!e.includes("Mouse")}),r=r.filter(function(e){return!e.includes("Mouse")})),i.activeBindings=i.activeBindings.concat(r)}else i.activeBindings=[]}}var oe={Mouse:function(e,t,n){var a=ie(n).mouseButtonMask;if(Array.isArray(a)&&0<a.length){var o=D.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some(function(e){return a.includes(e)})});o&&(o.options.mouseButtonMask=o.options.mouseButtonMask.filter(function(e){return!a.includes(e)}),0===o.options.mouseButtonMask.length&&(o.options.isMouseActive=!1))}},MouseWheel:ne.bind(void 0,"MouseWheel"),Touch:function(e,t,n){var a=D.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}),o=D.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers});a&&(W.log("Setting tool %s's isTouchActive to false",a.name),a.options.isTouchActive=!1),o&&(W.log("Setting tool %s's isTouchActive to false",o.name),o.options.isMultiTouchActive=!1)},TouchPinch:ne.bind(void 0,"TouchPinch"),TouchRotate:ne.bind(void 0,"TouchRotate"),DoubleTap:ne.bind(void 0,"DoubleTap"),MultiTouch:function(e,t,n){var a,o=D.state.tools.find(function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers});1===e.configuration.touchPointers&&(a=D.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),o&&(W.log("Setting tool %s's isMultiTouchActive to false",o.name),o.options.isMultiTouchActive=!1),a&&(W.log("Setting tool %s's isTouchActive to false",a.name),a.options.isTouchActive=!1)}};function ie(e){if(e!==Object(e)||Array.isArray(e)){if("number"==typeof e){var t=[];t.push(e),e={mouseButtonMask:0===e?[]:t}}else null===e?e={mouseButtonMask:[]}:(W.log("No options provided when changing tool mode"),e={});}else if(0===e.mouseButtonMask||null===e.mouseButtonMask)e.mouseButtonMask=[];else if("number"==typeof e.mouseButtonMask){var n=[];n.push(e.mouseButtonMask),e.mouseButtonMask=n}return e}var re={activeOrDisabledBinaryTool:{passiveCallback:function(e){X(e,this.name)},enabledCallback:function(e){G(e,this.name)}},enabledOrDisabledBinaryTool:{passiveCallback:function(e){X(e,this.name)},activeCallback:function(e){Z(e,this.name)}}},se=V("tools:base:BaseTool"),le=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.name,a=t.strategies,o=t.defaultStrategy,r=t.configuration,s=t.supportedInteractionTypes,l=t.mixins,c=t.svgCursor;i()(this,e),this.name=n,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=s||[],this.strategies=a||{},this.defaultStrategy=o||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,c&&(this.svgCursor=c),this._options={},this._configuration=Object.assign({},r),this.updateOnMouseMove=!1,this.hideDefaultCursor=!1,l&&l.length&&this._applyMixins(l)}return s()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(e){return this.strategies[this.activeStrategy](e,this.configuration)}},{key:"_applyMixins",value:function(e){for(var t=0,n;t<e.length;t++){n=re["".concat(e[t])];"object"===x()(n)?Object.assign(this,n):se.warn("".concat(this.name,": mixin ").concat(re[t]," does not exist."))}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}();function ce(){var e={};return{get:function(t,n){var a=p.cornerstone.getEnabledElement(t);if(a.image&&!1!==e.hasOwnProperty(a.image.imageId)){var o=e[a.image.imageId];if(!1!==o.hasOwnProperty(n))return o[n]}},add:function(t,n,a){var o=p.cornerstone.getEnabledElement(t);if(o.image){!1===e.hasOwnProperty(o.image.imageId)&&(e[o.image.imageId]={});var i=e[o.image.imageId];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(a)}},clear:function(t){var n=p.cornerstone.getEnabledElement(t);n.image&&!1!==e.hasOwnProperty(n.image.imageId)&&delete e[n.image.imageId]},saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var ue=ce();function de(e){var t=p.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=ue),t.toolStateManager}function he(e,t,n){de(e).add(e,t,n),C(e,T.MEASUREMENT_ADDED,{toolType:t,element:e,measurementData:n})}function ve(e,t){return de(e).get(e,t)}function ge(e,t,n){for(var a=de(e).get(e,t),o=-1,i=0;i<a.data.length;i++)a.data[i]===n&&(o=i);-1!==o&&(a.data.splice(o,1),C(e,T.MEASUREMENT_REMOVED,{toolType:t,element:e,measurementData:n}))}function fe(e,t){var n=de(e).get(e,t);void 0!==n&&(n.data=[])}function me(e,t){p.cornerstone.getEnabledElement(e).toolStateManager=t}var pe=function(e,t){if(e.boundingBox)return p.cornerstoneMath.point.insideRect(t,e.boundingBox)},ye=function(e,t,n,a){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return!0}else if(!0===e.hasBoundingBox){if(pe(e,n))return!0}else{var o=p.cornerstone.pixelToCanvas(t,e);if(p.cornerstoneMath.point.distance(o,n)<=a)return!0}return!1},xe=function e(t,n,a,o){var i;if(n){if(Array.isArray(n))for(var r=Object.keys(n),s=0,l;s<r.length;s++){l=n[r[s]];if(l.hasOwnProperty("x")&&l.hasOwnProperty("y")&&ye(l,t,a,o)){i=l;break}}else if("object"===x()(n))for(var c=Object.keys(n),u=0,d;u<c.length;u++){d=c[u];if(Array.isArray(n[d])){if(i=e(t,n[d],a,o))break}else{var h=n[d];if(ye(h,t,a,o)){i=h;break}}}return i}},Te=function(e,t,n,a){a||(a=6);var o=function(e){var t;return Object.keys(e).forEach(function(n){var a=e[n];!0!==a.active||(t=a)}),t}(t),i=xe(e,t,n,a);return o!==i&&(void 0!==i&&(i.active=!0),void 0!==o&&(o.active=!1),!0)},Ce=function(e,t){var n=e.image,a={left:0,top:0,width:n.width,height:n.height},o=!1;return Object.keys(t).forEach(function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===p.cornerstoneMath.point.insideRect(n,a)&&(o=!0)}),o};function be(e,t,n){return _Mathmin(_Mathmax(t,e),n)}function Ee(e,t){e.x=be(e.x,0,t.width),e.y=be(e.y,0,t.height)}var Me={mouse:[T.MOUSE_DRAG],touch:[T.TOUCH_DRAG]},we={mouse:[T.MOUSE_UP,T.MOUSE_CLICK],touch:[T.TOUCH_END,T.TOUCH_DRAG_END,T.TOUCH_PINCH,T.TOUCH_PRESS,T.TAP]},ke=function(e,t,n,a){var o=e.element,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"mouse";i=Object.assign({deleteIfHandleOutsideImage:S.deleteIfHandleOutsideImage,preventHandleOutsideImage:S.preventHandleOutsideImage},i);var s=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},a=3<arguments.length?arguments[3]:void 0,o=a.detail,i=o.element,r=o.image,s=a.detail.deltaPoints.image,l=s.x,c=s.y;t.active=!0,t.invalidated=!0;for(var u=Object.keys(t.handles),d=0;d<u.length;d++){var h=u[d],v=t.handles[h];!0!==v.movesIndependently&&v.hasOwnProperty("x")&&v.hasOwnProperty("y")&&(v.x+=l,v.y+=c,n.preventHandleOutsideImage&&Ee(v,r))}p.cornerstone.updateImage(i);var g=T.MEASUREMENT_MODIFIED;C(i,g,{toolName:e,element:i,measurementData:t}),a.preventDefault(),a.stopPropagation()}.bind(this,t,n,i),l=function e(a){!function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},a=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0,i=o.dragHandler,r=o.upOrEndHandler,s=5<arguments.length?arguments[5]:void 0,l=s.detail,c=s.detail.element;t.active=!1,t.invalidated=!0,S.isToolLocked=!1,Me[a].forEach(function(e){c.removeEventListener(e,i)}),we[a].forEach(function(e){c.removeEventListener(e,r)}),n.deleteIfHandleOutsideImage&&Ce(l,t.handles)&&ge(c,e,t);"function"==typeof n.doneMovingCallback&&n.doneMovingCallback();p.cornerstone.updateImage(c)}(t,n,i,r,{dragHandler:s,upOrEndHandler:e},a)};n.active=!0,S.isToolLocked=!0,Me[r].forEach(function(e){o.addEventListener(e,s)}),we[r].forEach(function(e){o.addEventListener(e,l)})},Ie={value:!1},_e={mouse:[T.MOUSE_DRAG],touch:[T.TOUCH_DRAG]},Se={mouse:[T.MOUSE_UP,T.MOUSE_CLICK],touch:[T.TOUCH_END,T.TOUCH_DRAG_END,T.TOUCH_PINCH,T.TOUCH_PRESS,T.TAP]},Pe=function(e,t,n,a){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"mouse";o=Object.assign({deleteIfHandleOutsideImage:S.deleteIfHandleOutsideImage,preventHandleOutsideImage:S.preventHandleOutsideImage},o);var r=e.element,s=function(e,t,n,a,o,i){var r=i.detail,s=r.image,l=r.currentPoints,c=r.element,u=l.page,d=p.cornerstone.pageToPixel(c,u.x,"touch"===o?u.y+-57:u.y);Ie.value=!1,n.active=!0,n.hasMoved=!0,n.x=d.x,n.y=d.y,t.invalidated=!0,a.preventHandleOutsideImage&&Ee(n,s);p.cornerstone.updateImage(c);var h=T.MEASUREMENT_MODIFIED;C(c,h,{toolName:e,element:c,measurementData:t})}.bind(this,t,n,a,o,i),l=function r(l){!function(e,t,n,a){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},i=5<arguments.length?arguments[5]:void 0,r=6<arguments.length?arguments[6]:void 0,s=r.dragHandler,l=r.upOrEndHandler,c=7<arguments.length?arguments[7]:void 0,u=t.currentPoints.image,d=c.detail.element;a.active=!1,n.active=!1,n.invalidated=!0,S.isToolLocked=!1,Ie.value=!1,_e[i].forEach(function(e){d.removeEventListener(e,s)}),Se[i].forEach(function(e){d.removeEventListener(e,l)}),o.deleteIfHandleOutsideImage&&Ce(t,n.handles)&&ge(d,e,n);c.type===T.TOUCH_PRESS&&(c.detail.handlePressed=n,a.x=u.x,a.y=u.y);"function"==typeof o.doneMovingCallback&&o.doneMovingCallback();p.cornerstone.updateImage(d)}(t,e,n,a,o,i,{dragHandler:s,upOrEndHandler:r},l)};if(a.active=!0,n.active=!0,S.isToolLocked=!0,_e[i].forEach(function(e){r.addEventListener(e,s)}),Se[i].forEach(function(e){r.addEventListener(e,l)}),"touch"===i){Ie.value=!0;var c=p.cornerstone.getEnabledElement(r),u={x:e.currentPoints.page.x,y:e.currentPoints.page.y+-57},d=p.cornerstone.pageToPixel(r,u.x,u.y);!function e(t,n,a,o){if(!n.value)return;var i=_Mathabs(t.y-o.y),r=i/10;if(1>i)return t.y=o.y,void(n.value=!1);t.y>o.y?t.y-=r:t.y<o.y&&(t.y+=r);p.cornerstone.updateImage(a.element);p.cornerstone.requestAnimationFrame(function(){e(t,n,a,o)})}(a,Ie,c,d)}},Oe={mouse:[T.MOUSE_MOVE,T.MOUSE_DRAG],touch:[T.TOUCH_DRAG]},De={mouse:[T.MOUSE_UP,T.MOUSE_CLICK],touch:[T.TOUCH_END,T.TOUCH_PINCH,T.TAP]},Le=function(e,t,n,a,o){var i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"mouse";o=Object.assign({deleteIfHandleOutsideImage:S.deleteIfHandleOutsideImage,preventHandleOutsideImage:S.preventHandleOutsideImage},o);var r=e.element;n.active=!0,a.active=!0,S.isToolLocked=!0;var s=function(e,t,n,a,o,i){var r=i.detail,s=r.currentPoints,l=r.image,c=r.element,u=s.page,d=p.cornerstone.pageToPixel(c,"touch"===o?u.x+-57:u.x,"touch"===o?u.y+-57:u.y);t.invalidated=!0,n.active=!0,n.x=d.x,n.y=d.y,a&&a.preventHandleOutsideImage&&Ee(n,l);p.cornerstone.updateImage(c);var h=T.MEASUREMENT_MODIFIED;C(c,h,{toolName:e,element:c,measurementData:t})}.bind(this,t,n,a,o,i),l=function e(r){!function(e,t,n,a,o,i,r){var s=i.moveHandler,l=i.moveEndHandler,c=r.detail,u=c.element,d=c.currentPoints.page,h=p.cornerstone.pageToPixel(u,"touch"===o?d.x+-57:d.x,"touch"===o?d.y+-57:d.y);if(t.active=!1,t.invalidated=!0,n.active=!1,n.x=h.x,n.y=h.y,S.isToolLocked=!1,Oe[o].forEach(function(e){u.removeEventListener(e,s)}),De[o].forEach(function(e){u.removeEventListener(e,l)}),u.removeEventListener(T.TOUCH_START,Ae),r.type===T.TOUCH_PINCH||r.type===T.TOUCH_PRESS)return n.active=!1,p.cornerstone.updateImage(u),void("function"==typeof a.doneMovingCallback&&a.doneMovingCallback());a.preventHandleOutsideImage&&Ee(n,r.detail.image);a.deleteIfHandleOutsideImage&&Ce(r.detail,t.handles)&&ge(u,e,t);"function"==typeof a.doneMovingCallback&&a.doneMovingCallback();p.cornerstone.updateImage(u)}(t,n,a,o,i,{moveHandler:s,moveEndHandler:e},r)};Oe[i].forEach(function(e){r.addEventListener(e,s)}),De[i].forEach(function(e){r.addEventListener(e,l)}),r.addEventListener(T.TOUCH_START,Ae)};function Ae(e){return e.stopImmediatePropagation(),!1}var Re=function(e,t,n,a,o){n.active=!0,S.isToolLocked=!0,Pe(e.detail,t.name,n,a,t.options,o),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},He=function(e,t,n,a){for(var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"mouse",i=0;i<t.data.length;i++){var r=t.data[i],s=xe(e,r.handles,a,"mouse"===o?S.clickProximity:S.touchProximity);if(s)return{handle:s,data:r}}},Ue=function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"mouse",o=Object.assign({},{doneMovingCallback:function(){n.active=!1,S.isToolLocked=!1}},t.options);n.active=!0,S.isToolLocked=!0,ke(e.detail,t.name,n,null,o,a),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},Ne=function(e){function t(e){var n=e.name,a=e.strategies,o=e.defaultStrategy,r=e.configuration,s=e.supportedInteractionTypes,l=e.mixins,u=e.svgCursor;return i()(this,t),c()(this,d()(t).call(this,{name:n,strategies:a,defaultStrategy:o,configuration:r,supportedInteractionTypes:s,mixins:l,svgCursor:u}))}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){3<arguments.length&&void 0!==arguments[3]&&arguments[3];throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,a=t.currentPoints.canvas,o=ve(n,this.name),i=!1,r=0,s;r<o.data.length;r++){s=o.data[r];!0===Te(n,s.handles,a)&&(i=!0);var l=this.pointNearTool(n,s,a)&&!s.active,c=!this.pointNearTool(n,s,a)&&s.active;(l||c)&&(s.active=!s.active,i=!0)}return i}},{key:"handleSelectedCallback",value:function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"mouse";Re(e,this,t,n,a)}},{key:"toolSelectedCallback",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"mouse";Ue(e,this,t,n)}}]),t}(le),Be=1,Fe=2,Ve={setToolWidth:function(e){Be=e},getToolWidth:function(){return Be},setActiveWidth:function(e){Fe=e},getActiveWidth:function(){return Fe}},qe="white",je="greenyellow",ze="transparent",We={setFillColor:function(e){ze=e},getFillColor:function(){return ze},setToolColor:function(e){qe=e},getToolColor:function(){return qe},setActiveColor:function(e){je=e},getActiveColor:function(){return je},getColorIfActive:function(e){return e.color?e.color:e.active?je:qe}},Ge=function(e,t){e.save(),t(e),e.restore()},Ye=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0,a=t.color,o=t.lineWidth,i=t.fillStyle,r=t.lineDash;e.beginPath(),e.strokeStyle=a||e.strokeStyle,e.lineWidth=o||void 0===o&&Ve.getToolWidth()||e.lineWidth,r&&e.setLineDash(r),n(e),i&&(e.fillStyle=i,e.fill()),e.stroke(),r&&e.setLineDash([])};function Xe(e,t,n,a,o){var i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"pixel";Ye(e,o,function(e){"pixel"===i&&(n=p.cornerstone.pixelToCanvas(t,n),a=p.cornerstone.pixelToCanvas(t,a)),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y)})}var Ke=function(e,t,n,a,o){var i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"pixel";Ye(e,o,function(e){"pixel"===i&&(n=p.cornerstone.pixelToCanvas(t,n),a=a.map(function(e){return p.cornerstone.pixelToCanvas(t,e)})),e.moveTo(n.x,n.y),a.forEach(function(t){var n=t.x,a=t.y;e.lineTo(n,a)})})},Ze=function(e,t,n,a,o){var i=Math.atan2(n.y-t.y,n.x-t.x),r={color:a,lineWidth:o};Xe(e,void 0,t,n,r,"canvas"),r={color:a,lineWidth:o,fillStyle:a};var s=[{x:n.x-10*_Mathcos(i-_MathPI/7),y:n.y-10*_Mathsin(i-_MathPI/7)},{x:n.x-10*_Mathcos(i+_MathPI/7),y:n.y-10*_Mathsin(i+_MathPI/7)},n];Ke(e,void 0,n,s,r,"canvas")},$e=function(e,t,n,a,o){"pixel"===(5<arguments.length&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=p.cornerstone.pixelToCanvas(t,n)),Ye(e,o,function(e){e.arc(n.x,n.y,a,0,2*_MathPI)})},Je=function(e,t,n,a,o){"pixel"===(5<arguments.length&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=p.cornerstone.pixelToCanvas(t,n),a=p.cornerstone.pixelToCanvas(t,a));var i=_Mathmin(n.x,a.x),r=_Mathmin(n.y,a.y),s=_Mathabs(n.x-a.x),l=_Mathabs(n.y-a.y),c=.5522848*(s/2),u=.5522848*(l/2),d=i+s,h=r+l,v=i+s/2,g=r+l/2;Ye(e,o,function(e){e.moveTo(i,g),e.bezierCurveTo(i,g-u,v-c,r,v,r),e.bezierCurveTo(v+c,r,d,g-u,d,g),e.bezierCurveTo(d,g+u,v+c,h,v,h),e.bezierCurveTo(v-c,h,i,g+u,i,g),e.closePath()})},Qe=function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=t.element,i=We.getToolColor();e.strokeStyle=a.color||i;for(var r=Object.keys(n),s=function(t){var i=r[t],s=n[i];if(!0===s.drawnIndependently)return"continue";if(!0===a.drawHandlesIfActive&&!s.active)return"continue";var l=s.active?Ve.getActiveWidth():Ve.getToolWidth(),c=a.fill;Ye(e,{lineWidth:l,fillStyle:c},function(e){var t=p.cornerstone.pixelToCanvas(o,s),n=s.radius||a.handleRadius||S.handleRadius;e.arc(t.x,t.y,n,0,2*_MathPI)})},l=0;l<r.length;l++)s(l)},et=function(e,t,n,a,o,i){var r=0<e.length?p.cornerstoneMath.point.findClosestPoint(e,t):t,s=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}];Xe(a,void 0,r,p.cornerstoneMath.point.findClosestPoint(s,r),{color:o,lineWidth:i,lineDash:[2,3]},"canvas")},tt=15,nt="".concat(tt,"px Arial"),at="transparent",ot={setFont:function(e){nt=e},getFont:function(){return nt},setFontSize:function(e){tt=e},getFontSize:function(){return tt},setBackgroundColor:function(e){at=e},getBackgroundColor:function(){return at}},it=function(e,t,n,a,o){var i=ot.getFontSize();e.font=ot.getFont(),e.textBaseline="top",e.fillStyle=a,n.forEach(function(n,a){e.fillText(n,t.left+o,t.top+o+a*(i+o))})},rt=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)};function st(e,t,n){var a=ot.getFont(),o=e.font;a&&a!==o&&(e.font=a);var i=e.measureText(t).width;return a&&a!==o&&(e.font=o),i+2*n}var lt=function(e,t,n,a,o,i){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var r=ot.getFontSize(),s=ot.getBackgroundColor(),l=0;t.forEach(function(t){var n=st(e,t,5);l=_Mathmax(l,n)});var c={width:l,height:5+t.length*(r+5)};return Ge(e,function(e){e.strokeStyle=o,i&&i.centering&&!0===i.centering.x&&(n-=c.width/2),i&&i.centering&&!0===i.centering.y&&(a-=c.height/2),c.left=n,c.top=a;var r=i&&!0===i.debug?"#FF0000":s;rt(e,c,r),it(e,c,t,o,5)}),c},ct=function(e,t,n,a,o,i,r,s,l,c){var u=p.cornerstone,d=u.pixelToCanvas(t,n);l&&(d.x+=l);var h={centering:{x:!1,y:c}};if(n.boundingBox=lt(e,a,d.x,d.y,r,h),n.hasMoved){var v=i(o).map(function(e){return u.pixelToCanvas(t,e)});et(v,d,n.boundingBox,e,r,s)}},ut=function(e,t,n,a,o){if("pixel"===(5<arguments.length&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=p.cornerstone;n=i.pixelToCanvas(t,n),a=i.pixelToCanvas(t,a)}var r=_Mathmin(n.x,a.x),s=_Mathmin(n.y,a.y),l=_Mathabs(n.x-a.x),c=_Mathabs(n.y-a.y);Ye(e,o,function(e){e.rect(r,s,l,c)})},dt=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},ht=function(e,t){return void 0===e?t:e},vt=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=ht(t.shadowColor,"#000000"),e.shadowBlur=ht(t.shadowBlur,0),e.shadowOffsetX=ht(t.shadowOffsetX,1),e.shadowOffsetY=ht(t.shadowOffsetY,1))},gt=function(e,t,n){if(n.vflip||n.vflip||n.rotation){var a={x:t.width/2+n.translation.x*n.scale,y:t.height/2+n.translation.y*n.scale};e.translate(a.x,a.y),n.rotation&&e.rotate(n.rotation*_MathPI/180),n.vflip&&e.scale(1,-1),n.hflip&&e.scale(-1,1),e.translate(-a.x,-a.y)}},ft=function(e){e.setTransform(1,0,0,1,0,0)},mt=function(e,t,n,a){var o=p.cornerstone,i={start:o.pixelToCanvas(e,t),end:o.pixelToCanvas(e,n)};return p.cornerstoneMath.lineSegment.distanceToPoint(i,a)},pt=function(e,t){var n=_Mathpow(10,t);return _Mathround(e*n)/n},yt=O.cursor,xt=function(){function e(t,n){i()(this,e),this.iconGroupString=t,this.options=Object.assign({},yt.getters.defaultOptions(),n)}return s()(e,[{key:"getIconSVG",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconSVGString",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconSVGString(e)}},{key:"getIconWithPointerSVG",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconWithPointerSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconWithPointerString",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconWithPointerSVGString(e)}},{key:"_generateIconWithPointerSVGString",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.mousePointerGroupString,a=t.iconSize,o=t.viewBox,i=a/_Mathmax(o.x,o.y),r=16+a,s="\n        <svg\n        data-icon=\"cursor\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"".concat(r,"\" height=\"").concat(r,"\" viewBox=\"0 0 ").concat(r," ").concat(r,"\"\n      >\n        <g>\n          ").concat(n,"\n        </g>\n        <g transform=\"translate(16, 16) scale(").concat(i,")\">\n          ").concat(this.iconGroupString,"\n        </g>\n      </svg>");return this._injectColors(s,t)}},{key:"_generateIconSVGString",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.iconSize,a=t.viewBox,o="\n      <svg\n        data-icon=\"cursor\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"".concat(n,"\" height=\"").concat(n,"\" viewBox=\"0 0\n        ").concat(a.x," ").concat(a.y,"\"\n      >\n        ").concat(this.iconGroupString,"\n      </svg>");return this._injectColors(o,t)}},{key:"_injectColors",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.activeColor||We.getActiveColor(),a=t.toolColor||We.getToolColor(),o=t.fillColor||We.getFillColor();return e.replace(/ACTIVE_COLOR/g,"".concat(n)).replace(/TOOL_COLOR/g,"".concat(a)).replace(/FILL_COLOR/g,"".concat(o))}},{key:"mousePoint",get:function(){var e=this.options.mousePoint;return"".concat(e.x," ").concat(e.y)}}]),e}(),Tt=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n        10l50 50q10 10 10 23z\"\n      />",{viewBox:{x:1792,y:1792}}),Ct=new xt("<g id=\"arrowAnnotate-group\" fill=\"none\" stroke-width=\"1\" stroke=\"ACTIVE_COLOR\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n    <path id=\"arrowAnnotate-arrow\" d=\"M23,7 l-15,15 M7,17 l0,6 6,0\" stroke-width=\"2\" />\n  </g>",{viewBox:{x:24,y:24}}),bt=new xt("<g fill=\"ACTIVE_COLOR\" stroke-width=\"3\" stroke=\"ACTIVE_COLOR\">\n    <path d=\"M27.63 3.21L3.12 28.81\"></path>\n    <path d=\"M27.63 15.75L15.27 4.43\"></path>\n    <path d=\"M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z\" ></path>\n    <path d=\"M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z\"></path>\n    <path d=\"M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z\"></path>\n    <path d=\"M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z\"></path>\n  </g>",{viewBox:{x:48,y:48}}),Et=new xt("<g stroke=\"ACTIVE_COLOR\" stroke-width=\"3\">\n    <path d=\"M28.59 2.34L3.82 12.32\"></path>\n    <path d=\"M28.59 29.66L3.82 19.68\"></path>\n    <path stroke-dasharray=\"2\" fill-opacity=\"0\" d=\"M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63\">\n    </path>\n  </g>",{viewBox:{x:32,y:32}}),Mt=new xt("<path stroke=\"ACTIVE_COLOR\" fill=\"none\" stroke-width=\"3\" d=\"M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z\"\n    />",{viewBox:{x:32,y:32}}),wt=new xt("\n  <g fill=\"ACTIVE_COLOR\" stroke=\"ACTIVE_COLOR\" stroke-width=\"2\">\n    <ellipse ry=\"1\" rx=\"1\" id=\"svg_3\" cy=\"4.240343\" cx=\"14.306499\"/>\n    <line id=\"svg_4\" y2=\"3.58462\" x2=\"12.242186\" y1=\"3.997482\" x1=\"13.432202\"/>\n    <line id=\"svg_5\" y2=\"3.268901\" x2=\"10.857882\" y1=\"3.608906\" x1=\"12.387902\"/>\n    <line id=\"svg_6\" y2=\"3.147471\" x2=\"9.740724\" y1=\"3.293187\" x1=\"10.955026\"/>\n    <line id=\"svg_7\" y2=\"3.147471\" x2=\"8.089274\" y1=\"3.196043\" x1=\"9.983585\"/>\n    <line id=\"svg_8\" y2=\"3.268901\" x2=\"6.874972\" y1=\"3.123185\" x1=\"8.307848\"/>\n    <line id=\"svg_9\" y2=\"3.657478\" x2=\"5.587812\" y1=\"3.220329\" x1=\"7.020688\"/>\n    <line id=\"svg_10\" y2=\"4.046054\" x2=\"4.737801\" y1=\"3.560334\" x1=\"5.854959\"/>\n    <line id=\"svg_11\" y2=\"4.337487\" x2=\"4.300652\" y1=\"3.997482\" x1=\"4.834945\"/>\n    <line id=\"svg_12\" y2=\"4.726063\" x2=\"3.88779\" y1=\"4.191771\" x1=\"4.470655\"/>\n    <line id=\"svg_15\" y2=\"5.3575\" x2=\"3.377783\" y1=\"4.604633\" x1=\"3.960648\"/>\n    <line id=\"svg_16\" y2=\"6.183226\" x2=\"2.916348\" y1=\"5.138926\" x1=\"3.547785\"/>\n    <line id=\"svg_17\" y2=\"6.960379\" x2=\"2.770632\" y1=\"5.867507\" x1=\"3.037779\"/>\n    <line id=\"svg_18\" y2=\"7.713246\" x2=\"2.673488\" y1=\"6.741804\" x1=\"2.819204\"/>\n    <line id=\"svg_19\" y2=\"8.684687\" x2=\"2.697774\" y1=\"7.616102\" x1=\"2.673488\"/>\n    <line id=\"svg_20\" y2=\"9.753273\" x2=\"2.892062\" y1=\"8.611829\" x1=\"2.697774\"/>\n    <line id=\"svg_21\" y2=\"10.724714\" x2=\"3.134923\" y1=\"9.534698\" x1=\"2.84349\"/>\n    <line id=\"svg_23\" y2=\"11.647583\" x2=\"3.596357\" y1=\"10.578998\" x1=\"3.086351\"/>\n    <line id=\"svg_25\" y2=\"12.521881\" x2=\"4.276366\" y1=\"11.501867\" x1=\"3.499213\"/>\n    <line id=\"svg_26\" y2=\"13.930471\" x2=\"5.830673\" y1=\"12.376165\" x1=\"4.13065\"/>\n    <line id=\"svg_28\" y2=\"14.707624\" x2=\"7.263549\" y1=\"13.881899\" x1=\"5.733528\"/>\n    <line id=\"svg_29\" y2=\"15.339061\" x2=\"8.963571\" y1=\"14.61048\" x1=\"7.06926\"/>\n    <line id=\"svg_30\" y2=\"15.581921\" x2=\"10.882168\" y1=\"15.314775\" x1=\"8.817855\"/>\n    <line id=\"svg_31\" y2=\"15.460491\" x2=\"12.023612\" y1=\"15.581921\" x1=\"10.785024\"/>\n    <line id=\"svg_33\" y2=\"15.120487\" x2=\"13.092197\" y1=\"15.484777\" x1=\"11.877895\"/>\n    <line id=\"svg_34\" y2=\"14.586194\" x2=\"13.86935\" y1=\"15.217631\" x1=\"12.897909\"/>\n    <line id=\"svg_35\" y2=\"13.833327\" x2=\"14.597931\" y1=\"14.756196\" x1=\"13.699348\"/>\n    <line id=\"svg_37\" y2=\"12.716169\" x2=\"15.180796\" y1=\"13.881899\" x1=\"14.549359\"/>\n    <line id=\"svg_39\" y2=\"11.429009\" x2=\"15.520801\" y1=\"12.813313\" x1=\"15.15651\"/>\n    <ellipse ry=\"1\" rx=\"1\" id=\"svg_40\" cy=\"10.967574\" cx=\"15.520801\"/>\n  </g>",{viewBox:{x:18,y:18}}),kt=new xt("<g id=\"icon-freehand-sculpt\" fill=\"none\" stroke-width=\"1.5\" stroke=\"ACTIVE_COLOR\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n      <line id=\"svg_1\" y2=\"2.559367\" x2=\"10.184807\" y1=\"4.467781\" x1=\"8.81711\"/>\n      <line id=\"svg_4\" y2=\"1.493836\" x2=\"11.727442\" y1=\"2.766112\" x1=\"10.089386\"/>\n      <line id=\"svg_7\" y2=\"1.080346\" x2=\"13.047428\" y1=\"1.748291\" x1=\"11.345759\"/>\n      <line id=\"svg_8\" y2=\"1.000829\" x2=\"14.351511\" y1=\"1.112153\" x1=\"12.77707\"/>\n      <line id=\"svg_9\" y2=\"1.350705\" x2=\"15.242104\" y1=\"0.905408\" x1=\"13.969828\"/>\n      <line id=\"svg_10\" y2=\"2.098167\" x2=\"15.862339\" y1=\"1.14396\" x1=\"14.955842\"/>\n      <line id=\"svg_11\" y2=\"3.195505\" x2=\"16.41896\" y1=\"1.939133\" x1=\"15.766918\"/>\n      <line id=\"svg_12\" y2=\"4.292843\" x2=\"16.530284\" y1=\"2.925147\" x1=\"16.387153\"/>\n      <line id=\"svg_16\" y2=\"5.644637\" x2=\"16.196311\" y1=\"3.831643\" x1=\"16.593898\"/>\n      <line id=\"svg_18\" y2=\"7.266789\" x2=\"15.623787\" y1=\"5.19934\" x1=\"16.275829\"/>\n      <line id=\"svg_19\" y2=\"10.813258\" x2=\"14.526449\" y1=\"6.726071\" x1=\"15.766918\"/>\n      <line id=\"svg_20\" y2=\"5.056209\" x2=\"8.085552\" y1=\"4.181519\" x1=\"8.976145\"/>\n      <line id=\"svg_23\" y2=\"5.326568\" x2=\"7.481221\" y1=\"4.78585\" x1=\"8.403621\"/>\n      <line id=\"svg_24\" y2=\"5.565119\" x2=\"6.749662\" y1=\"5.294761\" x1=\"7.624352\"/>\n      <line id=\"svg_25\" y2=\"5.994512\" x2=\"5.429675\" y1=\"5.533312\" x1=\"6.956407\"/>\n      <line id=\"svg_27\" y2=\"6.551133\" x2=\"4.284627\" y1=\"5.962706\" x1=\"5.572807\"/>\n      <line id=\"svg_28\" y2=\"7.584858\" x2=\"3.044158\" y1=\"6.392099\" x1=\"4.427758\"/>\n      <line id=\"svg_29\" y2=\"8.84123\" x2=\"2.185372\" y1=\"7.489437\" x1=\"3.219096\"/>\n      <line id=\"svg_31\" y2=\"10.606513\" x2=\"1.644654\" y1=\"8.602678\" x1=\"2.280792\"/>\n      <line id=\"svg_32\" y2=\"13.214679\" x2=\"1.48562\" y1=\"10.352058\" x1=\"1.724171\"/>\n      <line id=\"svg_33\" y2=\"14.375631\" x2=\"1.676461\" y1=\"12.992031\" x1=\"1.453813\"/>\n      <line id=\"svg_34\" y2=\"15.298031\" x2=\"2.264889\" y1=\"14.152983\" x1=\"1.517427\"/>\n      <line id=\"svg_35\" y2=\"16.172721\" x2=\"3.521261\" y1=\"14.948155\" x1=\"1.915013\"/>\n      <line id=\"svg_36\" y2=\"16.824762\" x2=\"5.207027\" y1=\"15.997783\" x1=\"3.28271\"/>\n      <line id=\"svg_38\" y2=\"17.063314\" x2=\"7.035924\" y1=\"16.745245\" x1=\"4.968475\"/>\n      <line id=\"svg_39\" y2=\"16.888376\" x2=\"9.278311\" y1=\"17.047411\" x1=\"6.733758\"/>\n      <line id=\"svg_40\" y2=\"16.284045\" x2=\"10.661911\" y1=\"16.983797\" x1=\"8.992048\"/>\n      <line id=\"svg_41\" y2=\"15.313934\" x2=\"11.647925\" y1=\"16.395369\" x1=\"10.455166\"/>\n      <line id=\"svg_44\" y2=\"13.898527\" x2=\"12.82478\" y1=\"15.425259\" x1=\"11.504794\"/>\n      <line id=\"svg_45\" y2=\"12.037824\" x2=\"14.144766\" y1=\"14.312017\" x1=\"12.522614\"/>\n      <line id=\"svg_47\" y2=\"10.59061\" x2=\"14.605966\" y1=\"12.228665\" x1=\"13.953925\"/>\n      <ellipse ry=\"1\" rx=\"1\" id=\"svg_48\" cy=\"3.982726\" cx=\"13.460918\"/>\n    </g>",{viewBox:{x:18,y:18}}),It=new xt("<g id=\"length-group\" fill=\"none\" stroke-width=\"1\" stroke=\"ACTIVE_COLOR\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n    <path id=\"length-dashes\" d=\"m22.5,6 -16.5,16.5\" stroke-width=\"3\" stroke-dasharray=\"0.6666,5\" />\n  </g>",{viewBox:{x:24,y:24}}),_t=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z\"\n  />",{viewBox:{x:1792,y:1792}}),St=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z\"\n  />",{viewBox:{x:1792,y:1792}}),Pt=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z\"\n  />",{viewBox:{x:1792,y:1792}}),Ot=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z\"\n  />",{viewBox:{x:1792,y:1792}}),Dt=new xt("<path transform=\"translate(0,1792) scale(1,-1)\" fill=\"ACTIVE_COLOR\" d=\"M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n      0 69.5 20.5t47.5 54.5z\"\n    />",{viewBox:{x:2048,y:1792}}),Lt=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z\"\n    />",{viewBox:{x:512,y:512}}),At=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n      45v448q0 42-39 59-13 5-25 5-26 0-45-19z\"\n    />",{viewBox:{x:1792,y:1792}}),Rt=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n      39 17 39 59z\"\n    />",{viewBox:{x:1792,y:1792}}),Ht=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z\"\n      />",{viewBox:{x:24,y:28}}),Ut=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z\"\n  />",{viewBox:{x:1792,y:1792}}),Nt=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M14.5,3.5 a1 1 0 0 1 -11,11 Z\" stroke=\"none\" opacity=\"0.8\" />\n    <circle cx=\"9\" cy=\"9\" r=\"8\" fill=\"none\" stroke-width=\"2\" stroke=\"ACTIVE_COLOR\" />",{viewBox:{x:18,y:18}}),Bt=new xt("<path fill=\"ACTIVE_COLOR\" d=\"M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z\"\n    />\n    <path fill=\"ACTIVE_COLOR\" transform=\"scale(0.22,0.22) translate(1400,0)\" d=\"M1216\n      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z\"\n    />",{viewBox:{x:640,y:512}}),Ft=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Tt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.preventNewMeasurement=!1,e}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(25>mt(e,t.handles.start,t.handles.middle,n)||25>mt(e,t.handles.middle,t.handles.end,n))}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.enabledElement,o=this.configuration,i=o.handleRadius,r=o.drawHandlesOnHover,s=ve(e.currentTarget,this.name);if(s)for(var l=dt(n.canvasContext.canvas),c=Ve.getToolWidth(),u=function(e){var o=s.data[e];if(!1===o.visible)return"continue";Ge(l,function(e){vt(e,t.configuration);var s=We.getColorIfActive(o),l=p.cornerstone.pixelToCanvas(n.element,o.handles.start),u=p.cornerstone.pixelToCanvas(n.element,o.handles.middle);Ke(e,n.element,o.handles.start,[o.handles.middle,o.handles.end],{color:s});var d={color:s,handleRadius:i,drawHandlesIfActive:r};Qe(e,n,o.handles,d);var v=n.image.columnPixelSpacing||1,g=n.image.rowPixelSpacing||1,f={x:(o.handles.middle.x-o.handles.start.x)*v,y:(o.handles.middle.y-o.handles.start.y)*g},m={x:(o.handles.end.x-o.handles.middle.x)*v,y:(o.handles.end.y-o.handles.middle.y)*g},y={x:(o.handles.end.x-o.handles.start.x)*v,y:(o.handles.end.y-o.handles.start.y)*g},x=Vt(f),T=Vt(m),C=Vt(y),b=_Mathacos((_Mathpow(x,2)+_Mathpow(T,2)-_Mathpow(C,2))/(2*x*T));if(b*=180/_MathPI,o.rAngle=pt(b,2),o.rAngle){var E,M=function(e,t,n){var a=t&&n?"":" (isotropic)";return e.rAngle.toString()+_StringfromCharCode(parseInt("00B0",16))+a}(o,n.image.rowPixelSpacing,n.image.columnPixelSpacing);if(!o.handles.textBox.hasMoved){E={x:u.x,y:u.y};var w=st(e,M,5);u.x<l.x?E.x-=15+w+10:E.x+=15;var k=p.cornerstone.internal.getTransform(a);k.invert();var I=k.transformPoint(E.x,E.y);o.handles.textBox.x=I.x,o.handles.textBox.y=I.y}ct(e,n.element,o.handles.textBox,M,o.handles,h,s,c,0,!0)}})},d=0;d<s.data.length;d++)u(d);function h(e){return[e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var a=e.detail,o=this.createNewMeasurement(a),i=e.detail.element;he(i,this.name,o),p.cornerstone.updateImage(i);var r=Object.assign({},{doneMovingCallback:function(){o.active=!1,n.preventNewMeasurement=!1,p.cornerstone.updateImage(i)}},this.options),s=Object.assign({},{doneMovingCallback:function(){o.active=!1,o.handles.end.active=!0,p.cornerstone.updateImage(i),Le(a,n.name,o,o.handles.end,r,t)}},this.options);Le(a,this.name,o,o.handles.middle,s,t)}}}]),t}(Ne);function Vt(e){return _Mathsqrt(_Mathpow(e.x,2)+_Mathpow(e.y,2))}var qt=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:jt,changeTextCallback:zt,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0},svgCursor:Ct},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.preventNewMeasurement=!1,e}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&25>mt(e,t.handles.start,t.handles.end,n)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.element,o=n.enabledElement,i=this.configuration,r=i.handleRadius,s=i.drawHandlesOnHover,l=ve(a,this.name);if(l)for(var c=e.detail.canvasContext.canvas,u=dt(c),d=Ve.getToolWidth(),h=function(n){var i=l.data[n];if(!1===i.visible)return"continue";Ge(u,function(n){vt(n,t.configuration);var l=We.getColorIfActive(i),c=p.cornerstone.pixelToCanvas(a,i.handles.start),u=p.cornerstone.pixelToCanvas(a,i.handles.end);t.configuration.arrowFirst?Ze(n,u,c,l,d):Ze(n,c,u,l,d);var h={color:l,handleRadius:r,drawHandlesIfActive:s};t.configuration.drawHandles&&Qe(n,e.detail,i.handles,h);var v=function(e){return e.text}(i);if(v&&""!==v){var f=st(n,v,5),m=ot.getFontSize()+10,y=_Mathmax(f,m)/2+5;if(u.x<c.x&&(y=-y),!i.handles.textBox.hasMoved){var x;x=t.configuration.arrowFirst?{x:u.x-f/2+y,y:u.y-m/2}:{x:c.x-f/2-y,y:c.y-m/2};var T=p.cornerstone.internal.getTransform(o);T.invert();var C=T.transformPoint(x.x,x.y);i.handles.textBox.x=C.x,i.handles.textBox.y=C.y}ct(n,a,i.handles.textBox,v,i.handles,g,l,d,0,!1)}})},v=0;v<l.data.length;v++)h(v);function g(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,a=e.detail.element,o=this.createNewMeasurement(e);he(a,this.name,o),p.cornerstone.updateImage(a);var i=Object.assign({},{doneMovingCallback:function(){void 0===o.text&&n.configuration.getTextCallback(function(e){e?o.text=e:ge(a,n.name,o),o.active=!1,p.cornerstone.updateImage(a)}),p.cornerstone.updateImage(a)}},this.options);Le(e.detail,this.name,o,o.handles.end,i,t)}},{key:"doubleClickCallback",value:function(e){if(Array.isArray(this.options.mouseButtonMask)&&this.options.mouseButtonMask.includes(e.detail.buttons))return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,a=ve(t,this.name);if(!a)return!1;for(var o=0,i;o<a.data.length;o++){i=a.data[o];if(this.pointNearTool(t,i,n)||pe(i.handles.textBox,n))return i.active=!0,p.cornerstone.updateImage(t),this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,t,i)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,a){!0===a?ge(e,this.name,t):t.text=n,t.active=!1,p.cornerstone.updateImage(e)}}]),t}(Ne);function jt(e){e(prompt("Enter your annotation:"))}function zt(e,t,n){n(prompt("Change your annotation:"))}var Wt=n(1),Gt=n.n(Wt),Yt=function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},a)},Xt=function(e){var t=e.currentPoints.image,n=t.x,a=t.y;return{toolType:this.name,isCreating:!0,visible:!0,active:!0,handles:{start:Yt(n,a,0),end:Yt(n,a,1,{active:!0}),perpendicularStart:Yt(n,a,2,{locked:!0}),perpendicularEnd:Yt(n,a,3),textBox:Yt(n-50,a-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}},Kt=function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"mouse",o=p.cornerstone,i=p.cornerstoneMath,r=t.handles,s={start:o.pixelToCanvas(e,r.start),end:o.pixelToCanvas(e,r.end)},l=i.lineSegment.distanceToPoint(s,n);if(pe(r.textBox,n))return!0;var c="mouse"===a?S.clickProximity:S.touchProximity;return!!function(e,t,n,a){var o=p.cornerstone,i=p.cornerstoneMath,r={start:o.pixelToCanvas(e,t.perpendicularStart),end:o.pixelToCanvas(e,t.perpendicularEnd)};return i.lineSegment.distanceToPoint(r,n)<a}(e,r,n,c)||l<c},Zt=n(7),$t=n.n(Zt);function Jt(e,t){var n=e.image,a=n.rowPixelSpacing,o=n.columnPixelSpacing,i=t.handles,r=i.start,s=i.end,l=i.perpendicularStart,c=i.perpendicularEnd,u=(r.x-s.x)*(o||1),d=(r.y-s.y)*(a||1),h=_Mathsqrt(u*u+d*d),v=(l.x-c.x)*(o||1),g=(l.y-c.y)*(a||1),f=_Mathsqrt(v*v+g*g);if(f||(f=0),f>h){var m=h;h=f,f=m}t.longestDiameter=h.toFixed(1),t.shortestDiameter=f.toFixed(1)}var Qt,en=function(e){var t=this,n=e.detail,a=n.element,o=n.canvasContext,i=n.image,r=this.configuration,s=r.handleRadius,l=r.drawHandlesOnHover,c=ve(a,this.name);if(c){var u=p.cornerstone.metaData.get("imagePlaneModule",i.imageId),d=i.rowPixelSpacing,h=i.columnPixelSpacing;if(u&&(d=u.rowPixelSpacing||u.rowImagePixelSpacing,h=u.columnPixelSpacing||u.colImagePixelSpacing),d&&h)for(var v,g=dt(o.canvas),f=We.getActiveColor(),m=Ve.getToolWidth(),y=function(e){var o=c.data[e];if(!1===o.visible)return"continue";v=o.active?f:We.getToolColor(),Jt(n,o),Ge(g,function(e){vt(e,t.configuration);var i=o.handles,r=i.start,c=i.end,u=i.perpendicularStart,g=i.perpendicularEnd,f=i.textBox;Xe(e,a,r,c,{color:v});var p=m;!function(e,t){if(t.handles.perpendicularStart.locked){var n,a,o,i,r=t.handles,s=r.start,l=r.end;if(s.x===l.x&&s.y===l.y)n=s.x,a=s.y,o=l.x,i=l.y;else{var c={x:(s.x+l.x)/2,y:(s.y+l.y)/2},u=(s.x-l.x)*(e.image.columnPixelSpacing||1),d=(s.y-l.y)*(e.image.rowPixelSpacing||1),h=_Mathsqrt(u*u+d*d),v=(s.x-l.x)/h,g=(s.y-l.y)/h,f=h/2;n=c.x+f/2*g,a=c.y-f/2*v,o=c.x-f/2*g,i=c.y+f/2*v}t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=a,t.handles.perpendicularEnd.x=o,t.handles.perpendicularEnd.y=i}}(n,o),Xe(e,a,u,g,{color:v,strokeWidth:p});var y={color:v,handleRadius:s,drawHandlesIfActive:l};Qe(e,n,o.handles,y);var x=tn(o,d,h);ct(e,a,f,x,o.handles,function(e){return[e.start,e.end,e.perpendicularStart,e.perpendicularEnd]},v,m,10,!0)})},x=0;x<c.data.length;x++)y(x)}},tn=function(e,t,n){var a=" mm";t&&n||(a=" pixels");var o=" L ".concat(e.longestDiameter).concat(a),i=" W ".concat(e.shortestDiameter).concat(a),r=e.labels;return r&&Array.isArray(r)?[].concat($t()(r),[o,i]):[o,i]},nn=function(e,t){var n=this,a=e.detail,o=a.element,i=a.image,r=this.configuration;if(!an(i)){var s=this.createNewMeasurement(a),l=function(){s.active=!1,p.cornerstone.updateImage(o)};he(o,this.name,s),p.cornerstone.updateImage(o);var c=new Date().getTime(),u=s.handles,d=u.end,h=u.perpendicularStart;Le(a,this.name,s,d,{doneMovingCallback:function(){var e=s.handles,t=s.longestDiameter,i=s.shortestDiameter,u=Ce(a,e),d=parseFloat(t)||0,v=parseFloat(i)||0,g=1>d||1>v,f=150>new Date().getTime()-c;u||g||f?(s.cancelled=!0,ge(o,n.name,s)):r.getMeasurementLocationCallback(s,a,l),h.locked=!1,p.cornerstone.updateImage(o);var m={toolType:n.name,element:o,measurementData:s};Jt(a,s),p.cornerstone.triggerEvent(o,T.MEASUREMENT_MODIFIED,m)}},t)}},an=function(e){var t=p.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,a=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,a=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!a},on={setCoords:function(e){Qt=e.currentPoints.canvas},getCoords:function(){return Qt}},rn=function(e){var t=this,n=e.detail,a=n.element;on.setCoords(n);var o=ve(a,this.name);if(o){for(var i=!1,r=function(e){var r=n.currentPoints.canvas,s=o.data[e],l=function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:6,o=xe(e,t,n,a),i=!1;return Object.keys(t).forEach(function(e){if("textBox"!==e){var n=t[e],a=n===o;n.active!==a&&(i=!0),n.active=a}}),i}(a,s.handles,r);Object.keys(s.handles).forEach(function(e){if("textBox"!==e){var t=s.handles[e];t.hover=t.active}}),l&&(i=!0);var c=t.pointNearTool(a,s,r,"mouse"),u=c&&!s.active,d=!c&&s.active;(u||d)&&(s.active=!s.active,i=!0)},s=0;s<o.data.length;s++)r(s);!0===i&&p.cornerstone.updateImage(a)}},sn=function(e,t,n){"touch"===(3<arguments.length&&void 0!==arguments[3]?arguments[3]:"mouse")?this.handleSelectedTouchCallback(e):this.handleSelectedMouseCallback(e)},ln=function(e,t,n,a){var o,i,r,s,l={},c={},u={x:t.currentPoints.image.x+a.x,y:t.currentPoints.image.y+a.y};0===e.index?function(e,t){var n=p.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},c={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}},u=p.cornerstoneMath.lineSegment.intersectLine(l,c),d=n(r,u),h=n(s,u),v=n(i,u),g=n(i,e);if(g<=v)return!1;var f=(i.x-e.x)/g,m=(i.y-e.y)/g,y=v/g,x=i.x+(e.x-i.x)*y,T=i.y+(e.y-i.y)*y;return r.x=x-d*m,r.y=T+d*f,s.x=x+h*m,s.y=T-h*f,!0}(u,n)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?function(e,t){var n=p.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},c={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}},u=p.cornerstoneMath.lineSegment.intersectLine(l,c),d=n(r,u),h=n(s,u),v=n(o,u),g=n(o,e);if(g<=v)return!1;var f=(o.x-e.x)/g,m=(o.y-e.y)/g,y=v/g,x=o.x+(e.x-o.x)*y,T=o.y+(e.y-o.y)*y;return r.x=x+d*m,r.y=T-d*f,s.x=x-h*m,s.y=T+h*f,!0}(u,n)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},c.end={x:u.x,y:u.y},(i=p.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},i=p.cornerstoneMath.lineSegment.intersectLine(l,c),r=p.cornerstoneMath.point.distance(i,n.handles.start),s=p.cornerstoneMath.point.distance(i,n.handles.end),(!i||3>r||3>s)&&(o=!0)),!1,o||function(e,t){var n=p.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l=s,c=p.cornerstoneMath.lineSegment.distanceToPoint(t.handles,l),u=p.cornerstoneMath.lineSegment.distanceToPoint(t.handles,e),d=c+u;if(n(l,e)<=c)return!1;var h=n(o,i);if(0===h)return!1;var v=(o.x-i.x)/h,g=(o.y-i.y)/h,f=o.x-1*v,m=o.y-1*g,y=i.x+1*v,x=i.y+1*g;r.x=e.x,r.y=e.y,s.x=e.x-d*g,s.y=e.y+d*v;var T={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},C={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}};return p.cornerstoneMath.lineSegment.intersectLine(T,C)||(n(e,o)>n(e,i)?(r.x=y+u*g,r.y=x-u*v,s.x=r.x-d*g,s.y=r.y+d*v):(r.x=f+u*g,r.y=m-u*v,s.x=r.x-d*g,s.y=r.y+d*v)),!0}(u,n)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},c.end={x:u.x,y:u.y},(i=p.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},i=p.cornerstoneMath.lineSegment.intersectLine(l,c),r=p.cornerstoneMath.point.distance(i,n.handles.start),s=p.cornerstoneMath.point.distance(i,n.handles.end),(!i||3>r||3>s)&&(o=!0)),!1,o||function(e,t){var n=p.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l=r,c=p.cornerstoneMath.lineSegment.distanceToPoint(t.handles,l),u=p.cornerstoneMath.lineSegment.distanceToPoint(t.handles,e),d=c+u;if(n(l,e)<=c)return!1;var h=n(o,i),v=(o.x-i.x)/h,g=(o.y-i.y)/h,f=o.x-1*v,m=o.y-1*g,y=i.x+1*v,x=i.y+1*g;r.x=e.x+d*g,r.y=e.y-d*v,s.x=e.x,s.y=e.y,s.locked=!1,r.locked=!1;var T={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},C={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}};return p.cornerstoneMath.lineSegment.intersectLine(T,C)||(n(e,o)>n(e,i)?(s.x=y-u*g,s.y=x+u*v,r.x=s.x+d*g,r.y=s.y-d*v):(s.x=f-u*g,s.y=m+u*v,r.x=s.x+d*g,r.y=s.y-d*v)),!0}(u,n)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y))},cn=function(e,t,n){var a=e[n],o=t[n];e[n]=o,t[n]=a},un=function(e,t){cn(e,t,"x"),cn(e,t,"y"),cn(e,t,"moving"),cn(e,t,"hover"),cn(e,t,"active"),cn(e,t,"selected")},dn=function(e){var t,n=this,a=e.detail,o=a.element,i=S.clickProximity,r=function(e){t.invalidated=!0,Ce(a,t.handles)&&ge(o,n.name,t),e&&(e.moving=!1,e.selected=!0),R(n.element,n.svgCursor),p.cornerstone.updateImage(o),o.addEventListener(T.MOUSE_MOVE,n._moveCallback),o.addEventListener(T.TOUCH_START,n._moveCallback)},s=a.startPoints.canvas,l=ve(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,i],d=xe.apply(void 0,u);if(d)return o.removeEventListener(T.MOUSE_MOVE,n._moveCallback),o.removeEventListener(T.TOUCH_START,n._moveCallback),t.active=!0,hn(t.handles),d.moving=!0,(d=function(e,t,n){var a=e.image,o=a.rowPixelSpacing,i=a.columnPixelSpacing,r=t.handles,s=r.start,l=r.end,c=r.perpendicularStart,u=r.perpendicularEnd,d=(s.x-l.x)*(i||1),h=(s.y-l.y)*(o||1),v=_Mathsqrt(d*d+h*h),g=(c.x-u.x)*(i||1),f=(c.y-u.y)*(o||1);return(_Mathsqrt(g*g+f*f)||0)>v?(un(s,l),un(s,c),un(l,u),Object.values(r).find(function(e){return!0===e.moving})):n}(a,t,d)).hasBoundingBox||H(n.element),function(e,t,n,a,o,i){var r=e.element,s={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y},l=function(o){var l=o.detail;a.hasMoved=!0,void 0===a.index||null===a.index?(a.x=l.currentPoints.image.x+s.x,a.y=l.currentPoints.image.y+s.y):ln(a,l,n,s),i&&(a.x=_Mathmax(a.x,0),a.x=_Mathmin(a.x,l.image.width),a.y=_Mathmax(a.y,0),a.y=_Mathmin(a.y,l.image.height)),p.cornerstone.updateImage(r);var c={toolType:t,element:r,measurementData:n};Jt(e,n),p.cornerstone.triggerEvent(r,T.MEASUREMENT_MODIFIED,c)};a.active=!0,S.isToolLocked=!0,r.addEventListener(T.MOUSE_DRAG,l),r.addEventListener(T.TOUCH_DRAG,l);var c=p.cornerstone.getImage(r),u=function(){p.cornerstone.getImage(r).imageId!==c.imageId&&d()};r.addEventListener(p.cornerstone.EVENTS.IMAGE_RENDERED,u);var d=function e(){a.active=!1,S.isToolLocked=!1,r.removeEventListener(p.cornerstone.EVENTS.IMAGE_RENDERED,u),r.removeEventListener(T.MOUSE_DRAG,l),r.removeEventListener(T.MOUSE_UP,e),r.removeEventListener(T.MOUSE_CLICK,e),r.removeEventListener(T.TOUCH_DRAG,l),r.removeEventListener(T.TOUCH_DRAG_END,e),r.removeEventListener(T.TAP,e),p.cornerstone.updateImage(r),"function"==typeof o&&o()};r.addEventListener(T.MOUSE_UP,d),r.addEventListener(T.MOUSE_CLICK,d),r.addEventListener(T.TOUCH_DRAG_END,d),r.addEventListener(T.TAP,d)}(a,n.name,t,d,function(){return r(d)}),gn(e),{v:!0}},u=0,d;u<l.data.length;u++){d=c(u);if("object"===x()(d))return d.v}var h=function(e){return function(){vn(e,!1),r()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"mouse")){o.removeEventListener(T.MOUSE_MOVE,this._moveCallback),o.removeEventListener(T.TOUCH_START,this._moveCallback),t.active=!0,hn(t.handles),vn(t.handles,!0);var v=h(t.handles);return ke(a,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,doneMovingCallback:v},"mouse"),gn(e),!0}}},hn=function(e){var t=!1;return Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)}),t},vn=function(e,t){Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].moving=t)})},gn=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},fn=[T.TOUCH_END,T.TOUCH_DRAG_END,T.TOUCH_PINCH,T.TOUCH_PRESS,T.TAP],mn=function(e){var t,n=this,a=e.detail,o=a.element,i=S.touchProximity,r=function(e){t.invalidated=!0,Ce(a,t.handles)&&ge(o,n.name,t),e&&(e.moving=!1,e.selected=!0),p.cornerstone.updateImage(o),o.addEventListener(T.TOUCH_DRAG,n._moveCallback)},s=a.startPoints.canvas,l=ve(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,i],d=xe.apply(void 0,u);if(d)return o.removeEventListener(T.TOUCH_DRAG,n._moveCallback),t.active=!0,pn(t.handles),d.moving=!0,function(e,t,n,a,o,i){var r=e.element,s={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y},l=function(o){var l=o.detail;a.hasMoved=!0,void 0===a.index||null===a.index?(a.x=l.currentPoints.image.x+s.x,a.y=l.currentPoints.image.y+s.y):ln(a,l,n,s),i&&(a.x=_Mathmax(a.x,0),a.x=_Mathmin(a.x,l.image.width),a.y=_Mathmax(a.y,0),a.y=_Mathmin(a.y,l.image.height)),p.cornerstone.updateImage(r);var c={toolType:t,element:r,measurementData:n};Jt(e,n),p.cornerstone.triggerEvent(r,T.MEASUREMENT_MODIFIED,c)};a.active=!0,S.isToolLocked=!0,r.addEventListener(T.TOUCH_DRAG,l);var c=function e(){a.active=!1,S.isToolLocked=!1,r.removeEventListener(T.TOUCH_DRAG,l),fn.forEach(function(t){r.removeEventListener(t,e)}),p.cornerstone.updateImage(r),"function"==typeof o&&o()};fn.forEach(function(e){r.addEventListener(e,c)})}(a,n.name,t,d,function(){return r(d)}),xn(e),{v:!0}},u=0,d;u<l.data.length;u++){d=c(u);if("object"===x()(d))return d.v}var h=function(e){return function(){yn(e,!1),r()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"touch")){o.removeEventListener(T.TOUCH_DRAG,this._moveCallback),t.active=!0,pn(t.handles),yn(t.handles,!0);var v=h(t.handles);return ke(a,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,doneMovingCallback:v},"touch"),xn(e),!0}}},pn=function(e){var t=!1;return Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)}),t},yn=function(e,t){Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].moving=t)})},xn=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},Tn=function(e,t,n){return n()},Cn=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:Tn,getMeasurementLocationCallback:Tn,textBox:"",shadow:"",drawHandlesOnHover:!0,additionalData:[]},svgCursor:bt},o=Object.assign(a.configuration,n),r=Object.assign(a,{configuration:o});return(e=c()(this,d()(t).call(this,r))).createNewMeasurement=Xt.bind(Gt()(e)),e.pointNearTool=Kt.bind(Gt()(e)),e.renderToolData=en.bind(Gt()(e)),e.addNewMeasurement=nn.bind(Gt()(e)),e._moveCallback=rn.bind(Gt()(e)),e.handleSelectedCallback=sn.bind(Gt()(e)),e.handleSelectedMouseCallback=dn.bind(Gt()(e)),e.handleSelectedTouchCallback=mn.bind(Gt()(e)),e}return v()(t,e),t}(Ne),bn=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Et},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.hasIncomplete=!1,e}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&!this.hasIncomplete&&(25>mt(e,t.handles.start,t.handles.end,n)||25>mt(e,t.handles.start2,t.handles.end2,n))}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=this.configuration,o=a.handleRadius,i=a.drawHandlesOnHover,r=ve(e.currentTarget,this.name);if(r)for(var s=dt(n.canvasContext.canvas),l=Ve.getToolWidth(),c=ot.getFont(),u=function(e){var a=r.data[e];if(!1===a.visible)return"continue";Ge(s,function(e){vt(e,t.configuration);var r=We.getColorIfActive(a);Xe(e,n.element,a.handles.start,a.handles.end,{color:r}),a.complete&&Xe(e,n.element,a.handles.start2,a.handles.end2,{color:r});var s={color:r,handleRadius:o,drawHandlesIfActive:i};Qe(e,n,a.handles,s),e.fillStyle=r;var u=a.value;if(!a.handles.textBox.hasMoved){var d={x:(a.handles.start.x+a.handles.end.x)/2,y:(a.handles.start.y+a.handles.end.y)/2-10};e.font=c,a.handles.textBox.x=d.x,a.handles.textBox.y=d.y}ct(e,n.element,a.handles.textBox,u,a.handles,h,r,l,0,!0)})},d=0;d<r.data.length;d++)u(d);function h(e){return[e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=ve(e,this.name);if(void 0!==t)for(var n=0;n<t.data.length;n++)if(!1===t.data[n].complete)return t.data[n]}},{key:"addNewMeasurement",value:function(e,t){e.preventDefault(),e.stopPropagation();var n,a,o=e.detail,i=e.detail.element,r=this.getIncomplete(i);r?((n=r).complete=!0,n.handles.start2={x:o.currentPoints.image.x,y:o.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},n.handles.end2={x:o.currentPoints.image.x,y:o.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},a=n.handles.end2,this.hasIncomplete=!1):(n=this.createNewMeasurement(o),he(i,this.name,n),a=n.handles.end),p.cornerstone.updateImage(i),Le(o,this.name,n,a,this.options,t)}},{key:"onMeasureModified",value:function(e){var t=p.cornerstone.getEnabledElement(e.detail.element).image;if(e.detail.toolName===this.name){var n=e.detail.measurementData;n.value=function(e,t){var _Mathceil=Math.ceil,n=t.columnPixelSpacing||1,a=t.rowPixelSpacing||1,o=(_Mathceil(e.handles.start.x)-_Mathceil(e.handles.end.x))*n,i=(_Mathceil(e.handles.start.y)-_Mathceil(e.handles.end.y))*a,r=(_Mathceil(e.handles.start2.x)-_Mathceil(e.handles.end2.x))*n,s=(_Mathceil(e.handles.start2.y)-_Mathceil(e.handles.end2.y))*a,l=_Mathacos(_Mathabs((o*r+i*s)/(_Mathsqrt(o*o+i*i)*_Mathsqrt(r*r+s*s))));l*=180/_MathPI;var c=pt(l,2);if(!Number.isNaN(e.rAngle))return function(e,t,n){var a=t&&n?"":" (isotropic)";return e.toString()+_StringfromCharCode(parseInt("00B0",16))+a}(c,t.rowPixelSpacing,t.columnPixelSpacing);return""}(n,t)}}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(T.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(T.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(e){e.removeEventListener(T.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(e){e.removeEventListener(T.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),t}(Ne),En=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=p.cornerstone,o=a.metaData.get("patientStudyModule",e.imageId),i=a.metaData.get("generalSeriesModule",e.imageId);if(o&&i&&"PT"===i.modality){var r=n?t:t*e.slope+e.intercept,s=o.patientWeight;if(s){var l=a.metaData.get("petIsotopeModule",e.imageId);if(l){var c=l.radiopharmaceuticalInfo,u=c.radiopharmaceuticalStartTime,d=c.radionuclideTotalDose,h=c.radionuclideHalfLife,v=i.seriesTime;if(u&&d&&h&&v){var g=Mn(v.fractionalSeconds||0)+v.seconds+60*v.minutes+60*(60*v.hours)-(Mn(u.fractionalSeconds)+u.seconds+60*u.minutes+60*(60*u.hours));return 1e3*(r*s/(d*Math.exp(0.6931471805599453*-g/h)))}}}}};function Mn(e){return parseFloat(".".concat(e))}var wn=function(e,t){var n=e.width/2,a=e.height/2;if(0>=n||0>=a)return!1;var o=e.left+n,i=e.top+a,r=t.x-o,s=t.y-i;return 1>=r*r/(n*n)+s*s/(a*a)},kn=function(e,t){for(var n=0,a=0,o=0,i=0,r=null,s=null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++){wn(t,{x:c,y:l})&&(null===r&&(r=e[i],s=e[i]),n+=e[i],a+=e[i]*e[i],r=_Mathmin(r,e[i]),s=_Mathmax(s,e[i]),o++),i++}if(0===o)return{count:o,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/o,d=a/o-u*u;return{count:o,mean:u,variance:d,stdDev:_Mathsqrt(d),min:r,max:s}},In={calculateEllipseStatistics:kn,pointInEllipse:wn},_n=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},Sn=function(e){var t=x()(e);return null!==e&&("object"===t||"function"===t)},Pn=function(e,t,n){var a,o,i,r,s,l,c=0,u=!1,d=!1,h=!0,v=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var n=a,i=o;return a=o=void 0,c=t,r=e.apply(i,n)}function f(e,t){return v?window.requestAnimationFrame(e):setTimeout(e,t)}function m(e){var n=e-l;return void 0===l||n>=t||0>n||d&&e-c>=i}function p(){var e=Date.now();if(m(e))return y(e);s=f(p,function(e){var n=e-c,a=t-(e-l);return d?_Mathmin(a,i-n):a}(e))}function y(e){return s=void 0,h&&a?g(e):(a=o=void 0,r)}function x(){for(var e=Date.now(),n=m(e),i=arguments.length,h=Array(i),v=0;v<i;v++)h[v]=arguments[v];if(a=h,o=this,l=e,n){if(void 0===s)return function(e){return c=e,s=f(p,t),u?g(e):r}(l);if(d)return s=f(p,t),g(l)}return void 0===s&&(s=f(p,t)),r}return t=+t||0,Sn(n)&&(u=!!n.leading,i=(d="maxWait"in n)?_Mathmax(+n.maxWait||0,t):i,h="trailing"in n?!!n.trailing:h),x.cancel=function(){void 0!==s&&function(e){if(v)return window.cancelAnimationFrame(e);clearTimeout(e)}(s),c=0,a=l=o=s=void 0},x.flush=function(){return void 0===s?r:y(Date.now())},x.pending=function(){return void 0!==s},x},On=function(e,t,n){var a=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Sn(n)&&(a="leading"in n?!!n.leading:a,o="trailing"in n?!!n.trailing:o),Pn(e,t,{leading:a,trailing:o,maxWait:t})},Dn=V("tools:annotation:EllipticalRoiTool"),Ln=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{},svgCursor:Mt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Dn.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,a){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||Dn.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===a?15:25,r=p.cornerstone.pixelToCanvas(e,t.handles.start),s=p.cornerstone.pixelToCanvas(e,t.handles.end),l={left:_Mathmin(r.x,s.x)+i/2,top:_Mathmin(r.y,s.y)+i/2,width:_Mathabs(r.x-s.x)-i,height:_Mathabs(r.y-s.y)-i},c={left:_Mathmin(r.x,s.x)-i/2,top:_Mathmin(r.y,s.y)-i/2,width:_Mathabs(r.x-s.x)+i,height:_Mathabs(r.y-s.y)+i},u=wn(l,n);return!(!wn(c,n)||u)}},{key:"renderToolData",value:function(e){var t=this,n=ve(e.currentTarget,this.name);if(n){var a=e.detail,o=a.image,i=a.element,r=Ve.getToolWidth(),s=this.configuration,l=s.handleRadius,c=s.drawHandlesOnHover,u=dt(a.canvasContext.canvas),d=p.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{},h=p.cornerstone.metaData.get("imagePlaneModule",o.imageId),v=d.modality,g=h&&h.rowPixelSpacing&&h.columnPixelSpacing,f={rowPixelSpacing:(h=h||{}).rowPixelSpacing||1,columnPixelSpacing:h.columnPixelSpacing||1};Ge(u,function(e){for(var s=0,u;s<n.data.length;s++){u=n.data[s];if(!1!==u.visible){var d=We.getColorIfActive(u),h={color:d,handleRadius:l,drawHandlesIfActive:c};vt(e,t.configuration),Je(e,i,u.handles.start,u.handles.end,{color:d}),Qe(e,a,u.handles,h),!0===u.invalidated&&(u.cachedStats?An(o,i,u,v,f):Rn(o,i,u,v,f)),u.handles.textBox.hasMoved||(u.handles.textBox.x=_Mathmax(u.handles.start.x,u.handles.end.x),u.handles.textBox.y=(u.handles.start.y+u.handles.end.y)/2);var m=Hn(e,o.color,u.cachedStats,v,g,t.configuration);ct(e,i,u.handles.textBox,m,u.handles,function(e){return t=e.start,n=e.end,a=Un(t,n),o=a.left,i=a.top,r=a.width,s=a.height,[{x:o+r/2,y:i},{x:o,y:i+s/2},{x:o+r/2,y:i+s},{x:o+r,y:i+s/2}];var t,n,a,o,i,r,s},d,r,0,!0)}}})}}}]),t}(Ne),An=On(Rn,110);function Rn(e,t,n,a,o){var i=function(e,t,n,a,o){var i,r=Un(n.start,n.end),s=p.cornerstone.getPixels(t,r.left,r.top,r.width,r.height),l=kn(s,r);"PT"===a&&(i={mean:En(e,l.mean,!0)||0,stdDev:En(e,l.stdDev,!0)||0});return{area:_MathPI*(r.width*(o.columnPixelSpacing||1)/2)*(r.height*(o.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:i}}(e,t,n.handles,a,o);n.cachedStats=i,n.invalidated=!1}function Hn(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},a=n.area,o=n.mean,i=n.stdDev,r=n.min,s=n.max,l=n.meanStdDevSUV,c=3<arguments.length?arguments[3]:void 0,u=4<arguments.length?arguments[4]:void 0,d=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,v=!1!==d.showHounsfieldUnits,g=[],f=[];if(!t){var m=l&&0!==l.mean,p="CT"===c&&v?" HU":"",y="Mean: ".concat(_n(o.toFixed(2))).concat(p),x="Std Dev: ".concat(_n(i.toFixed(2))).concat(p);if(m){for(var T="".concat(" SUV: ").concat(_n(l.mean.toFixed(2))),C="".concat(" SUV: ").concat(_n(l.stdDev.toFixed(2))),b=_Mathfloor(e.measureText("".concat(x,"     ")).width);e.measureText(y).width<b;)y+=" ";f.push("".concat(y).concat(T)),f.push("".concat(x,"     ").concat(C))}else f.push("".concat(y,"     ").concat(x));if(h){for(var E="Min: ".concat(r).concat(p),M="Max: ".concat(s).concat(p),w=m?_Mathfloor(e.measureText("".concat(x,"     ")).width):_Mathfloor(e.measureText("".concat(y,"     ")).width);e.measureText(E).width<w;)E+=" ";f.push("".concat(E).concat(M))}}return g.push(function(e,t){var n=t?" mm".concat("\xB2"):" px".concat("\xB2");return"Area: ".concat(_n(e.toFixed(2))).concat(n)}(a,u)),f.forEach(function(e){return g.push(e)}),g}function Un(e,t){return{left:_Mathround(_Mathmin(e.x,t.x)),top:_Mathround(_Mathmin(e.y,t.y)),width:_Mathround(_Mathabs(e.x-t.x)),height:_Mathround(_Mathabs(e.y-t.y))}}var Nn=function(e,t){for(var n=!1,a=e.length-1,o=0;o<e.length;o++)Bn(t,e[o],e[a])&&(n=!n),a=o;return n};function Bn(e,t,n){return a=e.y,o=t.y,i=n.y,!(!(o<a&&a<i||i<a&&a<o)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var a=t;t=n,n=a}var o=function(e,t,n){var a=(n.y-t.y)/(n.x-t.x);return{value:t.x+a*(e.x-t.x),gradient:a}}(e,t,n);return Math.sign(o.gradient)*e.y>o.value}(e,t,n));var a,o,i}function Fn(e,t,n,a){Nn(e,t)&&(n.value+=a,n.squared+=a*a,n.count++)}var Vn=function e(t,n){i()(this,e),this.toolIndex=t,this.handleIndexArray=n},qn=function e(t){var n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];i()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=a,this.lines=[]};function jn(e,t,n,a){for(var o=e.length-1,i=0;i<e.length;i++)if(-1===a.indexOf(i)&&-1===a.indexOf(o)){if(zn(t,n,Wn(e[o]),Wn(e[i])))return!0;o=i}else o=i;return!1}function zn(e,t,n,a){var o=!1,i=[Gn(e,t,n),Gn(e,t,a),Gn(n,a,e),Gn(n,a,t)];return i[0]!==i[1]&&i[2]!==i[3]||(0===i[0]&&Yn(e,n,t)?o=!0:0===i[1]&&Yn(e,a,t)?o=!0:0===i[2]&&Yn(n,e,a)?o=!0:0===i[3]&&Yn(n,t,a)&&(o=!0),o)}function Wn(e){return{x:e.x,y:e.y}}function Gn(e,t,n){var a=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===a?0:0<a?1:2}function Yn(e,t,n){return t.x<=_Mathmax(e.x,n.x)&&t.x>=_Mathmin(e.x,n.x)&&t.y<=_Mathmax(e.y,n.y)&&t.y>=_Mathmin(e.y,n.y)}var Xn={newHandle:function(e,t){var n=t.length-1;return jn(t,Wn(t[n]),Wn(e),[n])},end:function(e){var t=e.length-1;return jn(e,Wn(e[t]),Wn(e[0]),[t,0])},modify:function(e,t){var n=Wn(e[t]),a=t-1;0===t&&(a=e.length-1);var o=Wn(e[a]);return!!jn(e,n,o,[t,a])||jn(e,n,o=Wn(e[a=t===e.length-1?0:t+1]),[t,a])}},Kn=function(){function e(t,n){i()(this,e),this._eventData=t,this._toolName=n}return s()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=ve(this._eventData.element,this._toolName),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0,a;n<e.data.length;n++){a=this._nearestHandleToPoint(n);null!==a&&a.distance<t.distance&&(t=a)}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e],a=n.handles.points;if(void 0===a)return null;if(!1===n.visible)return null;for(var o={toolIndex:e,handleIndex:null,distance:1/0},i=0;i<a.length;i++){var r=p.cornerstone.pixelToCanvas(t.element,a[i]),s=p.cornerstoneMath.point.distance(r,this._mousePoint);s<o.distance&&(o.handleIndex=i,o.distance=s)}return o}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles.points,a=[],o=0,i;o<n.length;o++){i=e.getNextHandleIndex(o,n.length);10>this._distanceOfPointfromLine(n[o],n[i])&&a.push([o,i])}return a}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new Vn(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var a=this._eventData,o=this._toolData.data[t],i=o.handles.points;if(void 0!==o.handles.points){if(!1===o.visible)return!1;var r=i[n[0]],s=i[n[1]],l=e.getCanvasPointsFromHandles(r,s,a.element),c=e.getLineAsVector(l),u=this._getLineOriginToMouseAsVector(l),d=(u[0]*c[0]+u[1]*c[1])/c.magnitude;return 0<d&&d<c.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,a=p.cornerstone.pixelToCanvas(n.element,e),o=p.cornerstone.pixelToCanvas(n.element,t),i=this._mousePoint;return _Mathabs((o.y-a.y)*i.x-(o.x-a.x)*i.y+o.x*a.y-o.y*a.x)/p.cornerstoneMath.point.distance(a,o)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var a=[];return e.x<t.x?(a.push(p.cornerstone.pixelToCanvas(n,e)),a.push(p.cornerstone.pixelToCanvas(n,t))):(a.push(p.cornerstone.pixelToCanvas(n,t)),a.push(p.cornerstone.pixelToCanvas(n,e))),a}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=p.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}(),Zn=function(e,t){t===e.length-1?e[t].lines.push(e[0]):e[t].lines.push(e[t+1])},$n={calculateFreehandStatistics:function(e,t,n){var a={count:0,mean:0,variance:0,stdDev:0},o=function(e,t,n){for(var a={value:0,squared:0,count:0},o=0,i=t.top;i<t.top+t.height;i++)for(var r=t.left,s;r<t.left+t.width;r++){s={x:r,y:i};Fn(n,s,a,e[o]),o++}return a}(e,t,n);return 0===o.count?a:(a.count=o.count,a.mean=o.value/o.count,a.variance=o.squared/o.count-a.mean*a.mean,a.stdDev=_Mathsqrt(a.variance),a)},ClickedLineData:Vn,freehandArea:function(e,t){var n=0,a=e.length-1;t=t||1;for(var o=0;o<e.length;o++)n+=(e[a].x+e[o].x)*(e[a].y-e[o].y),a=o;return _Mathabs(n*t/2)},FreehandHandleData:qn,freehandIntersect:Xn,FreehandLineFinder:Kn,insertOrDelete:function(e,t){var n=e.detail;if(t&&null!==t.handleNearby){var a={toolIndex:t.toolIndex,handleIndex:t.handleNearby};(function(e,t){var n=ve(e.element,this.name);if(void 0!==n){var a=t.handleIndex,o=t.toolIndex,i=n.data[o],r=i.handles.points;3>=r.length||(a===r.length-1?(r[a-1].lines.pop(),r[a-1].lines.push(r[0])):0===a?(r[r.length-1].lines.pop(),r[r.length-1].lines.push(r[a+1])):(r[a-1].lines.pop(),r[a-1].lines.push(r[a+1])),r.splice(a,1),i.invalidated=!0,i.active=!0,i.highlight=!0,p.cornerstone.updateImage(e.element))}}).call(this,n,a)}else{var o=new Kn(n,this.name).findLine();o&&function(e,t){var n=ve(e.element,this.name);if(void 0!==n){var a=n.data[t.toolIndex],o=function(e){for(var t=e.handleIndexArray,n=1/0,a=t.includes(0),o=0,i;o<t.length;o++){i=t[o];0!==i&&i<n&&(n=i)}return a&&1===n&&(n=0),++n}(t);if(o!==1/0){var i=new qn(e.currentPoints.image),r=a.handles.points;r.splice(o,0,i),r[o-1].lines.pop(),r[o-1].lines.push(e.currentPoints.image),Zn(r,o),a.active=!0,a.highlight=!0,a.invalidated=!0,p.cornerstone.updateImage(e.element)}}}.call(this,n,o)}},pointInFreehand:Nn,addLine:Zn},Jn=V("tools:annotation:FreehandMouseTool"),Qn=$n.insertOrDelete,ea=$n.freehandArea,ta=$n.calculateFreehandStatistics,na=$n.freehandIntersect,aa=$n.FreehandHandleData,oa=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"FreehandMouse",supportedInteractionTypes:["Mouse","Touch"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:1,activeHandleRadius:3,completeHandleRadius:6,completeHandleRadiusTouch:28,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1},svgCursor:wt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.isMultiPartTool=!0,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(Gt()(e)),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(Gt()(e)),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(Gt()(e)),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(Gt()(e)),e._drawingMouseDoubleClickCallback=e._drawingMouseDoubleClickCallback.bind(Gt()(e)),e._editMouseUpCallback=e._editMouseUpCallback.bind(Gt()(e)),e._editMouseDragCallback=e._editMouseDragCallback.bind(Gt()(e)),e._drawingTouchStartCallback=e._drawingTouchStartCallback.bind(Gt()(e)),e._drawingTouchDragCallback=e._drawingTouchDragCallback.bind(Gt()(e)),e._drawingDoubleTapClickCallback=e._drawingDoubleTapClickCallback.bind(Gt()(e)),e._editTouchDragCallback=e._editTouchDragCallback.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:{points:[]}};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}Jn.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.points;if(!a)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return!(!a||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var a=1/0,o=0,i;o<t.handles.points.length;o++){i=p.cornerstoneMath.point.distance(t.handles.points[o],n);a=_Mathmin(a,i)}return a===1/0?-1:a}},{key:"distanceFromPointCanvas",value:function(e,t,n){var a=1/0;if(!t)return-1;for(var o=p.cornerstone.pixelToCanvas(e,n),i=t.handles.points,r=0;r<i.length;r++){var s=p.cornerstone.pixelToCanvas(e,i[r]),l=p.cornerstoneMath.point.distance(s,o);a=_Mathmin(a,l)}return a===1/0?-1:a}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=ve(e.currentTarget,this.name);if(a)for(var o=n.image,i=n.element,r=this.configuration,s=p.cornerstone.metaData.get("generalSeriesModule",o.imageId),l=s?s.modality:null,c=dt(n.canvasContext.canvas),u=Ve.getToolWidth(),d=function(e){var s=a.data[e];if(!1===s.visible)return"continue";Ge(c,function(e){var a,c=We.getColorIfActive(s);if(s.active?s.handles.invalidHandlePlacement?(c=r.invalidColor,a=r.invalidColor):(c=We.getColorIfActive(s),a=We.getFillColor()):a=We.getToolColor(),s.handles.points.length)for(var d=0,h;d<s.handles.points.length;d++){h=$t()(s.handles.points[d].lines);d!==s.handles.points.length-1||s.polyBoundingBox||h.push(r.mouseLocation.handles.start),Ke(e,n.element,s.handles.points[d],h,{color:c})}var g,f,m,y={color:c,fill:a};if((r.alwaysShowHandles||s.active&&s.polyBoundingBox)&&(y.handleRadius=r.activeHandleRadius,Qe(e,n,s.handles.points,y)),s.canComplete){y.handleRadius=r.completeHandleRadius;var x=s.handles.points[0];Qe(e,n,[x],y)}if(s.active&&!s.polyBoundingBox){y.handleRadius=r.activeHandleRadius,Qe(e,n,r.mouseLocation.handles,y);var T=s.handles.points[0];Qe(e,n,[T],y)}if(!1===s.invalidated)f=s.meanStdDev,m=s.meanStdDevSUV,g=s.area;else if(!s.active){for(var C=s.handles.points,b={left:C[0].x,right:C[0].x,bottom:C[0].y,top:C[0].x},E=0;E<C.length;E++)b.left=_Mathmin(b.left,C[E].x),b.right=_Mathmax(b.right,C[E].x),b.bottom=_Mathmin(b.bottom,C[E].y),b.top=_Mathmax(b.top,C[E].y);var M={left:b.left,top:b.bottom,width:_Mathabs(b.right-b.left),height:_Mathabs(b.top-b.bottom)};if(s.polyBoundingBox=M,!o.color){var w=p.cornerstone.getPixels(i,M.left,M.top,M.width,M.height);f=ta.call(t,w,M,s.handles.points),"PT"===l&&(m={mean:En(o,(f.mean-o.intercept)/o.slope),stdDev:En(o,(f.stdDev-o.intercept)/o.slope)}),f&&!isNaN(f.mean)&&(s.meanStdDev=f,s.meanStdDevSUV=m)}var k=(o.columnPixelSpacing||1)*(o.rowPixelSpacing||1);g=ea(s.handles.points,k),isNaN(g)||(s.area=g),s.invalidated=!1}if(s.polyBoundingBox&&!s.handles.textBox.freehand){s.handles.textBox.hasMoved||(s.handles.textBox.x=s.polyBoundingBox.left+s.polyBoundingBox.width,s.handles.textBox.y=s.polyBoundingBox.top+s.polyBoundingBox.height/2);var I=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,i=[];if(t&&void 0!==t.mean){var r="";"CT"===l&&(r=" HU");var s="Mean: ".concat(_n(t.mean.toFixed(2))).concat(r),c="StdDev: ".concat(_n(t.stdDev.toFixed(2))).concat(r);if(n&&void 0!==n.mean){s+=" SUV: "+_n(n.mean.toFixed(2)),c+=" SUV: "+_n(n.stdDev.toFixed(2))}i.push(s),i.push(c)}if(a){var u=" mm".concat("\xB2");o.rowPixelSpacing&&o.columnPixelSpacing||(u=" pixels".concat("\xB2"));var d="Area: ".concat(_n(a.toFixed(2))).concat(u);i.push(d)}return i}.call(t,s);ct(e,i,s.handles.textBox,I,s.handles.points,v,c,u,0,!0)}})},h=0;h<a.data.length;h++)d(h);function v(e){return e}}},{key:"addNewMeasurement",value:function(e){var t=e.detail;this._startDrawing(e),this._addPoint(t),ia(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return!!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||Qn.call(this,e,n),ia(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"mouse",o=e.detail,i=o.element,r=ve(o.element,this.name);if(n.hasBoundingBox)Re(e,this,t,n,a);else{var s=this.configuration;s.dragOrigin={x:n.x,y:n.y};for(var l=0;l<r.data.length;l++)for(var c=r.data[l].handles.points,u=0;u<c.length;u++)c[u]===n&&(s.currentHandle=u,s.currentTool=l);this._modifying=!0,this._activateModify(i),ia(e)}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.element,a=ve(t.element,this.name),o=this.configuration,i=o.currentTool,r=a.data[i],s=t.currentPoints.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(r,t);var l=this._pointNearHandle(n,r,s),c=r.handles.points;void 0!==l&&!l.hasBoundingBox&&l<c.length-1&&(o.mouseLocation.handles.start.x=c[l].x,o.mouseLocation.handles.start.y=c[l].y),p.cornerstone.updateImage(t.element)}},{key:"_drawingMouseDragCallback",value:function(e){this.options.mouseButtonMask.includes(e.detail.buttons)&&this._drawingDrag(e)}},{key:"_drawingTouchDragCallback",value:function(e){this._drawingDrag(e)}},{key:"_drawingDrag",value:function(e){var t=e.detail,n=ve(t.element,this.name),a=this.configuration.currentTool,o=n.data[a];this._getMouseLocation(t),this._checkInvalidHandleLocation(o,t),this._addPointPencilMode(t,o.handles.points),this._dragging=!0,p.cornerstone.updateImage(t.element)}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail;if(this._dragging){this._dragging=!1;var n=t.element,a=this.configuration,o=a.currentTool,i=ve(t.element,this.name).data[o];if(!na.end(i.handles.points)&&i.canComplete){var r=a.currentHandle;this._endDrawing(n,r)}ia(e)}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail;if(this.options.mouseButtonMask.includes(t.buttons)){var n=t.element,a=t.currentPoints.canvas,o=this.configuration,i=o.currentTool,r=ve(t.element,this.name).data[i],s=this._pointNearHandle(n,r,a);if(!na.end(r.handles.points)&&r.canComplete){var l=o.currentHandle;this._endDrawing(n,l)}else void 0===s&&this._addPoint(t);ia(e)}}},{key:"_drawingTouchStartCallback",value:function(e){var t=e.detail,n=t.element,a=t.currentPoints.canvas,o=this.configuration,i=o.currentTool,r=ve(t.element,this.name).data[i],s=this._pointNearHandle(n,r,a);if(!na.end(r.handles.points)&&r.canComplete){var l=o.currentHandle;this._endDrawing(n,l)}else void 0===s&&this._addPoint(t);ia(e)}},{key:"completeDrawing",value:function(e){if(this._drawing){var t=ve(e,this.name),n=this.configuration,a=t.data[n.currentTool];if(!na.end(a.handles.points)&&2<=a.handles.points.length){var o=n.currentHandle;a.polyBoundingBox={},this._endDrawing(e,o)}}}},{key:"_drawingMouseDoubleClickCallback",value:function(e){var t=e.detail;this.completeDrawing(t.element),ia(e)}},{key:"_drawingDoubleTapClickCallback",value:function(e){var t=e.detail;this.completeDrawing(t.element),ia(e)}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail;if(this.options.mouseButtonMask.includes(t.buttons)){var n,a=ve(t.element,this.name),o=this.configuration,i=a.data[o.currentTool],r=o.currentHandle,s=i.handles.points;if(this._getMouseLocation(t),i.handles.invalidHandlePlacement=na.modify(s,r),i.active=!0,i.highlight=!0,s[r].x=o.mouseLocation.handles.start.x,s[r].y=o.mouseLocation.handles.start.y,n=this._getPrevHandleIndex(r,s),0<=r){var l=s[n].lines.length-1,c=s[n].lines[l];c.x=o.mouseLocation.handles.start.x,c.y=o.mouseLocation.handles.start.y}p.cornerstone.updateImage(t.element)}}},{key:"_editTouchDragCallback",value:function(e){var t,n=e.detail,a=ve(n.element,this.name),o=this.configuration,i=a.data[o.currentTool],r=o.currentHandle,s=i.handles.points;if(this._getMouseLocation(n),i.handles.invalidHandlePlacement=na.modify(s,r),i.active=!0,i.highlight=!0,s[r].x=o.mouseLocation.handles.start.x,s[r].y=o.mouseLocation.handles.start.y,t=this._getPrevHandleIndex(r,s),0<=r){var l=s[t].lines.length-1,c=s[t].lines[l];c.x=o.mouseLocation.handles.start.x,c.y=o.mouseLocation.handles.start.y}p.cornerstone.updateImage(n.element)}},{key:"_getPrevHandleIndex",value:function(e,t){return 0===e?t.length-1:e-1}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,a=ve(t.element,this.name);this._deactivateModify(n),this._dropHandle(t,a),this._endDrawing(n),p.cornerstone.updateImage(t.element)}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,a=n.currentTool,o=t.data[a].handles,i=o.points;if(o.invalidHandlePlacement){var r,s=n.currentHandle,l=i[s];if(0===s)r=i[i.length-1];else r=i[s-1];l.x=n.dragOrigin.x,l.y=n.dragOrigin.y,r.lines[0]=l,o.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(e){var t,n=e.detail,a=this.createNewMeasurement(n),o=n.element,i=this.configuration;this._referencedElement=o,e.type===T.MOUSE_DOWN_ACTIVATE?t="Mouse":e.type===T.TOUCH_START_ACTIVE&&(t="Touch"),this._activateDraw(o,t),this._getMouseLocation(n),he(n.element,this.name,a);var r=ve(n.element,this.name);i.currentTool=r.data.length-1,this._activeDrawingToolReference=r.data[i.currentTool]}},{key:"_addPoint",value:function(e){var t=ve(e.element,this.name),n=this.configuration,a=t.data[n.currentTool];if(!a.handles.invalidHandlePlacement){var o=new aa(e.currentPoints.image);a.handles.points.length&&a.handles.points[n.currentHandle-1].lines.push(e.currentPoints.image),a.handles.points.push(o),n.currentHandle+=1,p.cornerstone.updateImage(e.element),this.fireModifiedEvent(e.element,a)}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,a=this.configuration,o=e.element,i=a.mouseLocation.handles.start;t.every(function(e){return n._isDistanceLargerThanSpacing(o,e,i)})&&this._addPoint(e)}},{key:"_endDrawing",value:function(e,t){var n=ve(e,this.name),a=this.configuration,o=n.data[a.currentTool];if(o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1,void 0!==t){var i=o.handles.points;i[a.currentHandle-1].lines.push(i[0])}this._modifying&&(this._modifying=!1,o.invalidated=!0),a.currentHandle=0,a.currentTool=-1,o.canComplete=!1,this._drawing&&this._deactivateDraw(e),p.cornerstone.updateImage(e),this.fireModifiedEvent(e,o)}},{key:"_pointNearHandle",value:function(e,t,n){if(void 0!==t.handles&&void 0!==t.handles.points&&!1!==t.visible){for(var a=0,o;a<t.handles.points.length;a++){o=p.cornerstone.pixelToCanvas(e,t.handles.points[a]);if(6>p.cornerstoneMath.point.distance(o,n))return a}return t.handles.textBox&&pe(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.element,n=e.currentPoints.canvas,a=ve(t,this.name);if(a)for(var o,i=0;i<a.data.length;i++)if(void 0!==(o=this._pointNearHandle(t,a.data[i],n)))return{handleNearby:o,toolIndex:i}}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,Ee(t.mouseLocation.handles.start,e.image)}},{key:"_checkInvalidHandleLocation",value:function(e,t){if(2>e.handles.points.length)return!0;var n;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=this.configuration,a=t.element,o=n.mouseLocation.handles.start,i=e.handles.points,r=!1;return e.canComplete=!1,this._isDistanceSmallerThanCompleteSpacingCanvas(a,i[0],o)&&!na.end(i)&&2<i.length?(e.canComplete=!0,r=!1):r=na.newHandle(o,i),r}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=this.configuration.mouseLocation.handles.start,a=e.handles.points,o=na.newHandle(n,a);return!1===o&&(o=this._invalidHandlePencilMode(e,t)),o}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=this.configuration,a=t.element,o=n.mouseLocation.handles.start,i=e.handles.points;if(this._isDistanceSmallerThanCompleteSpacingCanvas(a,i[0],o))return e.canComplete=!0,!1;e.canComplete=!1;for(var r=1;r<i.length-1;r++)if(this._isDistanceSmallerThanSpacing(a,i[r],o))return!0;return!1}},{key:"_isDistanceSmallerThanCompleteSpacingCanvas",value:function(e,t,n){var a,o=p.cornerstone.pixelToCanvas(e,t),i=p.cornerstone.pixelToCanvas(e,n);return"Mouse"===this._drawingInteractionType?a=this.configuration.completeHandleRadius:"Touch"===this._drawingInteractionType&&(a=this.configuration.completeHandleRadiusTouch),this._compareDistanceToSpacing(e,o,i,"<",a)}},{key:"_isDistanceSmallerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,">")}},{key:"_compareDistanceToSpacing",value:function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:">",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:this.configuration.spacing;return">"===a?p.cornerstoneMath.point.distance(t,n)>o:p.cornerstoneMath.point.distance(t,n)<o}},{key:"_activateDraw",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"Mouse";this._drawing=!0,this._drawingInteractionType=t,S.isMultiPartToolActive=!0,H(this.element),e.addEventListener(T.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(T.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(T.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.addEventListener(T.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(T.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(T.TOUCH_START,this._drawingMouseMoveCallback),e.addEventListener(T.TOUCH_START,this._drawingTouchStartCallback),e.addEventListener(T.TOUCH_DRAG,this._drawingTouchDragCallback),e.addEventListener(T.TOUCH_END,this._drawingMouseUpCallback),e.addEventListener(T.DOUBLE_TAP,this._drawingDoubleTapClickCallback),p.cornerstone.updateImage(e)}},{key:"_deactivateDraw",value:function(e){this._drawing=!1,S.isMultiPartToolActive=!1,this._activeDrawingToolReference=null,this._drawingInteractionType=null,R(this.element,this.svgCursor),e.removeEventListener(T.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(T.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(T.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.removeEventListener(T.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(T.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(T.TOUCH_START,this._drawingTouchStartCallback),e.removeEventListener(T.TOUCH_DRAG,this._drawingTouchDragCallback),e.removeEventListener(T.TOUCH_START,this._drawingMouseMoveCallback),e.removeEventListener(T.TOUCH_END,this._drawingMouseUpCallback),p.cornerstone.updateImage(e)}},{key:"_activateModify",value:function(e){S.isToolLocked=!0,e.addEventListener(T.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(T.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(T.MOUSE_CLICK,this._editMouseUpCallback),e.addEventListener(T.TOUCH_END,this._editMouseUpCallback),e.addEventListener(T.TOUCH_DRAG,this._editTouchDragCallback),p.cornerstone.updateImage(e)}},{key:"_deactivateModify",value:function(e){S.isToolLocked=!1,e.removeEventListener(T.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(T.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(T.MOUSE_CLICK,this._editMouseUpCallback),e.removeEventListener(T.TOUCH_END,this._editMouseUpCallback),e.removeEventListener(T.TOUCH_DRAG,this._editTouchDragCallback),p.cornerstone.updateImage(e)}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"_closeToolIfDrawing",value:function(e){if(this._drawing){var t=this.configuration.currentHandle;this._endDrawing(e,t),p.cornerstone.updateImage(e)}}},{key:"fireModifiedEvent",value:function(e,t){p.cornerstone.triggerEvent(e,T.MEASUREMENT_MODIFIED,t)}},{key:"cancelDrawing",value:function(e){if(this._drawing){var t=ve(e,this.name),n=this.configuration,a=t.data[n.currentTool];a.active=!1,a.highlight=!1,a.handles.invalidHandlePlacement=!1,n.currentHandle=0,n.currentTool=-1,a.canComplete=!1,ge(e,this.name,a),this._deactivateDraw(e),p.cornerstone.updateImage(e)}}},{key:"newImageCallback",value:function(e){var t=this.configuration;if(this._drawing&&this._activeDrawingToolReference){var n=e.detail.element,a=this._activeDrawingToolReference;a.active=!1,a.highlight=!1,a.handles.invalidHandlePlacement=!1;var o=a.handles.points;o[t.currentHandle-1].lines.push(o[0]),t.currentHandle=0,t.currentTool=-1,a.canComplete=!1,this._deactivateDraw(n),p.cornerstone.updateImage(n)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,p.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,p.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,p.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,p.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,p.cornerstone.updateImage(this.element)}}]),t}(Ne);function ia(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}var ra=V("tools:annotation:LengthTool"),sa=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:It},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,a=t.y;return{visible:!0,active:!0,color:void 0,handles:{start:{x:n,y:a,highlight:!0,active:!1},end:{x:n,y:a,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}ra.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){return t&&t.handles&&t.handles.start&&t.handles.end?!1!==t.visible&&25>mt(e,t.handles.start,t.handles.end,n):(ra.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=this.configuration,o=a.handleRadius,i=a.drawHandlesOnHover,r=ve(e.currentTarget,this.name);if(r){var s,l,c=dt(n.canvasContext.canvas),u=n.image,d=n.element,h=Ve.getToolWidth(),v=p.cornerstone.metaData.get("imagePlaneModule",u.imageId);v?(s=v.rowPixelSpacing||v.rowImagePixelSpacing,l=v.columnPixelSpacing||v.colImagePixelSpacing):(s=u.rowPixelSpacing,l=u.columnPixelSpacing);for(var g=function(e){var a=r.data[e];if(!1===a.visible)return"continue";Ge(c,function(e){vt(e,t.configuration);var r=We.getColorIfActive(a);Xe(e,d,a.handles.start,a.handles.end,{color:r});var c={color:r,handleRadius:o,drawHandlesIfActive:i};Qe(e,n,a.handles,c);var u=(a.handles.end.x-a.handles.start.x)*(l||1),v=(a.handles.end.y-a.handles.start.y)*(s||1),g=_Mathsqrt(u*u+v*v);if(a.length=g,!a.handles.textBox.hasMoved){var f={x:_Mathmax(a.handles.start.x,a.handles.end.x)};f.x===a.handles.start.x?f.y=a.handles.start.y:f.y=a.handles.end.y,a.handles.textBox.x=f.x,a.handles.textBox.y=f.y}var p=function(e,t,n){var a=" mm";t&&n||(a=" pixels");return"".concat(e.length.toFixed(2)).concat(a)}(a,s,l);ct(e,d,a.handles.textBox,p,a.handles,m,r,h,10,!0)})},f=0;f<r.data.length;f++)g(f)}function m(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}}]),t}(Ne),la=function(e,t,n,a,o){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=_Mathround(t),n=_Mathround(n);var i,r,s,l=p.cornerstone.getEnabledElement(e),c=[],u=0,d=l.image.getPixelData();if(l.image.color)for(r=0;r<o;r++)for(s=0;s<a;s++){var h=d[i=4*((r+n)*l.image.columns+(s+t))],v=d[i+1],g=d[i+2],f=d[i+3];c[u++]=h,c[u++]=v,c[u++]=g,c[u++]=f}return c},ca=V("tools:annotation:ProbeTool"),ua=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],svgCursor:_t},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};ca.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.end;if(a||ca.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return!1;var o=p.cornerstone.pixelToCanvas(e,t.handles.end);return 5>p.cornerstoneMath.point.distance(o,n)}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration.handleRadius,a=ve(e.currentTarget,this.name);if(a)for(var o=dt(t.canvasContext.canvas),i=t.image,r=ot.getFontSize(),s=function(e){var s=a.data[e];if(!1===s.visible)return"continue";Ge(o,function(e){var a=We.getColorIfActive(s);Qe(e,t,s.handles,{handleRadius:n,color:a});var o,l,c,u=_Mathround(s.handles.end.x),d=_Mathround(s.handles.end.y);if(0<=u&&0<=d&&u<i.columns&&d<i.rows){if(l="".concat(u,", ").concat(d),i.color)o=la(t.element,u,d,1,1),c="R: ".concat(o[0]," G: ").concat(o[1]," B: ").concat(o[2]);else{var h=(o=p.cornerstone.getStoredPixels(t.element,u,d,1,1))[0],v=h*i.slope+i.intercept,g=En(i,h);c="SP: ".concat(h," MO: ").concat(parseFloat(v.toFixed(3))),g&&(c+=" SUV: ".concat(parseFloat(g.toFixed(3))))}var f={x:s.handles.end.x+3,y:s.handles.end.y-3},m=p.cornerstone.pixelToCanvas(t.element,f);lt(e,c,m.x,m.y+r+5,a),lt(e,l,m.x,m.y,a)}})},l=0;l<a.data.length;l++)s(l)}}]),t}(Ne),da=V("tools:annotation:RectangleRoiTool"),ha=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{},svgCursor:St},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};da.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,a){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||da.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===a?15:25,r=p.cornerstone.pixelToCanvas(e,t.handles.start),s=p.cornerstone.pixelToCanvas(e,t.handles.end),l={left:_Mathmin(r.x,s.x),top:_Mathmin(r.y,s.y),width:_Mathabs(r.x-s.x),height:_Mathabs(r.y-s.y)};return p.cornerstoneMath.rect.distanceToPoint(l,n)<i}},{key:"renderToolData",value:function(e){var t=this,n=ve(e.currentTarget,this.name);if(n){var a=e.detail,o=a.image,i=a.element,r=Ve.getToolWidth(),s=this.configuration,l=s.handleRadius,c=s.drawHandlesOnHover,u=dt(a.canvasContext.canvas),d=p.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{},h=p.cornerstone.metaData.get("imagePlaneModule",o.imageId),v=d.modality,g=h&&h.rowPixelSpacing&&h.columnPixelSpacing,f={rowPixelSpacing:(h=h||{}).rowPixelSpacing||1,columnPixelSpacing:h.columnPixelSpacing||1};Ge(u,function(e){for(var s=0,u;s<n.data.length;s++){u=n.data[s];if(!1!==u.visible){var d=We.getColorIfActive(u),h={color:d,handleRadius:l,drawHandlesIfActive:c};vt(e,t.configuration),ut(e,i,u.handles.start,u.handles.end,{color:d}),Qe(e,a,u.handles,h),!0===u.invalidated&&(u.cachedStats?va(o,i,u,v,f):ga(o,i,u,v,f)),u.handles.textBox.hasMoved||(u.handles.textBox.x=_Mathmax(u.handles.start.x,u.handles.end.x),u.handles.textBox.y=(u.handles.start.y+u.handles.end.y)/2);var m=ma(e,o.color,u.cachedStats,v,g,t.configuration);ct(e,i,u.handles.textBox,m,u.handles,function(e){return t=e.start,n=e.end,a=fa(t,n),o=a.left,i=a.top,r=a.width,s=a.height,[{x:o+r/2,y:i},{x:o,y:i+s/2},{x:o+r/2,y:i+s},{x:o+r,y:i+s/2}];var t,n,a,o,i,r,s},d,r,0,!0)}}})}}}]),t}(Ne),va=On(ga,110);function ga(e,t,n,a,o){var i=function(e,t,n,a,o){var i,r=fa(n.start,n.end),s=function(e,t){for(var n=0,a=0,o=0,i=0,r=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)n+=e[i],a+=e[i]*e[i],r=_Mathmin(r,e[i]),s=_Mathmax(s,e[i]),o++,i++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/o,d=a/o-u*u;return{count:o,mean:u,variance:d,stdDev:_Mathsqrt(d),min:r,max:s}}(p.cornerstone.getPixels(t,r.left,r.top,r.width,r.height),r);"PT"===a&&(i={mean:En(e,s.mean,!0)||0,stdDev:En(e,s.stdDev,!0)||0});return{area:r.width*(o.columnPixelSpacing||1)*(r.height*(o.rowPixelSpacing||1))||0,count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:i}}(e,t,n.handles,a,o);n.cachedStats=i,n.invalidated=!1}function fa(e,t){return{left:_Mathmin(e.x,t.x),top:_Mathmin(e.y,t.y),width:_Mathabs(e.x-t.x),height:_Mathabs(e.y-t.y)}}function ma(e,t,n,a,o){var i=n.area,r=n.mean,s=n.stdDev,l=n.min,c=n.max,u=n.meanStdDevSUV,d=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,v=!1!==d.showHounsfieldUnits,g=[],f=[];if(!t){var m=u&&0!==u.mean,p="CT"===a&&v?" HU":"",y="Mean: ".concat(_n(r.toFixed(2))).concat(p),x="Std Dev: ".concat(_n(s.toFixed(2))).concat(p);if(m){for(var T="".concat(" SUV: ").concat(_n(u.mean.toFixed(2))),C="".concat(" SUV: ").concat(_n(u.stdDev.toFixed(2))),b=_Mathfloor(e.measureText("".concat(x,"     ")).width);e.measureText(y).width<b;)y+=" ";f.push("".concat(y).concat(T)),f.push("".concat(x,"     ").concat(C))}else f.push("".concat(y,"     ").concat(x));if(h){for(var E="Min: ".concat(l).concat(p),M="Max: ".concat(c).concat(p),w=m?_Mathfloor(e.measureText("".concat(x,"     ")).width):_Mathfloor(e.measureText("".concat(y,"     ")).width);e.measureText(E).width<w;)E+=" ";f.push("".concat(E).concat(M))}}return g.push(function(e,t){var n=t?" mm".concat("\xB2"):" px".concat("\xB2");return"Area: ".concat(_n(e.toFixed(2))).concat(n)}(i,o)),f.forEach(function(e){return g.push(e)}),g}var pa=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:ya},svgCursor:Pt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.touchPressCallback=e._changeText.bind(Gt()(e)),e.doubleClickCallback=e._changeText.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},a={left:0,top:0,width:e.image.width,height:e.image.height};if(p.cornerstoneMath.point.insideRect(n.handles.end,a)){var o=t.markers.indexOf(t.current);return(o+=t.ascending?1:-1)>=t.markers.length?o=t.loop?0:-1:0>o&&(o=t.loop?t.markers.length:-1),t.current=t.markers[o],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var a=p.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),o=pe(t.handles.end,n);return 10>a||o}}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,a=ve(t.element,this.name);if(a)for(var o=dt(t.canvasContext.canvas),i=function(e){var i=a.data[e];if(!1===i.visible)return"continue";var r=We.getColorIfActive(i);Ge(o,function(e){vt(e,n);var a=p.cornerstone.pixelToCanvas(t.element,i.handles.end);i.handles.end.boundingBox=lt(e,i.text,a.x,a.y-10,r,{centering:{x:!0,y:!0}})})},r=0;r<a.data.length;r++)i(r)}},{key:"_changeText",value:function(e){var t,n=e.detail,a=n.element,o=n.currentPoints;function i(e,t,n){!0===n?ge(a,this.name,e):e.text=t,e.active=!1,p.cornerstone.updateImage(a)}var r=this.configuration,s=o.canvas,l=ve(a,this.name);if(l)for(var c=0;c<l.data.length;c++)if(t=l.data[c],this.pointNearTool(a,t,s))return t.active=!0,p.cornerstone.updateImage(a),r.changeTextCallback(t,n,i),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(Ne),ya=function(e,t,n){n(e,prompt("Change your annotation:"))},xa=D.modules.brush,Ta=xa.state,Ca=xa.setters,ba=function(e){function t(e){var n,a=e.name,o=e.strategies,r=e.defaultStrategy,s=e.configuration,l=e.supportedInteractionTypes,u=e.mixins,h=e.svgCursor;return i()(this,t),s.referencedToolData="brush",(n=c()(this,d()(t).call(this,{name:a,strategies:o,defaultStrategy:r,configuration:s,supportedInteractionTypes:l,mixins:u,svgCursor:h}))).updateOnMouseMove=!0,n.hideDefaultCursor=!0,n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(Gt()(n)),n}return v()(t,e),s()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){this._startPainting(e)}},{key:"preMouseDownCallback",value:function(e){return this._startPainting(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=t.element;this._paint(e),this._drawing=!0,this._startListeningForMouseUp(n),this._lastImageCoords=t.currentPoints.image}},{key:"mouseMoveCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image}},{key:"passiveCallback",value:function(e){p.cornerstone.updateImage(this.element)}},{key:"renderToolData",value:function(e){(function(e,t){return"active"===L(e,t).mode})(e.detail.element,this.name)&&this.renderBrush(e)}},{key:"_getBrushColor",value:function(e){var t=p.cornerstone.colors.getColormap(Ta.colorMapId).getColor(e);return this._drawing?"rgba(".concat(t[[0]],", ").concat(t[[1]],", ").concat(t[[2]],", 1.0 )"):"rgba(".concat(t[[0]],", ").concat(t[[1]],", ").concat(t[[2]],", 0.8 )")}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t)}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(T.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(T.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(T.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(T.MOUSE_CLICK,this._drawingMouseUpCallback),p.cornerstone.updateImage(e)}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(T.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(T.MOUSE_CLICK,this._drawingMouseUpCallback),p.cornerstone.updateImage(e)}},{key:"nextSegmentation",value:function(){var e=this.constructor.getNumberOfColors(),t=Ta.drawColorId+1;t===e&&(t=0),Ta.drawColorId=t}},{key:"previousSegmentation",value:function(){var e=this.constructor.getNumberOfColors(),t=Ta.drawColorId-1;0>t&&(t=e-1),Ta.drawColorId=t}},{key:"increaseBrushSize",value:function(){var e=Ta.radius,t=_Mathfloor(1.2*e);t===e&&(t+=1),Ca.radius(t)}},{key:"decreaseBrushSize",value:function(){var e=Ta.radius,t=_Mathfloor(.8*e);Ca.radius(t)}},{key:"showSegmentationOnElement",value:function(e){var t=this._getEnabledElement(),n=t.uuid;Ca.brushVisibilityForElement(n,e,!0),p.cornerstone.updateImage(t.element)}},{key:"hideSegmentationOnElement",value:function(e){var t=this._getEnabledElement(),n=t.uuid;Ca.brushVisibilityForElement(n,e,!1),p.cornerstone.updateImage(t.element)}},{key:"showAllSegmentationsOnElement",value:function(){for(var e=this._getEnabledElement(),t=e.uuid,n=p.cornerstone.colors.getColormap(Ta.colorMapId).getNumberOfColors(),a=0;a<n;a++)Ca.brushVisibilityForElement(t,a,!0);p.cornerstone.updateImage(e.element)}},{key:"hideAllSegmentationsOnElement",value:function(){for(var e=this._getEnabledElement(),t=e.uuid,n=p.cornerstone.colors.getColormap(Ta.colorMapId).getNumberOfColors(),a=0;a<n;a++)Ca.brushVisibilityForElement(t,a,!1);p.cornerstone.updateImage(e.element)}},{key:"_getEnabledElement",value:function(){return p.cornerstone.getEnabledElement(this.element)}},{key:"alpha",get:function(){return Ta.alpha},set:function(e){var t=this._getEnabledElement();Ta.alpha=e,p.cornerstone.updateImage(t.element)}},{key:"hiddenButActiveAlpha",get:function(){return Ta.hiddenButActiveAlpha},set:function(e){var t=this._getEnabledElement();Ta.hiddenButActiveAlpha=e,p.cornerstone.updateImage(t.element)}}],[{key:"getNumberOfColors",value:function(){return p.cornerstone.colors.getColormap(Ta.colorMapId).getNumberOfColors()}},{key:"getReferencedToolDataName",value:function(){return"brush"}},{key:"invalidateBrushOnEnabledElement",value:function(e){var t=D.getters.enabledElementByUID(e),n=ve(t,"stack");if(n){for(var a=n.data[0].imageIds,o=ue.saveToolState(),i=0,r;i<a.length;i++){r=a[i];if(o[r]&&o[r].brush)for(var s=o[r].brush.data,l=0;l<s.length;l++)s[l].pixelData&&(s[l].invalidated=!0)}p.cornerstone.updateImage(t,!0)}}},{key:"getDataAsVolume",value:function(e){var t=D.getters.enabledElementByUID(e),n=ve(t,"stack");if(n)for(var a=n.data[0].imageIds,o=p.cornerstone.getEnabledElement(t).image,i={xy:o.columns*o.rows,z:o.rows,xyz:o.columns*o.rows*a.length},r=ue.saveToolState(),s=new ArrayBuffer(i.xyz),l=(new Uint8Array(s),0),c;l<a.length;l++){c=a[l];r[c]&&r[c].brush&&r[c].brush.data[0].pixelData}}}]),t}(le),Ea={drawBrushPixels:function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=t.pixelData;e.forEach(function(e){var t,i=(t=e[0],e[1]*n+t);o[i]=a?0:1}),a&&!o.some(function(e){return 0!==e})&&delete t.pixelData},drawBrushOnCanvas:function(e,t,n,a){var o=p.cornerstone.pixelToCanvas(a,{x:0,y:0}),i=p.cornerstone.pixelToCanvas(a,{x:1,y:1}),r=i.x-o.x,s=i.y-o.y;Ge(t,function(t){e.forEach(function(e){var o=p.cornerstone.pixelToCanvas(a,{x:e[0],y:e[1]}),i={left:o.x,top:o.y,width:r,height:s};rt(t,i,n)})})},getCircle:function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,i=_Mathround(a),r=_Mathround(o);if(1===e)return[[i,r]];for(var s=[],l=0,c=-e,u;c<=e;c++){u=r+c;if(!(u>t||0>u))for(var d=-e,h;d<=e;d++){h=i+d;h>n||0>h||d*d+c*c<e*e&&(s[l++]=[i+d,r+c])}}return s}},Ma=Ea.drawBrushPixels,wa=Ea.getCircle,ka=D.modules.brush,Ia=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Brush",supportedInteractionTypes:["Mouse","Touch"],strategies:{overlapping:_a,nonOverlapping:Sa},defaultStrategy:"overlapping",configuration:{}},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).touchDragCallback=e._paint.bind(Gt()(e)),e.initialConfiguration=o,e}return v()(t,e),s()(t,[{key:"renderBrush",value:function(e){var t,n=e.detail,a=n.viewport;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=D.state.mousePositionImage,t){var o=n.image,i=o.rows,r=o.columns,s=t,l=s.x,c=s.y;if(!(0>l||l>r||0>c||c>i)){var u=ka.state.radius,d=n.canvasContext,h=n.element,v=ka.state.drawColorId,g=this._getBrushColor(v);d.setTransform(1,0,0,1,0,0);var f=p.cornerstone,m=u*a.scale,y=f.pixelToCanvas(h,t);d.beginPath(),d.strokeStyle=g,d.ellipse(y.x,y.y,m,m,0,0,2*_MathPI),d.stroke()}}}},{key:"_paint",value:function(e){this.applyActiveStrategy(e,this.configuration),p.cornerstone.triggerEvent(e.detail.element,T.MEASUREMENT_MODIFIED,e.detail),p.cornerstone.updateImage(e.detail.element)}}]),t}(ba);function _a(e){var t=e.detail,n=t.element,a=t.image,o=a.rows,i=a.columns,r=t.currentPoints.image,s=r.x,l=r.y,c=ve(n,ba.getReferencedToolDataName());c||(he(n,ba.getReferencedToolDataName(),{}),c=ve(n,ba.getReferencedToolDataName()));var u=c.data;if(!(0>s||s>i||0>l||l>o)){var d=ka.state.radius;Pa(t,u,wa(d,o,i,s,l))}}function Sa(e){var t=e.detail,n=t.element,a=t.image,o=a.rows,i=a.columns,r=t.currentPoints.image,s=r.x,l=r.y,c=ve(n,ba.getReferencedToolDataName());c||(he(n,ba.getReferencedToolDataName(),{}),c=ve(n,ba.getReferencedToolDataName()));var u=c.data,d=ka.state.drawColorId;if(!(0>s||s>i||0>l||l>o)){for(var h=ka.state.radius,v=wa(h,o,i,s,l),g=ba.getNumberOfColors(),f=0;f<g;f++)f!==d&&u[f]&&u[f].pixelData&&(Ma(v,u[f],i,!0),u[f].invalidated=!0);Pa(t,u,v)}}function Pa(e,t,n){var a=function(e){return e.event&&e.event.ctrlKey||e.ctrlKey}(e),o=e.image.columns,i=ka.state.drawColorId;if(!a||t[i]){if(t[i]||(t[i]={}),!t[i].pixelData){var r=p.cornerstone.getEnabledElement(e.element).uuid,s=ka.getters.imageBitmapCacheForElement(r);s&&(s[i]=null),t[i].pixelData=new Uint8ClampedArray(e.image.width*e.image.height)}var l=t[i];Ma(n,l,o,a),l.invalidated=!0}}var Oa,Da,La,Aa={setStartLoadHandler:function(e){Oa=e},getStartLoadHandler:function(){return Oa},setEndLoadHandler:function(e){Da=e},getEndLoadHandler:function(){return Da},setErrorLoadingHandler:function(e){La=e},getErrorLoadingHandler:function(){return La}};function Ra(e){var t=p.cornerstoneMath;return e instanceof t.Vector3?e:new t.Vector3(e[0],e[1],e[2])}function Ha(e,t){var n=Ra(t.rowCosines),a=Ra(t.columnCosines),o=Ra(t.imagePositionPatient),i=e.clone().sub(o);return{x:n.dot(i)/t.columnPixelSpacing,y:a.dot(i)/t.rowPixelSpacing}}function Ua(e,t){var n=Ra(t.rowCosines),a=Ra(t.columnCosines),o=Ra(t.imagePositionPatient),i=n.clone().multiplyScalar(e.x);i.multiplyScalar(t.columnPixelSpacing);var r=a.clone().multiplyScalar(e.y);r.multiplyScalar(t.rowPixelSpacing);var s=i.add(r);return s.add(o),s}function Na(e,t){var n=Ra(e.rowCosines),a=Ra(e.columnCosines),o=Ra(e.imagePositionPatient),i=Ra(t.rowCosines),r=Ra(t.columnCosines),s=Ra(t.imagePositionPatient),l=n.clone().cross(a),c=new p.cornerstoneMath.Plane;c.setFromNormalAndCoplanarPoint(l,o);var u=i.clone().cross(r),d=new p.cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(u,s);var h=d.clone().intersectPlane(c),v=h.origin,g=h.direction,f=Ua({x:t.columns,y:t.rows},t),m=s.distanceTo(f),y=new p.cornerstoneMath.Line3;y.start=v,y.end=v.clone().add(g.multiplyScalar(m));var x=function(e,t){var n=[];return Object.keys(t).forEach(function(a){var o=t[a],i=e.intersectLine(o);i&&n.push(i)}),n}(y,function(e){var t=Ua({x:0,y:0},e),n=Ua({x:e.columns,y:0},e),a=Ua({x:0,y:e.rows},e),o=Ua({x:e.columns,y:e.rows},e);return{top:new p.cornerstoneMath.Line3(t,n),left:new p.cornerstoneMath.Line3(t,a),right:new p.cornerstoneMath.Line3(n,o),bottom:new p.cornerstoneMath.Line3(a,o)}}(t));if(2===x.length)return{start:x[0],end:x[1]}}var Ba={};function Fa(e,t){if(!Ba[e])return{};var n=Ba[e].find(function(e){return e.element===t});return n?n.options:{}}function Va(e,t,n){if(Ba[e]){var a=Ba[e].findIndex(function(e){return e.element===t});if(-1===a)Ba[e].push({element:t,options:n});else{var o=Ba[e][a].options||{};Ba[e][a].options=Object.assign(o,n)}}else Ba[e]=[{element:t,options:n}]}var qa=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ot},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.mouseDownCallback=e._chooseLocation.bind(Gt()(e)),e.mouseDragCallback=e._chooseLocation.bind(Gt()(e)),e.touchDragCallback=e._chooseLocation.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var a=ve(n,this.name);if(a){var o=n,i=p.cornerstone.getEnabledElement(o).image.imageId,r=p.cornerstone.metaData.get("imagePlaneModule",i);if(r){var s=Ua(t.currentPoints.image,r);a.data[0].synchronizationContext.getSourceElements().forEach(function(e){if(e!==o){var t=_NumberMAX_VALUE,n=-1,a=ve(e,"stack");if(void 0!==a){var i=a.data[0];if(i.imageIds.forEach(function(e,a){var o=p.cornerstone.metaData.get("imagePlaneModule",e);if(o&&o.imagePositionPatient&&o.rowCosines&&o.columnCosines){var i=Ra(o.imagePositionPatient),r=Ra(o.rowCosines),l=Ra(o.columnCosines).clone().cross(r.clone()),c=_Mathabs(l.clone().dot(i)-l.clone().dot(s));c<t&&(t=c,n=a)}}),n!==i.currentImageIdIndex&&-1!==n&&void 0!==i.imageIds[n]){var r=Aa.getStartLoadHandler(),l=Aa.getEndLoadHandler(),c=Aa.getErrorLoadingHandler();r&&r(e),(!0===i.preventCache?p.cornerstone.loadImage(i.imageIds[n]):p.cornerstone.loadAndCacheImage(i.imageIds[n])).then(function(t){var a=p.cornerstone.getViewport(e);i.currentImageIdIndex=n,p.cornerstone.displayImage(e,t,a),l&&l(e,t)},function(t){var a=i.imageIds[n];c&&c(e,a,t)})}}}})}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,a=t.synchronizationContext;Va(this.name,e,{mouseButtonMask:n}),fe(e,this.name),he(e,this.name,{synchronizationContext:a})}}]),t}(le),ja=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a=Object.assign({name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]},n);return(e=c()(this,d()(t).call(this,a))).initialConfiguration=a,e}return v()(t,e),s()(t,[{key:"doubleTapCallback",value:function(e){var t=e.detail;p.cornerstone.fitToWindow(t.element)}}]),t}(le),za=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"DragProbe",strategies:{default:Wa,minimal:Ga},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:_t},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).touchDragCallback=e._movingEventCallback.bind(Gt()(e)),e.touchEndCallback=e._endMovingEventCallback.bind(Gt()(e)),e.mouseDragCallback=e._movingEventCallback.bind(Gt()(e)),e.mouseUpCallback=e._endMovingEventCallback.bind(Gt()(e)),e.initialConfiguration=o,e.dragEventData={},e}return v()(t,e),s()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,p.cornerstone.updateImage(n)}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},p.cornerstone.updateImage(t)}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&!!Object.keys(this.dragEventData.currentPoints).length&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e))}}]),t}(le),Wa=function(e,t){var n=p.cornerstone,a=e.detail,o=a.element,i=a.image,r=a.currentPoints,s=a.canvasContext,l=dt(s.canvas),c=We.getActiveColor(),u=ot.getFontSize(),d=_Mathround(r.image.x),h=_Mathround(r.image.y);0>d||0>h||d>=i.columns||h>=i.rows||Ge(l,function(e){vt(e,t);var a,s,l="".concat(d,", ").concat(h);if(i.color)a=la(o,d,h,1,1),s="R: ".concat(a[0]," G: ").concat(a[1]," B: ").concat(a[2]," A: ").concat(a[3]);else{var v=(a=n.getStoredPixels(o,d,h,1,1))[0],g=v*i.slope+i.intercept,f=En(i,v);s="SP: ".concat(v," MO: ").concat(parseFloat(g.toFixed(3))),f&&(s+=" SUV: ".concat(parseFloat(f.toFixed(3))))}var m={x:r.canvas.x+5,y:r.canvas.y-5};lt(e,s,m.x,m.y+u+5,c),lt(e,l,m.x,m.y,c)})},Ga=function(e,t){var n=p.cornerstone,a=e.detail,o=a.element,i=a.image,r=a.currentPoints,s=a.canvasContext,l=a.isTouchEvent,c=dt(s.canvas),u=We.getActiveColor(),d=r.page.y-ot.getFontSize()/2;l&&(d=r.page.y-4*ot.getFontSize());var h=n.pageToPixel(o,r.page.x,d);0>h.x||0>h.y||h.x>=i.columns||h.y>=i.rows||Ge(c,function(e){vt(e,t);var a,r=n.metaData.get("generalSeriesModule",i.imageId),s=r&&r.modality,c="";if(i.color)a=la(o,h.x,h.y,1,1),c="R: ".concat(a[0]," G: ").concat(a[1]," B: ").concat(a[2]);else{var d=(a=n.getStoredPixels(o,h.x,h.y,1,1))[0],v=d*i.slope+i.intercept,g=parseFloat(v.toFixed(2));if("CT"===s)c+="HU: ".concat(g);else if("PT"===s){c+=g;var f=En(i,d);f&&(c+=" SUV: ".concat(parseFloat(f.toFixed(2))))}else c+=g}var m=n.pixelToCanvas(o,h),p={x:12,y:-(ot.getFontSize()+10)/2},y=st(e,c,5);l&&(p={x:-y/2,y:-ot.getFontSize()-10-12}),$e(e,o,m,6,{color:u},"canvas"),lt(e,c,m.x+p.x,m.y+p.y,u)})},Ya=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Eraser",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Dt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.preMouseDownCallback=e._deleteAllNearbyTools.bind(Gt()(e)),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;S.tools.forEach(function(e){var a=ve(n,e.name);a&&a.data.forEach(function(a){"function"==typeof e.pointNearTool&&e.pointNearTool(n,a,t)&&(ge(n,e.name,a),p.cornerstone.updateImage(n))})});return!0}}]),t}(le),Xa=$n.FreehandHandleData,Ka=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"FreehandSculpterMouse",referencedToolName:"FreehandMouse",supportedInteractionTypes:["Mouse","Touch","DoubleTap"],mixins:["activeOrDisabledBinaryTool"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:1,currentTool:null,dragColor:We.getActiveColor(),hoverColor:We.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2},svgCursor:kt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).updateOnMouseMove=!0,e.isMultiPartTool=!0,e.initialConfiguration=o,e.referencedToolName=o.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(Gt()(e)),e.activeTouchEndCallback=e.activeTouchEndCallback.bind(Gt()(e)),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"renderToolData",value:function(e){var t=e.detail;if(null===this.configuration.currentTool)return!1;var n=t.element,a=this.configuration;if(!ve(n,this.referencedToolName).data[a.currentTool])return!1;if(this._active){var o=t.canvasContext.canvas.getContext("2d"),i={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};Qe(o,t,this.configuration.mouseLocation.handles,i)}else this.configuration.showCursorOnHover&&!this._recentTouchEnd&&this._renderHoverCursor(e)}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),p.cornerstone.updateImage(t.element)}},{key:"doubleTapCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),p.cornerstone.updateImage(t.element)}},{key:"preTouchStartCallback",value:function(e){return this._initialiseSculpting(e),!0}},{key:"preMouseDownCallback",value:function(e){if(this.options.mouseButtonMask.includes(e.detail.buttons))return this._initialiseSculpting(e),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,a=ve(n.element,this.referencedToolName);if(a){var o=a.data[t.currentTool].handles.points;this._getMouseLocation(n),this._sculpt(n,o),p.cornerstone.updateImage(n.element)}}}},{key:"activeMouseUpCallback",value:function(e){this._activeEnd(e)}},{key:"activeTouchEndCallback",value:function(e){this._activeEnd(e),this._deselectAllTools(e),this._recentTouchEnd=!0}},{key:"_activeEnd",value:function(e){var t=e.detail,n=t.element,a=this.configuration;this._active=!1,S.isMultiPartToolActive=!1,this._getMouseLocation(t),this._invalidateToolData(t),a.mouseUpRender=!0,this._deactivateSculpt(n),p.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}(e)}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,a=n.element,o=n.canvasContext.canvas.getContext("2d"),i=ve(a,this.referencedToolName).data[this.configuration.currentTool];this._recentTouchEnd=!1,this.configuration.mouseUpRender?(t=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):t=S.mousePositionImage;var r=L(a,this.referencedToolName).distanceFromPointCanvas(a,i,t);if(this.configuration.mouseLocation.handles.start.x=t.x,this.configuration.mouseLocation.handles.start.y=t.y,this.configuration.limitRadiusOutsideRegion){var s=r;r=this._limitCursorRadiusCanvas(n,r),s>this.configuration.hoverCursorFadeDistance*r&&(o.globalAlpha=this.configuration.hoverCursorFadeAlpha)}var l={fill:null,color:this.configuration.hoverColor,handleRadius:r};Qe(o,n,this.configuration.mouseLocation.handles,l),this.configuration.limitRadiusOutsideRegion&&(o.globalAlpha=1)}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e)}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e)}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,a=this._getClosestFreehandToolOnElement(n,e);void 0!==a&&(t.currentTool=a,H(n))}},{key:"_activateFreehandTool",value:function(e,t){var n=ve(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var a=0;a<n.length;a++)n[a].active=a===t}},{key:"_initialiseSculpting",value:function(e){var t=e.detail,n=this.configuration,a=t.element;null===n.currentTool&&(this._selectFreehandTool(t),null===n.currentTool)||(this._active=!0,S.isMultiPartToolActive=!0,this._configureToolSize(t),this._getMouseLocation(t),this._activateFreehandTool(a,n.currentTool),this._activateSculpt(a),p.cornerstone.updateImage(t.element))}},{key:"_sculpt",value:function(e,t){var n=this.configuration;this._sculptData={element:e.element,image:e.image,mousePoint:e.currentPoints.image,points:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:_Mathmax(this._toolSizeImage,2*n.minSpacing)};var a=this._pushHandles();void 0!==a.first&&(this._insertNewHandles(a),this._consolidateHandles())}},{key:"_pushHandles",value:function(){for(var e=this._sculptData,t=e.points,n=e.mousePoint,a=e.toolSize,o={},i=0,r;i<t.length;i++){r=p.cornerstoneMath.point.distance(t[i],n);r>a||(this._pushOneHandle(i,r),void 0===o.first?(o.first=i,o.last=i):o.last=i)}return o}},{key:"_pushOneHandle",value:function(e,t){var n=this._sculptData,a=n.points,o=n.mousePoint,i=n.toolSize,r=n.image,s=a[e],l=(s.x-o.x)/t,c=(s.y-o.y)/t,u={x:o.x+i*l,y:o.y+i*c};Ee(u,r),s.x=u.x,s.y=u.y;var d=this.constructor._getPreviousHandleIndex(e,a.length);a[d].lines.pop(),a[d].lines.push(s)}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,a=0,o;a<t.length;a++){o=t[a]+1+n;this._insertHandleRadially(o),n++}}},{key:"_findNewHandleIndicies",value:function(e){for(var t=this._sculptData,n=t.points,a=t.maxSpacing,o=[],i=e.first;i<=e.last;i++)this._checkSpacing(i,n,o,a);var r=this.constructor._getNextHandleIndex(e.last,n.length);if(r!==e.first){this._checkSpacing(r,n,o,a);var s=this.constructor._getPreviousHandleIndex(e.first,n.length);s!==r&&this._checkSpacing(s,n,o,a)}return o}},{key:"_checkSpacing",value:function(e,t,n,a){var o=this.constructor._getNextHandleIndex(e,t.length);p.cornerstoneMath.point.distance(t[e],t[o])>a&&n.push(e)}},{key:"_insertHandleRadially",value:function(e){var t=this._sculptData.points,n=e-1,a=this.constructor._getNextHandleIndexBeforeInsert(e,t.length),o=this._getInsertPosition(e,n,a),i=new Xa(o);t.splice(e,0,i),t[n].lines.pop(),t[n].lines.push(t[e]),$n.addLine(t,e)}},{key:"_consolidateHandles",value:function(){if(!(3>=this._sculptData.points.length)){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_findCloseHandlePairs",value:function(){for(var e=this._sculptData,t=e.points,n=e.minSpacing,a=[],o=t.length,i=0,r;i<o;i++){r=this.constructor._getNextHandleIndex(i,t.length);if(p.cornerstoneMath.point.distance(t[i],t[r])<n){var s=[i,r];a.push(s),0===i&&(o-=1),i++}}return a}},{key:"_mergeCloseHandles",value:function(e){for(var t=0,n=0,a;n<e.length;n++){a=this.constructor._getCorrectedPair(e[n],t);this._combineHandles(a),t++}var o=this._findCloseHandlePairs();o.length&&this._mergeCloseHandles(o)}},{key:"_combineHandles",value:function(e){var t=this._sculptData,n=t.points,a=t.image,o={x:(n[e[0]].x+n[e[1]].x)/2,y:(n[e[0]].y+n[e[1]].y)/2};Ee(o,a),n[e[0]].x=o.x,n[e[0]].y=o.y;var i=this.constructor._getNextHandleIndex(e[1],n.length);n[e[0]].lines.pop(),n[e[0]].lines.push(n[i]),n.splice(e[1],1)}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,a=n.currentTool,o=e.currentPoints.image,i=ve(t,this.referencedToolName).data[a],r=L(t,this.referencedToolName),s=r.distanceFromPoint(t,i,o),l=r.distanceFromPointCanvas(t,i,o);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,Ee(t.mouseLocation.handles.start,e.image)}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(T.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(T.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(T.MOUSE_DRAG,this.activeMouseDragCallback),e.addEventListener(T.TOUCH_END,this.activeTouchEndCallback),e.addEventListener(T.TOUCH_TAP,this.activeTouchEndCallback),e.addEventListener(T.TOUCH_DRAG,this.activeMouseDragCallback),p.cornerstone.updateImage(e)}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(T.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(T.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(T.MOUSE_DRAG,this.activeMouseDragCallback),e.removeEventListener(T.TOUCH_END,this.activeTouchEndCallback),e.removeEventListener(T.TOUCH_TAP,this.activeTouchEndCallback),e.removeEventListener(T.TOUCH_DRAG,this.activeMouseDragCallback),p.cornerstone.updateImage(e)}},{key:"_invalidateToolData",value:function(e){var t=this.configuration;ve(e.element,this.referencedToolName).data[t.currentTool].invalidated=!0}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=ve(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var a=0;a<n.data.length;a++)n.data[a].active=!1;R(this.element,this.svgCursor),p.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=e.element,o=e.image,i=this.configuration,r=ve(a,this.referencedToolName).data[i.currentTool],s=1;if(n){var l=p.cornerstone.pixelToCanvas(a,{x:0,y:0}),c=p.cornerstone.pixelToCanvas(a,{x:o.width,y:o.height});s=(c.x-l.x)*(c.y-l.y)/(o.width*o.height)}var u=r.area*s,d=_Mathpow(u/_MathPI,.5);return _Mathmin(t,d)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=L(e,this.referencedToolName),a=ve(e,this.referencedToolName);if(a){for(var o=a.data,i=t.currentPoints.image,r={distance:1/0,toolIndex:null},s=0,l;s<o.length;s++){l=n.distanceFromPoint(e,o[s],i);-1!==l&&l<r.distance&&(r.distance=l,r.toolIndex=s)}return r.toolIndex}}},{key:"_getInsertPosition",value:function(e,t,n){var a,o=this._sculptData,i=o.points,r=o.toolSize,s=o.mousePoint,l=o.image,c={x:(i[t].x+i[n].x)/2,y:(i[t].y+i[n].y)/2},u=p.cornerstoneMath.point.distance(s,c);if(u<r){var d={x:(c.x-s.x)/u,y:(c.y-s.y)/u};a={x:s.x+r*d.x,y:s.y+r*d.y}}else a=c;return Ee(a,l),a}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,p.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,p.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=_Mathmax(_Mathmin(e,1),0),this.configuration.hoverCursorFadeAlpha=e,p.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=_Mathmax(e,1),this.configuration.hoverCursorFadeDistance=e,p.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return 0>n[1]&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}}]),t}(le),Za=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:Lt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(Gt()(e)),e.enabledCallback=e._createMagnificationCanvas.bind(Gt()(e)),e.disabledCallback=e._destroyMagnificationCanvas.bind(Gt()(e)),e.postTouchStartCallback=e._addMagnifyingGlass.bind(Gt()(e)),e.touchDragCallback=e._updateMagnifyingGlass.bind(Gt()(e)),e.touchEndCallback=e._removeMagnifyingGlass.bind(Gt()(e)),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(Gt()(e)),e.postMouseDownCallback=e._addMagnifyingGlass.bind(Gt()(e)),e.mouseDragCallback=e._updateMagnifyingGlass.bind(Gt()(e)),e.mouseUpCallback=e._removeMagnifyingGlass.bind(Gt()(e)),e.mouseClickCallback=e._removeMagnifyingGlass.bind(Gt()(e)),e.newImageCallback=e._drawMagnificationTool.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame(function(){return t._drawMagnificationTool(e)}),H(e.detail.element),e.preventDefault(),e.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(e){var t=e.detail.element;R(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var a=t.querySelector("canvas:not(.magnifyTool)"),o=dt(n),i=p.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),r=_Mathmin(this.configuration.magnifySize,a.width,a.height),s=this.configuration.magnificationLevel;n.width=r,n.height=r,i.x=_Mathmax(i.x,.5*r/s),i.x=_Mathmin(i.x,a.width-.5*r/s),i.y=_Mathmax(i.y,.5*r/s),i.y=_Mathmin(i.y,a.height-.5*r/s);var l={x:i.x*s-.5*r,y:i.y*s-.5*r};l.x=_Mathmax(l.x,0),l.y=_Mathmax(l.y,0),o.drawImage(this.zoomCanvas,l.x,l.y,r,r,0,0,r,r);var c=e.detail.isTouchEvent?120:0,u={top:_Mathmax(i.y-.5*r-c,0),left:_Mathmax(i.x-.5*r,0)},d=n.getBoundingClientRect();u.top=_Mathmin(u.top,a.height-d.height),u.left=_Mathmin(u.left,a.width-d.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block"}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=p.cornerstone.getEnabledElement(t));var a=this.configuration.magnificationLevel,o=n.canvas,i=n.image;this.zoomElement=document.createElement("div"),this.zoomElement.width=o.width*a,this.zoomElement.height=o.height*a,p.cornerstone.enable(this.zoomElement,n.options);var r=p.cornerstone.getEnabledElement(this.zoomElement),s=p.cornerstone.getViewport(n.element);this.zoomCanvas=r.canvas,this.zoomCanvas.width=o.width*a,this.zoomCanvas.height=o.height*a,r.viewport=Object.assign({},s),s.scale*=a,p.cornerstone.displayImage(this.zoomElement,i),p.cornerstone.setViewport(this.zoomElement,s)}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(p.cornerstone.disable(this.zoomCanvas),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");n&&t.removeChild(n)}}]),t}(le),$a=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a=Object.assign({name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}},n);return(e=c()(this,d()(t).call(this,a))).initialConfiguration=a,e.multiTouchDragCallback=e._dragCallback.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport;if(t.numPointers===this.configuration.touchPointers){var o=this._getTranslation(t);this._applyTranslation(a,o),p.cornerstone.setViewport(n,a)}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,a=e.deltaPoints,o=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:a.page.x/o,y:a.page.y/i}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(le),Ja=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Pan",supportedInteractionTypes:["Mouse","Touch"],svgCursor:At},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.touchDragCallback=e._dragCallback.bind(Gt()(e)),e.mouseDragCallback=e._dragCallback.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=this._getTranslation(t);this._applyTranslation(a,o),p.cornerstone.setViewport(n,a)}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,a=e.deltaPoints,o=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:a.page.x/o,y:a.page.y/i}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(le),Qa=n(9),eo=n.n(Qa),to=n(10),no=n.n(to),ao=function(e,t,n,a){var o=p.cornerstone,i=o.getEnabledElement(n).image,r=o.getEnabledElement(a).image;if(i&&r){var s=o.metaData.get("imagePlaneModule",i.imageId),l=o.metaData.get("imagePlaneModule",r.imageId);if(s&&l&&s.rowCosines&&s.columnCosines&&s.imagePositionPatient&&l.rowCosines&&l.columnCosines&&l.imagePositionPatient&&s.frameOfReferenceUID===l.frameOfReferenceUID){s.rowCosines=Ra(s.rowCosines),s.columnCosines=Ra(s.columnCosines),s.imagePositionPatient=Ra(s.imagePositionPatient),l.rowCosines=Ra(l.rowCosines),l.columnCosines=Ra(l.columnCosines),l.imagePositionPatient=Ra(l.imagePositionPatient);var c=s.rowCosines.clone().cross(s.columnCosines),u=l.rowCosines.clone().cross(l.columnCosines),d=c.angleTo(u);if(!(.5>(d=_Mathabs(d)))){var h=function(e,t){var n=Na(e,t);if(n)return{start:Ha(n.start,e),end:Ha(n.end,e)}}(s,l);if(h){var v=We.getActiveColor();e.setTransform(1,0,0,1,0,0),Ge(e,function(e){Xe(e,t.element,h.start,h.end,{color:v})})}}}}},oo=function(e){return new Promise(function(t){return setTimeout(t,e)})};function io(e){try{var t=p.cornerstone.getEnabledElement(e);return t.image?t:oo(250).then(function(){return io(e)})}catch(e){return null}}var ro,so=V("tools:ReferenceLinesTool"),lo=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:ao}},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.renderer=null,e.synchronizationContext=null,e}return v()(t,e),s()(t,[{key:"enabledCallback",value:function(){var e=no()(eo.a.mark(function e(t){var n,a,o,i=arguments;return eo.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<i.length&&void 0!==i[1]?i[1]:{},a=n.synchronizationContext,o=this.configuration.renderer,e.next=4,io(t);case 4:if(e.sent&&o&&a){e.next=8;break}return so.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=o,this.synchronizationContext=a,this.forceImageUpdate(t);case 11:case"end":return e.stop();}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){p.cornerstone.getEnabledElement(e).image&&p.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var a=this.synchronizationContext.getSourceElements(),o=dt(n.canvasContext.canvas);p.cornerstone.setToPixelCoordinateSystem(n.enabledElement,o),a.forEach(function(a){a!==e.currentTarget&&t.renderer(o,n,e.currentTarget,a)})}}}]),t}(le),co=function(e,t,n){var a=_Mathsqrt(_Mathpow(e.x-t.x,2)+_Mathpow(e.y-t.y,2)),o=_Mathsqrt(_Mathpow(e.x-n.x,2)+_Mathpow(e.y-n.y,2)),i=_Mathsqrt(_Mathpow(t.x-n.x,2)+_Mathpow(t.y-n.y,2));return{angle:180*_Mathacos((_Mathpow(a,2)+_Mathpow(o,2)-_Mathpow(i,2))/(2*a*o))/_MathPI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}},uo=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Rotate",strategies:{default:ho,horizontal:vo,vertical:go},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Rt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e}return v()(t,e),s()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e)}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e,this.configuration),p.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(le),ho=function(e){var t=e.detail,n=t.element,a=t.viewport,o=a.initialRotation,i=n.getBoundingClientRect(n),r=n.clientWidth,s=n.clientHeight,l={x:t.startPoints.client.x,y:t.startPoints.client.y},c=a.scale,u=a.translation,d={x:i.left+r/2+u.x*c,y:i.top+s/2+u.y*c},h={x:t.currentPoints.client.x,y:t.currentPoints.client.y},v=co(d,l,h);0>v.direction&&(v.angle=-v.angle),a.rotation=o+v.angle},vo=function(e){var t=e.detail,n=t.viewport,a=t.deltaPoints;n.rotation+=a.page.x/n.scale},go=function(e){var t=e.detail,n=t.viewport,a=t.deltaPoints;n.rotation+=a.page.y/n.scale},fo=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a=Object.assign({name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]},n);return(e=c()(this,d()(t).call(this,a))).initialConfiguration=a,e}return v()(t,e),s()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=t.rotation;a.rotation+=o,p.cornerstone.setViewport(n,a)}}]),t}(le),mo=V("tools:ScaleOverlayTool"),po=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a=Object.assign({name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]},n);return(e=c()(this,d()(t).call(this,a))).initialConfiguration=a,e}return v()(t,e),s()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){p.cornerstone.getEnabledElement(e).image&&p.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=dt(t.canvasContext.canvas),a=t.image,o=t.viewport,i=t.element,r=a.rowPixelSpacing,s=a.columnPixelSpacing,l=p.cornerstone.metaData.get("imagePlaneModule",a.imageId);if(l&&(r=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),r&&s){var c={width:n.canvas.width,height:n.canvas.height},u=10/r*o.scale,d=10/s*o.scale,h=yo(c,.25,.05),v=yo(c,.05,.15);if(c.width&&c.height&&h&&v){var g=We.getToolColor(),f=Ve.getToolWidth(),m=Object.assign({},{hscaleBounds:h,vscaleBounds:v,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:v.bottomRight.x,y:v.topLeft.y},end:{x:v.bottomRight.x,y:v.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:g,lineWidth:f},this.configuration);Ge(n,function(e){vt(e,m),Xe(e,i,m.verticalLine.start,m.verticalLine.end,{color:g,lineWidth:f},"canvas"),xo(e,i,m),Xe(e,i,m.horizontalLine.start,m.horizontalLine.end,{color:g,lineWidth:f},"canvas"),To(e,i,m)})}}else mo.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}}]),t}(le),yo=function(e,t,n){var a=t*_Mathmin(1e3,e.width),o=n*_Mathmin(1e3,e.height),i={left:a,top:o,width:e.width-2*a,height:e.height-2*o};return{topLeft:{x:i.left,y:i.top},bottomRight:{x:i.left+i.width,y:i.top+i.height}}},xo=function(e,t,n){for(var a=0;n.verticalLine.start.y+a*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var o=n.color,i=n.lineWidth,r={x:n.verticalLine.start.x,y:n.verticalLine.start.y+a*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+a*n.verticalMinorTick};s.x=0==a%5?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Xe(e,t,r,s,{color:o,lineWidth:i},"canvas"),a++}},To=function(e,t,n){for(var a=0;n.horizontalLine.start.x+a*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var o=n.color,i=n.lineWidth,r={x:n.horizontalLine.start.x+a*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+a*n.horizontalMinorTick,y:0};s.y=0==a%5?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Xe(e,t,r,s,{color:o,lineWidth:i},"canvas"),a++}},Co={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function bo(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return /trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}function Eo(){return ro||Mo()}function Mo(){var e=bo().split(" "),t=e[0],n=e[1],a=Co[t];return a?a[n]?a[n]:a.default:Co.default}var wo={interaction:[],thumbnail:[],prefetch:[]},ko={interaction:0,thumbnail:0,prefetch:0},Io={interaction:6,thumbnail:6,prefetch:5},_o=!1,So=20;function Po(){_o&&setTimeout(function(){Do()},So)}function Oo(e){var t=p.cornerstone,n=e.type;ko[n]++,_o=!0;var a=e.imageId,o=e.doneCallback,i=e.failCallback,r=t.imageCache.getImageLoadObject(a);if(r)r.promise.then(function(e){ko[n]--,o(e),Po()},function(e){ko[n]--,i(e),Po()});else{var s=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e);(!0===e.preventCache?t.loadImage(a,{priority:s,type:e.type}):t.loadAndCacheImage(a,{priority:s,type:e.type})).then(function(e){ko[n]--,o(e),Po()},function(e){ko[n]--,i(e),Po()})}}function Do(){var e=Eo();Io={interaction:_Mathmax(e,1),thumbnail:_Mathmax(e-2,1),prefetch:_Mathmax(e-1,1)};for(var t=e-(ko.interaction+ko.thumbnail+ko.prefetch),n=0,a;n<t;n++){a=Lo();a&&Oo(a)}}function Lo(){return wo.interaction.length&&ko.interaction<Io.interaction?wo.interaction.shift():wo.thumbnail.length&&ko.thumbnail<Io.thumbnail?wo.thumbnail.shift():wo.prefetch.length&&ko.prefetch<Io.prefetch?wo.prefetch.shift():(wo.interaction.length||wo.thumbnail.length||wo.prefetch.length||(_o=!1),!1)}var Ao={addRequest:function(e,t,n,a,o,i,r){if(!wo.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var s={type:n,imageId:t,preventCache:a,doneCallback:o,failCallback:i},l=p.cornerstone.imageCache.getImageLoadObject(t);l?l.promise.then(function(e){o(e)},function(e){i(e)}):(r?wo[n].unshift(s):wo[n].push(s),_o=!0)}},clearRequestStack:function(e){if(!wo.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");wo[e]=[]},startGrabbing:Do,getRequestPool:function(){return wo}},Ro=function(e,t){var n=ve(e,"stack");if(n&&n.data&&n.data.length){var a,o=p.cornerstone;if(1<n.data.length){var i=ve(e,"stackRenderer");i&&i.data&&i.data.length&&(a=i.data[0])}var r=n.data[0];0>t&&(t+=r.imageIds.length);var s=Aa.getStartLoadHandler(),l=Aa.getEndLoadHandler(),c=Aa.getErrorLoadingHandler();if(t!==r.currentImageIdIndex){s&&s(e);var u={newImageIdIndex:t,direction:t-r.currentImageIdIndex};r.currentImageIdIndex=t;var d=r.imageIds[t];(!!r.preventCache?o.loadImage(d):o.loadAndCacheImage(d)).then(function(i){if(r.currentImageIdIndex===t){try{o.getEnabledElement(e)}catch(e){return}a?(a.currentImageIdIndex=t,a.render(e,n.data)):o.displayImage(e,i),l&&l(e,i)}},function(n){var a=r.imageIds[t];c&&c(e,a,n)}),Ao.startGrabbing(),C(e,T.STACK_SCROLL,u)}}},Ho=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],o=ve(e,"stack");if(o&&o.data&&o.data.length){var i=o.data[0];i.pending||(i.pending=[]);var r=i.currentImageIdIndex+t;if(n)r%=i.imageIds.length;else r=be(r,0,i.imageIds.length-1);if(a)Ro(e,r);else{var s={index:r};i.pending.push(s),function e(t,n,a){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(0<t.pending.length&&e(t,t.pending[0],a));a.addEventListener(p.cornerstone.EVENTS.NEW_IMAGE,function e(o){t.imageIds.indexOf(o.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),a.removeEventListener(p.cornerstone.EVENTS.NEW_IMAGE,e),0<t.pending.length&&function e(t,n,a){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(0<t.pending.length&&e(t,t.pending[0],a));a.addEventListener(p.cornerstone.EVENTS.NEW_IMAGE,function o(i){t.imageIds.indexOf(i.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),a.removeEventListener(p.cornerstone.EVENTS.NEW_IMAGE,o),0<t.pending.length&&e(t,t.pending[0],a))}),Ro(a,n.index)}}(t,t.pending[0],a))}),Ro(a,n.index)}}(i,s,e)}}};function Uo(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index){e.pending.splice(e.pending.indexOf(t),1);if(0<e.pending.length){Uo(e,e.pending[0],n)}return}var a=function a(o){var i;if(e.imageIds.indexOf(o.detail.image.imageId)===t.index){e.pending.splice(e.pending.indexOf(t),1);n.removeEventListener(p.cornerstone.EVENTS.NEW_IMAGE,a);if(0<e.pending.length){Uo(e,e.pending[0],n)}}};n.addEventListener(p.cornerstone.EVENTS.NEW_IMAGE,a);Ro(n,t.index)}}var No=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a=Object.assign({name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}},n);return(e=c()(this,d()(t).call(this,a))).initialConfiguration=a,e}return v()(t,e),s()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,a=t.element,o=this.configuration,i=o.loop,r=o.allowSkipping,s=o.invert;Ho(a,s?-n:n,i,r)}}]),t}(le),Bo=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a=Object.assign({name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}},n);return(e=c()(this,d()(t).call(this,a))).initialConfiguration=a,e.multiTouchDragCallback=e._dragCallback.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,a=t.deltaPoints,o=this.configuration,i=o.loop,r=o.allowSkipping,s=Fa(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,a.page.y);if(!l)return;if(_Mathabs(c)>=l){var u=_Mathround(c/l);Ho(n,u,i,r),s.deltaY=c%l}else s.deltaY=c;Va(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Fa(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=ve(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||_Mathmax(2,e.offsetHeight/_Mathmax(n.imageIds.length,8))}}}]),t}(le),Fo=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0},svgCursor:Ht},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e.mouseDragCallback=e._dragCallback.bind(Gt()(e)),e.touchDragCallback=e._dragCallback.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.deltaPoints,o=this.configuration,i=o.loop,r=o.allowSkipping,s=Fa(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,a.page.y);if(l){if(_Mathabs(c)>=l){var u=_Mathround(c/l);Ho(n,u,i,r),s.deltaY=c%l}else s.deltaY=c;Va(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Fa(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=ve(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||_Mathmax(2,e.offsetHeight/_Mathmax(n.imageIds.length,8))}}}]),t}(le),Vo=function(e,t,n,a,o){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=_Mathround(t),n=_Mathround(n);var i,r,s,l=p.cornerstone.getEnabledElement(e).image,c=[],u=0,d=l.getPixelData();if(l.color)for(r=0;r<o;r++)for(s=0;s<a;s++){var h=d[i=4*((r+n)*l.columns+(s+t))],v=d[i+1],g=d[i+2];c[u++]=.2126*h+.7152*v+.0722*g}else for(r=0;r<o;r++)for(s=0;s<a;s++)i=(r+n)*l.columns+(s+t),c[u++]=d[i]*l.slope+l.intercept;return c},qo=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10},svgCursor:Ut},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(Gt()(e)),e.touchDragCallback=e._setHandlesAndUpdate.bind(Gt()(e)),e.touchEndCallback=e._applyStrategy.bind(Gt()(e)),e.postMouseDownCallback=e._startOutliningRegion.bind(Gt()(e)),e.mouseClickCallback=e._startOutliningRegion.bind(Gt()(e)),e.mouseDragCallback=e._setHandlesAndUpdate.bind(Gt()(e)),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(Gt()(e)),e.mouseUpCallback=e._applyStrategy.bind(Gt()(e)),e}return v()(t,e),s()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.element,o=We.getColorIfActive({active:!0}),i=dt(n.canvasContext.canvas);Ge(i,function(e){ut(e,a,t.handles.start,t.handles.end,{color:o})})}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return jo(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),p.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;this.handles.end=n,p.cornerstone.updateImage(t)}},{key:"_applyStrategy",value:function(e){jo(this.handles.start)||jo(this.handles.end)||(e.detail.handles=this.handles,zo(e,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),t}(le),jo=function(e){return 0===Object.keys(e).length&&e.constructor===Object},zo=function(e,t){var n=e.detail,a=n.image,o=n.element,i=e.detail.handles,r=i.start,s=i.end,l=_Mathmin(r.x,s.x),c=_Mathmin(r.y,s.y),u=_Mathabs(r.x-s.x),d=_Mathabs(r.y-s.y);l=be(l,0,a.width),c=be(c,0,a.height),u=_Mathfloor(_Mathmin(u,_Mathabs(a.width-l))),d=_Mathfloor(_Mathmin(d,_Mathabs(a.height-c)));var h=Vo(o,l,c,u,d),v=Wo(h,a.minPixelValue,a.maxPixelValue),g=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),g.voi.windowWidth=_Mathmax(_Mathabs(v.max-v.min),t.minWindowWidth),g.voi.windowCenter=v.mean,p.cornerstone.setViewport(o,g),p.cornerstone.updateImage(o)},Wo=function(e,t,n){var a=e.length,o=n,i=t,r=0;if(2>a)return{min:o,max:i,mean:(t+n)/2};for(var s=0,l;s<a;s++){l=e[s];o=_Mathmin(o,l),i=_Mathmax(i,l),r+=l}return{min:o,max:i,mean:r/a}},Go=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Wwwc",strategies:{basicLevelingStrategy:Yo},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0},svgCursor:Nt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e}return v()(t,e),s()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),p.cornerstone.setViewport(e.detail.element,e.detail.viewport)}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),p.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(le);function Yo(e,t){var n=t.orientation,a=e.detail,o=(a.image.maxPixelValue*a.image.slope+a.image.intercept-(a.image.minPixelValue*a.image.slope+a.image.intercept))/1024,i=a.deltaPoints.page.x*o,r=a.deltaPoints.page.y*o;0===n?(a.viewport.voi.windowWidth+=i,a.viewport.voi.windowCenter+=r):(a.viewport.voi.windowWidth+=r,a.viewport.voi.windowCenter+=i)}var Xo=function(e,t,n){var a=n.maxScale,o=n.minScale,i=Math.log(e.scale)/0.5306282510621704+t,r=_Mathpow(1.7,i);return e.scale=a&&r>a?a:o&&r<o?o:r,e},Ko={changeViewportScale:Xo,correctShift:function(e,t){var n=t.hflip,a=t.vflip,o=t.rotation;if(e.x*=n?-1:1,e.y*=a?-1:1,0!==o){var i=o*_MathPI/180,r=_Mathcos(i),s=_Mathsin(i),l=e.x*r-e.y*s,c=e.x*s+e.y*r;e.x=l,e.y=c}return e}},Zo=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a=Object.assign({name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}},n);return(e=c()(this,d()(t).call(this,a))).initialConfiguration=a,e}return v()(t,e),s()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=t.spinY,i=this.configuration,r=i.invert,s=i.maxScale,l=i.minScale,c=Xo(a,r?o/4:-o/4,{maxScale:s,minScale:l});p.cornerstone.setViewport(n,c)}}]),t}(le),$o=Ko.correctShift,Jo=Ko.changeViewportScale,Qo=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a={name:"Zoom",strategies:{default:ti,translate:ni,zoomToCenter:ai},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20},svgCursor:Bt},o=Object.assign(a,n);return(e=c()(this,d()(t).call(this,o))).initialConfiguration=o,e}return v()(t,e),s()(t,[{key:"touchDragCallback",value:function(e){ei.call(this,e)}},{key:"mouseDragCallback",value:function(e){ei.call(this,e)}}]),t}(le),ei=function(e){if(!e.detail.deltaPoints.page.y)return!1;this.applyActiveStrategy(e,this.configuration),p.cornerstone.setViewport(e.detail.element,e.detail.viewport)};function ti(e,t){var n=t.invert,a=t.maxScale,o=t.minScale,i=e.detail.deltaPoints.page.y,r=n?-i/100:i/100,s=e.detail,l=s.element,c=s.viewport,u=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],v=u[2],g=u[3],f=Jo(c,r,{maxScale:a,minScale:o});p.cornerstone.setViewport(l,f);var m=p.cornerstone.pageToPixel(l,d,h),y={x:v-m.x,y:g-m.y};y=$o(y,f),c.translation.x-=y.x,c.translation.y-=y.y}function ni(e,t){var n=t.invert,a=t.preventZoomOutsideImage,o=t.maxScale,i=t.minScale,r=e.detail.deltaPoints.page.y,s=n?-r/100:r/100,l=e.detail.image,c=e.detail.viewport,u=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],v=Jo(c,s,{maxScale:o,minScale:i}),g={x:0,y:0};if(0>s)3>v.scale&&(.01>_Mathabs(v.translation.x)?v.translation.x=0:g.x=v.translation.x/8,.01>_Mathabs(v.translation.y)?v.translation.y=0:g.y=v.translation.y/8);else{a&&Ee(e.detail.startPoints.image,l);var f={x:l.width/2-d,y:l.height/2-h};f=$o(f,v);var m={x:v.translation.x-f.x,y:v.translation.y-f.y};.01>_Mathabs(m.x)?v.translation.x=f.x:g.x=m.x/8,.01>_Mathabs(m.y)?v.translation.y=f.y:g.y=m.y/8}v.translation.x-=g.x,v.translation.y-=g.y}function ai(e,t){var n=t.invert,a=t.maxScale,o=t.minScale,i=e.detail.deltaPoints.page.y,r=n?-i/100:i/100,s=e.detail.viewport;Jo(s,r,{maxScale:a,minScale:o})}var oi=Ko.correctShift,ii=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var a=Object.assign({name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}},n);return(e=c()(this,d()(t).call(this,a))).initialConfiguration=a,e}return v()(t,e),s()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=t.scaleChange,i=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],r=i[0],s=i[1],l=i[2],c=i[3],u=this.configuration,d=u.maxScale,h=u.minScale;a.scale+=o*a.scale,d&&a.scale>d?a.scale=d:h&&a.scale<h&&(a.scale=h),p.cornerstone.setViewport(n,a);var v=p.cornerstone.pageToPixel(n,r,s),g={x:l-v.x,y:c-v.y};g=oi(g,a),a.translation.x-=g.x,a.translation.y-=g.y,p.cornerstone.setViewport(n,a)}}]),t}(le),ri=function(e){return{page:si(e.page),image:si(e.image),client:si(e.client),canvas:si(e.canvas)}};function si(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{x:e.x,y:e.y}}var li,ci={48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",13:"RETURN",8:"BACKSPACE",9:"TAB",46:"DELETE",12:"DELETE",27:"ESCAPE",20:"CAPSLOCK",173:"-",189:"-",109:"-",61:"+",187:"+",107:"+",219:"[",221:"]",59:";",186:";",188:",",190:".",199:"/"},ui={"base/BaseTool":le,"base/BaseAnnotationTool":Ne,"base/BaseBrushTool":ba,"tools/cursors/MouseCursor":xt,"tools/cursors":a,"manipulators/anyHandlesOutsideImage":Ce,"manipulators/getHandleNearImagePoint":xe,"manipulators/handleActivator":Te,"manipulators/moveAllHandles":ke,"manipulators/moveHandle":Pe,"manipulators/moveNewHandle":Le,"manipulators/moveHandleNearImagePoint":Re,"manipulators/findHandleDataNearImagePoint":He,"manipulators/moveAnnotation":Ue,"mixins/activeOrDisabledBinaryTool":re.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":re.enabledOrDisabledBinaryTool,"drawing/getNewContext":dt,"drawing/draw":Ge,"drawing/path":Ye,"drawing/setShadow":vt,"drawing/drawLine":Xe,"drawing/drawLines":function(e,t,n,a){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"pixel";Ye(e,a,function(e){n.forEach(function(n){var a=n.start,i=n.end;if("pixel"===o){var r=p.cornerstone;a=r.pixelToCanvas(t,a),i=r.pixelToCanvas(t,i)}e.moveTo(a.x,a.y),e.lineTo(i.x,i.y)})})},"drawing/drawJoinedLines":Ke,"drawing/drawCircle":$e,"drawing/drawEllipse":Je,"drawing/drawRect":ut,"drawing/fillOutsideRect":function(e,t,n,a,o){if("pixel"===(5<arguments.length&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=p.cornerstone;n=i.pixelToCanvas(t,n),a=i.pixelToCanvas(t,a)}var r=_Mathmin(n.x,a.x),s=_Mathmin(n.y,a.y),l=_Mathabs(n.x-a.x),c=_Mathabs(n.y-a.y);Ye(e,o,function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(r+l,s,-l,c)})},"drawing/drawTextBox":lt,"drawing/drawArrow":Ze,"drawing/fillBox":rt,"drawing/fillTextLines":it,"drawing/drawLink":et,"drawing/drawLinkedTextBox":ct,"drawing/drawHandles":Qe,"drawing/textBoxWidth":st,"util/getLuminance":Vo,"util/copyPoints":ri,"util/calculateSUV":En,"util/setContextToDisplayFontSize":function(e,t,n){return p.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}},"util/scrollToIndex":Ro,"util/scroll":Ho,"util/roundToDecimal":pt,"util/projectPatientPointToImagePlane":Ha,"util/imagePointToPatientPoint":Ua,"util/planePlaneIntersection":Na,"util/pointInsideBoundingBox":pe,"util/makeUnselectable":function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")},"util/getRGBPixels":la,"util/getDefaultSimultaneousRequests":Mo,"util/getMaxSimultaneousRequests":Eo,"util/getBrowserInfo":bo,"util/isMobileDevice":function(){return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/.test(navigator.userAgent)},"util/angleBetweenPoints":co,"util/getKeyFromKeyCode":function(e){return ci[e]},"util/numbersWithCommas":_n,"util/lineSegDistance":mt,"util/triggerEvent":C,"util/convertToVectro3":Ra,"util/ellipseUtils":In,"util/freehandUtils":$n,"util/brushUtils":Ea,"util/zoomUtils":Ko},di=function(e){return ui[e]},hi=V("eventListeners:mouseEventListeners"),vi=!0,gi=200;function fi(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2;}return 0}function mi(){vi=!1}function pi(e){var t=e.currentTarget,n=p.cornerstone.getEnabledElement(t);if(n.image){var a=T.MOUSE_DOUBLE_CLICK,o={page:p.cornerstoneMath.point.pageToPoint(e),image:p.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=p.cornerstone.pixelToCanvas(t,o.image);var i=ri(o);hi.log("double-click: %o",fi(e)),C(t,a,{event:e,buttons:fi(e),viewport:p.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:i,currentPoints:o,deltaPoints:{x:0,y:0},type:a})}}function yi(e){var t=e.currentTarget,n=p.cornerstone.getEnabledElement(t);if(n.image){li=setTimeout(mi,gi),t.removeEventListener("mousemove",xi);var a={page:p.cornerstoneMath.point.pageToPoint(e),image:p.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};a.canvas=p.cornerstone.pixelToCanvas(t,a.image);var o=ri(a),i={event:e,buttons:fi(e),viewport:p.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:o,currentPoints:a,deltaPoints:{x:0,y:0},type:T.MOUSE_DOWN};C(i.element,T.MOUSE_DOWN,i)&&(i.type=T.MOUSE_DOWN_ACTIVATE,C(i.element,T.MOUSE_DOWN_ACTIVATE,i)),document.addEventListener("mousemove",r),document.addEventListener("mouseup",function e(i){clearTimeout(li);var s=T.MOUSE_UP;vi&&(s=T.MOUSE_CLICK);var l={page:p.cornerstoneMath.point.pageToPoint(i),image:p.cornerstone.pageToPixel(t,i.pageX,i.pageY),client:{x:i.clientX,y:i.clientY}};l.canvas=p.cornerstone.pixelToCanvas(t,l.image);var c={page:p.cornerstoneMath.point.subtract(l.page,o.page),image:p.cornerstoneMath.point.subtract(l.image,o.image),client:p.cornerstoneMath.point.subtract(l.client,o.client),canvas:p.cornerstoneMath.point.subtract(l.canvas,o.canvas)};hi.log("mouseup: %o",fi(i));var u={event:i,buttons:fi(i),viewport:p.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:o,currentPoints:l,deltaPoints:c,type:s};C(u.element,s,u),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e),t.addEventListener("mousemove",xi),vi=!0})}function r(e){var i=T.MOUSE_DRAG,r={page:p.cornerstoneMath.point.pageToPoint(e),image:p.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=p.cornerstone.pixelToCanvas(t,r.image);var s={page:p.cornerstoneMath.point.subtract(r.page,o.page),image:p.cornerstoneMath.point.subtract(r.image,o.image),client:p.cornerstoneMath.point.subtract(r.client,o.client),canvas:p.cornerstoneMath.point.subtract(r.canvas,o.canvas)};hi.log("mousemove: %o",fi(e));var l={buttons:fi(e),viewport:p.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:o,currentPoints:r,deltaPoints:s,type:i,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};C(l.element,i,l),o=ri(r)}}function xi(e){var t=e.currentTarget,n=p.cornerstone.getEnabledElement(t);if(n.image){var a=T.MOUSE_MOVE,o={page:p.cornerstoneMath.point.pageToPoint(e),image:p.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=p.cornerstone.pixelToCanvas(t,o.image);var i=ri(o),r={page:p.cornerstoneMath.point.pageToPoint(e),image:p.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=p.cornerstone.pixelToCanvas(t,r.image);var s={page:p.cornerstoneMath.point.subtract(r.page,i.page),image:p.cornerstoneMath.point.subtract(r.image,i.image),client:p.cornerstoneMath.point.subtract(r.client,i.client),canvas:p.cornerstoneMath.point.subtract(r.canvas,i.canvas)};C(t,a,{viewport:p.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:i,currentPoints:r,deltaPoints:s,type:a}),i=ri(r)}}function Ti(e){e.removeEventListener("mousedown",yi),e.removeEventListener("mousemove",xi),e.removeEventListener("dblclick",pi)}var Ci={enable:function(e){Ti(e),e.addEventListener("mousedown",yi),e.addEventListener("mousemove",xi),e.addEventListener("dblclick",pi)},disable:Ti},bi=function(e){var t=0,n=0,a=0,o=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),a=10*t,o=10*n,"deltaY"in e&&(o=e.deltaY),"deltaX"in e&&(a=e.deltaX),(a||o)&&e.deltaMode&&(1===e.deltaMode?(a*=40,o*=40):(a*=800,o*=800)),a&&!t&&(t=1>a?-1:1),o&&!n&&(n=1>o?-1:1),{spinX:t,spinY:n,pixelX:a,pixelY:o}};function Ei(e){var t=e.currentTarget,n=p.cornerstone.getEnabledElement(t);if(n.image){e.preventDefault();var a=e.pageX,o=e.pageY,i=p.cornerstone.pageToPixel(t,a,o),r=bi(e),s=r.spinX,l=r.spinY,c=r.pixelX,u=r.pixelY,d=0>l?-1:1,h={element:t,viewport:p.cornerstone.getViewport(t),detail:e,image:n.image,direction:d,spinX:s,spinY:l,pixelX:c,pixelY:u,pageX:a,pageY:o,imageX:i.x,imageY:i.y};C(t,T.MOUSE_WHEEL,h)}}function Mi(e){e.removeEventListener("wheel",Ei,{passive:!1})}var wi,ki,Ii={enable:function(e){Mi(e),e.addEventListener("wheel",Ei,{passive:!1})},disable:Mi},_i=2e3,Si={mouse:0,touch:1};function Pi(e,t){var n=Date.now();if(e!==wi){if(n-ki<=_i)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;wi=e}ki=n}var Oi=Pi.bind(null,Si.mouse),Di=Pi.bind(null,Si.touch);function Li(e,t,n){var a=n?Oi:Di;t.forEach(function(t){e.addEventListener(t,a,{passive:!1})})}function Ai(e,t,n){var a=n?Oi:Di;t.forEach(function(t){e.removeEventListener(t,a)})}var Ri=["mousedown","mouseup"],Hi=["touchstart","touchend"];function Ui(e){Ai(e,Ri,Si.mouse),Ai(e,Hi,Si.touch)}var Ni,Bi,Fi,Vi,qi,ji,zi,Wi,Gi,Yi={enable:function(e){Ui(e),Li(e,Ri,Si.mouse),Li(e,Hi,Si.touch)},disable:Ui},Xi=1,Ki=0,Zi=!1,$i=!1,Ji=700,Qi=5,er="touchInput";function tr(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=p.cornerstone.getEnabledElement(t);if(n.image){var a,o,i,r;switch(e.preventDefault(),(e.pointers&&1<e.pointers.length||e.touches&&1<e.touches.length)&&($i=!1,clearTimeout(zi)),e.type){case"tap":$i=!1,clearTimeout(zi),(Bi={page:p.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:p.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=p.cornerstone.pixelToCanvas(t,Bi.image),a=T.TAP,qi={event:e,viewport:p.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Bi,type:a,isTouchEvent:!0},C(t,a,qi);break;case"doubletap":$i=!1,clearTimeout(zi),(Bi={page:p.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:p.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=p.cornerstone.pixelToCanvas(t,Bi.image),a=T.DOUBLE_TAP,qi={event:e,viewport:p.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Bi,type:a,isTouchEvent:!0},C(t,a,qi);break;case"pinchstart":$i=!1,clearTimeout(zi),Xi=1;break;case"pinchmove":if($i=!1,clearTimeout(zi),!0===Zi){Xi=e.scale,Zi=!1;break}o=(e.scale-Xi)/Xi,(Ni={page:e.center,image:p.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=p.cornerstone.pixelToCanvas(t,Ni.image),a=T.TOUCH_PINCH,qi={event:e,startPoints:Ni,viewport:p.cornerstone.getViewport(t),image:n.image,element:t,direction:1>e.scale?1:-1,scaleChange:o,type:a,isTouchEvent:!0},C(t,a,qi),Xi=e.scale;break;case"touchstart":Xi=1,clearTimeout(zi),clearTimeout(ji),ji=setTimeout(function(){(Ni={page:p.cornerstoneMath.point.pageToPoint(e.touches[0]),image:p.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=p.cornerstone.pixelToCanvas(t,Ni.image),a=T.TOUCH_START,1<e.touches.length&&(a=T.MULTI_TOUCH_START),qi={event:e,viewport:p.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Ni,currentPoints:Ni,type:a,isTouchEvent:!0},!0===C(t,a,qi)&&(a=T.TOUCH_START_ACTIVE,1<e.touches.length&&(a=T.MULTI_TOUCH_START_ACTIVE),qi.type=a,C(t,a,qi)),Fi=ri(Ni)},50),$i=!0,Wi=0,zi=setTimeout(function(){$i&&((Bi={page:p.cornerstoneMath.point.pageToPoint(e.touches[0]),image:p.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=p.cornerstone.pixelToCanvas(t,Ni.image),a=T.TOUCH_PRESS,qi={event:e,viewport:p.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Bi,type:a,isTouchEvent:!0},C(t,a,qi))},Ji);break;case"touchend":Xi=1,$i=!1,clearTimeout(zi),setTimeout(function(){(Ni={page:p.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:p.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=p.cornerstone.pixelToCanvas(t,Ni.image),a=T.TOUCH_END,qi={event:e,viewport:p.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Ni,currentPoints:Ni,type:a,isTouchEvent:!0},C(t,a,qi)},50);break;case"panmove":i={x:e.deltaX-Gi.x,y:e.deltaY-Gi.y},Gi={x:e.deltaX,y:e.deltaY},(Bi={page:{x:Fi.page.x+i.x,y:Fi.page.y+i.y},image:p.cornerstone.pageToPixel(t,Fi.page.x+i.x,Fi.page.y+i.y),client:{x:Fi.client.x+i.x,y:Fi.client.y+i.y}}).canvas=p.cornerstone.pixelToCanvas(t,Bi.image),Vi={page:p.cornerstoneMath.point.subtract(Bi.page,Fi.page),image:p.cornerstoneMath.point.subtract(Bi.image,Fi.image),client:p.cornerstoneMath.point.subtract(Bi.client,Fi.client),canvas:p.cornerstoneMath.point.subtract(Bi.canvas,Fi.canvas)},(Wi+=_Mathsqrt(Vi.page.x*Vi.page.x+Vi.page.y*Vi.page.y))>Qi&&($i=!1,clearTimeout(zi)),a=T.TOUCH_DRAG,1<e.pointers.length&&(a=T.MULTI_TOUCH_DRAG),qi={viewport:p.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Ni,lastPoints:Fi,currentPoints:Bi,deltaPoints:Vi,numPointers:e.pointers.length,type:a,isTouchEvent:!0},C(t,a,qi),Fi=ri(Bi);break;case"panstart":Gi={x:e.deltaX,y:e.deltaY},(Bi={page:p.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:p.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=p.cornerstone.pixelToCanvas(t,Bi.image),Fi=ri(Bi);break;case"panend":if($i=!1,clearTimeout(zi),!Fi)return!1;(Bi={page:p.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:p.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=p.cornerstone.pixelToCanvas(t,Bi.image),Vi={page:p.cornerstoneMath.point.subtract(Bi.page,Fi.page),image:p.cornerstoneMath.point.subtract(Bi.image,Fi.image),client:p.cornerstoneMath.point.subtract(Bi.client,Fi.client),canvas:p.cornerstoneMath.point.subtract(Bi.canvas,Fi.canvas)},a=T.TOUCH_DRAG_END,qi={event:e.srcEvent,viewport:p.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Ni,lastPoints:Fi,currentPoints:Bi,deltaPoints:Vi,type:a,isTouchEvent:!0},C(t,a,qi),2===e.pointers.length-e.changedPointers.length&&(Zi=!0);break;case"rotatemove":$i=!1,clearTimeout(zi),r=e.rotation-Ki,Ki=e.rotation,a=T.TOUCH_ROTATE,qi={event:e.srcEvent,viewport:p.cornerstone.getViewport(t),image:n.image,element:t,rotation:r,type:a},C(t,a,qi);}return!1}}function nr(e){Yi.disable(e);["touchstart","touchend"].forEach(function(t){e.removeEventListener(t,tr)});var t=Fa(er,e).hammer;t&&t.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",tr)}var ar={enable:function(e){nr(e);var t=p.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},a=new t.Manager(e,n),o={pointers:0,direction:t.DIRECTION_ALL,threshold:0},i=new t.Pan(o),r=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});r.recognizeWith(i),r.recognizeWith(s),s.recognizeWith(i);var l=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});l.recognizeWith(i),a.add([l,i,s,r]),a.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",tr),Yi.enable(e),["touchstart","touchend"].forEach(function(t){e.addEventListener(t,tr,{passive:!1})});var c=Fa(er,e);c.hammer=a,Va(er,e,c)},disable:nr},or=function(e,t,n){return t.filter(function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])})};"createImageBitmap"in window||(window.createImageBitmap=function(e){return new Promise(function(t){var n=document.createElement("img");n.addEventListener("load",function(){t(this)});var a=document.createElement("canvas");a.width=e.width,a.height=e.height,a.getContext("2d").putImageData(e,0,0,0,0,a.width,a.height),n.src=a.toDataURL()})});var ir=D.modules.brush,rr=ir.state,sr=ir.getters,lr=ir.setters;function cr(e,t,n){var a=e.detail.element,o=n.toolData,i=n.visibleSegmentations;return!(!o.data[t]||!o.data[t].pixelData)&&(!!i[t]||rr.drawColorId===t&&0<or(a,D.state.tools).filter(function(e){return e instanceof ba}).length)}function ur(e,t,n){var a=n.toolData,o=n.imageBitmapCache,i=n.visibleSegmentations;o&&o[t]&&function(e,t,n){var a=e.detail,o=dt(a.canvasContext.canvas),i=p.cornerstone.pixelToCanvas(a.element,{x:0,y:0}),r=p.cornerstone.pixelToCanvas(a.element,{x:a.image.width,y:0}),s=p.cornerstone.pixelToCanvas(a.element,{x:a.image.width,y:a.image.height}),l=p.cornerstoneMath.point.distance(i,r),c=p.cornerstoneMath.point.distance(r,s),u=a.canvasContext.canvas,d=a.viewport;o.imageSmoothingEnabled=!1,o.globalAlpha=function(e){if(e)return rr.alpha;return rr.hiddenButActiveAlpha}(n),gt(o,u,d);var h={x:d.translation.x*d.scale,y:d.translation.y*d.scale};o.drawImage(t,u.width/2-l/2+h.x,u.height/2-c/2+h.y,l,c),o.globalAlpha=1,ft(o)}(e,o[t],i[t]),a.data[t].invalidated&&function(e,t,n){var a=e.detail,o=a.element,i=p.cornerstone.getEnabledElement(o),r=t.data[n].pixelData;if(!r)return;var s=rr.colorMapId,l=[[0,0,0,0],p.cornerstone.colors.getColormap(s).getColor(n)],c=new ImageData(a.image.width,a.image.height),u={stats:{},minPixelValue:0,getPixelData:function(){return r}};p.cornerstone.storedPixelDataToCanvasImageDataColorLUT(u,l,c.data),window.createImageBitmap(c).then(function(e){lr.imageBitmapCacheForElement(i.uuid,n,e),t.data[n].invalidated=!1,p.cornerstone.updateImage(a.element)})}(e,a,t)}var dr=function(e){var t=e.detail.element,n=S.tools.filter(function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)});0<n.filter(function(e){return e instanceof ba}).length&&function(e){var t=e.detail.element,n=ba.getNumberOfColors(),a=ve(t,ba.getReferencedToolDataName());if(a)for(var o=p.cornerstone.getEnabledElement(t).uuid,i={visibleSegmentations:sr.visibleSegmentationsForElement(o),imageBitmapCache:sr.imageBitmapCacheForElement(o),toolData:a},r=0;r<n;r++)cr(e,r,i)&&ur(e,r,i)}(e),n.forEach(function(t){t.renderToolData&&t.renderToolData(e)})},hr=function(e){e.addEventListener(p.cornerstone.EVENTS.IMAGE_RENDERED,dr)},vr=function(e){e.removeEventListener(p.cornerstone.EVENTS.IMAGE_RENDERED,dr)},gr=function(e){return e.filter(function(e){return!(e.isMultiPartTool||e instanceof Ne||e instanceof ba)})},fr=function(e,t,n){if(S.isToolLocked)return!1;var a=n.detail.element,o=S.tools.filter(function(t){return t.supportedInteractionTypes.includes(e)});if(o=(o=or(a,o,e)).filter(function(e){return"function"==typeof e[t]}),S.isMultiPartToolActive&&(o=gr(o)),0===o.length)return!1;o[0][t](n)},mr=function(e,t,n){var a="mouse"===(3<arguments.length&&void 0!==arguments[3]?arguments[3]:"mouse")?S.clickProximity:S.touchProximity;return t.filter(function(t){for(var o=ve(e,t.name),i=0;i<o.data.length;i++)if(void 0!==xe(e,o.data[i].handles,n,a))return!0;return!1})},pr=function(e,t){return t.filter(function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)})},yr=function(e,t){return t.filter(function(t){var n=ve(e,t.name);return n&&0<n.data.length})},xr=function(e){if(!S.isToolLocked){var t=e.detail,n=e.detail.element,a=e.detail.currentPoints.canvas,o=pr(n,P.mouseTools()),i=o.filter(function(e){return"active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive});if(S.isMultiPartToolActive&&(i=gr(i)),0<i.length){var r=i.find(function(e){return"function"==typeof e.preMouseDownCallback});if(r)if(r.preMouseDownCallback(e))return}if(!S.isMultiPartToolActive){var s=yr(n,o),l=mr(n,s,a,"mouse");if(0<l.length){var c=l[0],u=ve(n,c.name),d=He(n,u,c.name,a),h=d.handle,v=d.data;c.handleSelectedCallback(e,v,h,"mouse")}else{var g=o.filter(function(e){var t=ve(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some(function(t){return e.pointNearTool(n,t,a,"mouse")})});if(0<g.length){var f=g[0],m=ve(n,f.name).data.find(function(e){return f.pointNearTool(n,e,a)});f.toolSelectedCallback(e,m,"mouse")}else if(0<i.length){var p=i.find(function(e){return"function"==typeof e.postMouseDownCallback});if(p)if(p.postMouseDownCallback(e))return}}}}},Tr=V("eventDispatchers:mouseEventHandlers"),Cr=function(e){if(!S.isToolLocked){var t=e.detail,n=t.element,a=or(n,P.mouseTools());if(a=a.filter(function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive}),S.isMultiPartToolActive&&(a=gr(a)),0!==a.length){var o=a[0];if("function"==typeof o.preMouseDownActivateCallback)if(o.preMouseDownActivateCallback(e))return;S.isMultiPartToolActive||(o.addNewMeasurement?o.addNewMeasurement(e,"mouse"):o instanceof Ne&&function(e,t){Tr.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,a=n.element,o=t.createNewMeasurement(n);o&&(he(a,t.name,o),p.cornerstone.updateImage(a),(1===Object.keys(o.handles).length?Pe:Le)(n,t.name,o,o.handles.end,t.options,"mouse"))}(e,o))}}},br=function(e){if(!S.isToolLocked){var t,n=e.detail,a=n.element;if(t=(t=(t=or(a,P.mouseTools())).filter(function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive})).filter(function(e){return"function"==typeof e.mouseDragCallback}),S.isMultiPartToolActive&&(t=gr(t)),0!==t.length)t[0].mouseDragCallback(e)}},Er=function(e){if(!S.isToolLocked&&!S.isMultiPartToolActive){var t,n=e.detail,a=n.element,o=n.currentPoints;S.mousePositionImage=o.image;var i=(t=pr(a,P.mouseTools())).filter(function(e){return"active"===e.mode&&e.options.isMouseActive}),r=!1;0<i.length&&(r=i.some(function(e){return e.updateOnMouseMove})),t=yr(a,t);for(var s=0,l;s<t.length;s++){l=t[s];"function"==typeof l.mouseMoveCallback&&(r=l.mouseMoveCallback(e)||r)}!0===r&&p.cornerstone.updateImage(a)}},Mr=fr.bind(null,"Mouse","mouseClickCallback"),wr=fr.bind(null,"Mouse","doubleClickCallback"),kr=fr.bind(null,"Mouse","mouseUpCallback"),Ir=fr.bind(null,"MouseWheel","mouseWheelCallback"),_r=function(e){e.addEventListener(T.MOUSE_CLICK,Mr),e.addEventListener(T.MOUSE_DOWN,xr),e.addEventListener(T.MOUSE_DOWN_ACTIVATE,Cr),e.addEventListener(T.MOUSE_DOUBLE_CLICK,wr),e.addEventListener(T.MOUSE_DRAG,br),e.addEventListener(T.MOUSE_MOVE,Er),e.addEventListener(T.MOUSE_UP,kr),e.addEventListener(T.MOUSE_WHEEL,Ir)},Sr=function(e){e.removeEventListener(T.MOUSE_CLICK,Mr),e.removeEventListener(T.MOUSE_DOWN,xr),e.removeEventListener(T.MOUSE_DOWN_ACTIVATE,Cr),e.removeEventListener(T.MOUSE_DOUBLE_CLICK,wr),e.removeEventListener(T.MOUSE_DRAG,br),e.removeEventListener(T.MOUSE_MOVE,Er),e.removeEventListener(T.MOUSE_UP,kr),e.removeEventListener(T.MOUSE_WHEEL,Ir)},Pr=function(e){if(S.isToolLocked)return!1;var t=e.detail.element,n=S.tools.filter(function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)});if(0===n.length)return!1;n.forEach(function(t){t.newImageCallback&&t.newImageCallback(e)}),0<n.filter(function(e){return e instanceof ba}).length&&function(e){var t=e.detail,n=t.element,a=ve(n,ba.getReferencedToolDataName());a||(he(n,ba.getReferencedToolDataName(),{}),a=ve(n,ba.getReferencedToolDataName()));for(var o=ba.getNumberOfColors(),i=0;i<o;i++)a.data[i]&&(a.data[i].invalidated=!0);p.cornerstone.updateImage(t.element)}(e)},Or=function(e){e.addEventListener(p.cornerstone.EVENTS.NEW_IMAGE,Pr)},Dr=function(e){e.removeEventListener(p.cornerstone.EVENTS.NEW_IMAGE,Pr)},Lr=function(e){if(S.isToolLocked)return!1;var t=e.detail,n=t.element,a=t.numPointers,o=S.tools.filter(function(e){return e.supportedInteractionTypes.includes("MultiTouch")});if(o=(o=or(n,o,"MultiTouch")).filter(function(e){return"function"==typeof e.multiTouchDragCallback&&a===e.configuration.touchPointers}),S.isMultiPartToolActive&&(o=gr(o)),0===o.length)return!1;o[0].multiTouchDragCallback(e)},Ar=V("eventDispatchers:touchEventHandlers"),Rr=function(e){if(!S.isToolLocked&&!S.isMultiPartToolActive){var t=e.detail.element,n=or(t,P.touchTools());if(0!==(n=n.filter(function(e){return e.options.isTouchActive})).length){var a=n[0];a&&a.addNewMeasurement?a.addNewMeasurement(e,"touch"):a instanceof Ne&&function(e,t){Ar.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,a=n.element,o=t.createNewMeasurement(n);if(o){if(he(a,t.name,o),1===Object.keys(o.handles).length&&n.type===T.TAP)return o.active=!1,o.handles.end.active=!1,o.handles.end.highlight=!1,o.invalidated=!0,(S.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&Ce(n,o.handles)&&ge(a,t.name,o),void p.cornerstone.updateImage(a);p.cornerstone.updateImage(a),Le(n,t.name,o,o.handles.end,t.options,"touch")}}(e,a)}}},Hr=function(e){if(e)for(var t=0,n;t<e.data.length;t++){n=e.data[t];n.active=!1,n.handles&&Ur(n.handles)}};function Ur(e){Object.keys(e).forEach(function(t){e[t].active=!1})}var Nr=function(e){if(!S.isToolLocked&&!S.isMultiPartToolActive){var t,n=e.detail.element,a=e.detail.currentPoints.canvas;t=or(n,P.touchTools());var o=(t=yr(n,t)).filter(function(e){for(var t=ve(n,e.name),o=0;o<t.data.length;o++)if(void 0!==xe(n,t.data[o].handles,a,28))return!0;return!1});if(0<o.length){var i=o[0],r=ve(n,i.name),s=r.data.find(function(e){return void 0!==xe(n,e.handles,a,28)});r.data.active=!0,s.active=!0,p.cornerstone.updateImage(n);var l=Object.assign({},{doneMovingCallback:function(){Hr(r)}},i.options);return Pe(e.detail,i.name,r.data,s,l,"touch"),e.stopImmediatePropagation(),void e.preventDefault()}var c=t.filter(function(e){var t=ve(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some(function(t){return e.pointNearTool(n,t,a)})});if(0<c.length){var u=c[0],d=ve(n,u.name),h=d.data.find(function(e){return u.pointNearTool(n,e,a)});h.active=!0,p.cornerstone.updateImage(n);var v=Object.assign({},{doneMovingCallback:function(){Hr(d)}},u.options);return ke(e.detail,u.name,h,null,v,"touch"),e.stopImmediatePropagation(),void e.preventDefault()}var g=or(n,P.touchTools());return 0<g.length&&g[0].touchStartActiveCallback?g[0].touchStartActiveCallback(e):Rr(e),!1}},Br=function(e){if(!S.isToolLocked){var t=e.detail,n=t.element,a=t.startPoints.canvas,o=pr(n,P.touchTools()),i=o.filter(function(e){return"active"===e.mode&&e.options.isTouchActive});if(S.isMultiPartToolActive&&(i=gr(i)),0<i.length){var r=i.find(function(e){return"function"==typeof e.preTouchStartCallback});if(r)if(r.preTouchStartCallback(e))return}if(!S.isMultiPartToolActive){var s=yr(n,o),l=mr(n,s,a,"touch");if(0<l.length){var c=l[0],u=ve(n,c.name),d=He(n,u,c.name,a,"touch"),h=d.handle,v=d.data;c.handleSelectedCallback(e,v,h,"touch")}else{var g=s.filter(function(e){var t=ve(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some(function(t){return e.pointNearTool(n,t,a,"touch")})});if(0<g.length){var f=g[0],m=ve(n,f.name).data.find(function(e){return f.pointNearTool(n,e,a)});f.toolSelectedCallback(e,m,"touch")}else if(0<i.length){var p=i.find(function(e){return"function"==typeof e.postTouchStartCallback});if(p)if(p.postTouchStartCallback(e))return}}}}},Fr=fr.bind(null,"DoubleTap","doubleTapCallback"),Vr=fr.bind(null,"Touch","touchDragCallback"),qr=fr.bind(null,"Touch","touchEndCallback"),jr=fr.bind(null,"TouchPinch","touchPinchCallback"),zr=fr.bind(null,"Touch","touchPressCallback"),Wr=fr.bind(null,"TouchRotate","touchRotateCallback"),Gr=function(e){e.addEventListener(T.TAP,Nr),e.addEventListener(T.TOUCH_START,Br,{passive:!1}),e.addEventListener(T.TOUCH_DRAG,Vr,{passive:!1}),e.addEventListener(T.TOUCH_END,qr),e.addEventListener(T.TOUCH_START_ACTIVE,Rr),e.addEventListener(T.TOUCH_PRESS,zr),e.addEventListener(T.DOUBLE_TAP,Fr),e.addEventListener(T.TOUCH_PINCH,jr),e.addEventListener(T.TOUCH_ROTATE,Wr),e.addEventListener(T.MULTI_TOUCH_DRAG,Lr)},Yr=function(e){e.removeEventListener(T.TAP,Nr),e.removeEventListener(T.TOUCH_START,Br),e.removeEventListener(T.TOUCH_DRAG,Vr),e.removeEventListener(T.TOUCH_END,qr),e.removeEventListener(T.TOUCH_START_ACTIVE,Rr),e.removeEventListener(T.TOUCH_PRESS,zr),e.removeEventListener(T.DOUBLE_TAP,Fr),e.removeEventListener(T.TOUCH_PINCH,jr),e.removeEventListener(T.TOUCH_ROTATE,Wr),e.removeEventListener(T.MULTI_TOUCH_DRAG,Lr)},Xr=V("addTool"),Kr=function(e,t,n){var a=new t(n);L(e,a.name)?Xr.warn("%s has already been added to the target element",a.name):(a.element=e,D.state.tools.push(a))},Zr=function(e,t){$r(e,t),D.state.enabledElements.forEach(function(n){Kr(n,e,t)})},$r=function(e,t){if(D.modules.globalConfiguration.state.globalToolSyncEnabled){var n=new e(t);void 0!==D.state.globalTools[n.name]?Xr.warn("%s has already been added globally",n.name):D.state.globalTools[n.name]={tool:e,configuration:t,activeBindings:[]}}},Jr=V("internals:addEnabledElement"),Qr=function(e){Jr.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;hr(t),Or(t),D.modules.globalConfiguration.state.mouseEnabled&&(Ci.enable(t),Ii.enable(t),_r(t)),D.modules.globalConfiguration.state.touchEnabled&&(ar.enable(t),Gr(t)),es(t)},es=function(e){D.state.enabledElements.push(e),D.modules&&function(e){var t=D.modules;Object.keys(t).forEach(function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e)})}(e),function(e){if(!D.modules.globalConfiguration.state.globalToolSyncEnabled)return;Object.keys(D.state.globalTools).forEach(function(t){var n=D.state.globalTools[t],a=n.tool,o=n.configuration;Kr(e,a,o)})}(e),function(e){if(!D.modules.globalConfiguration.state.globalToolSyncEnabled)return;var t={active:G,passive:J,enabled:Z,disabled:X};D.state.globalToolChangeHistory.forEach(function(n){var a=n.args.slice(0);a.unshift(e),t[n.mode].apply(null,a)})}(e)},ts=V("internals:removeEnabledElement"),ns=function(e){ts.log("EVENT:ELEMENT_DISABLED");var t=e.detail.element;vr(t),Dr(t),D.modules.globalConfiguration.state.mouseEnabled&&(Ci.disable(t),Ii.disable(t),Sr(t)),D.modules.globalConfiguration.state.touchEnabled&&(ar.disable(t),Yr(t)),as(t),os(t)},as=function(e){D.state.tools=D.state.tools.filter(function(t){return t.element!==e})},os=function(e){D.modules&&function(e){var t=D.modules;Object.keys(t).forEach(function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e)})}(e);var t=D.state.enabledElements.findIndex(function(t){return t===e});-1<t?D.state.enabledElements.splice(t,1):ts.warn("unable to remove element")},is,rs=function(){window.removeEventListener("resize",ss,!1)};function ss(){is||(is=setTimeout(function(){is=null,ls()},66))}var ls=function(){S.enabledElements.forEach(function(e){p.cornerstone.resize(e)})},cs=function(){rs(),window.addEventListener("resize",ss,!1)},us=function(e){var t;!function(){!function(){var e=p.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(t,Qr),e.events.removeEventListener(n,ns)}();var e=p.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(t,Qr),e.events.addEventListener(n,ns)}(),t=D.modules,Object.keys(t).forEach(function(e){"function"==typeof t[e].onRegisterCallback&&t[e].onRegisterCallback()}),cs(),D.modules.globalConfiguration.state=Object.assign({},D.modules.globalConfiguration.state,e)},ds,hs=V("stackTools:stackPrefetch"),vs="stackPrefetch",gs="prefetch",fs={maxImagesToPrefetch:1/0},ms=10,ps=function(e){return _Mathmax.apply(null,e)},ys=function(e){return _Mathmin.apply(null,e)};function xs(e){var t=ve(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],a=ve(e,vs);if(a){var o=a.data[0]||{};if(o.indicesToRequest&&o.indicesToRequest.length||(o.enabled=!1),!1!==o.enabled)if(a.data[0].indicesToRequest.sort(function(e,t){return e-t}),o.indicesToRequest.slice().forEach(function(e){var t=n.imageIds[e];t&&p.cornerstone.imageCache.getImageLoadObject(t)&&C(e)}),o.indicesToRequest.length){Ao.clearRequestStack(gs);for(var i,r,s,l,c,u,d=(i=o.indicesToRequest,r=n.currentImageIdIndex,s=[],l=[],i.forEach(function(e){e<r?s.push(e):e>r&&l.push(e)}),{low:i.indexOf(ps(s)),high:i.indexOf(ys(l))}),h=Aa.getErrorLoadingHandler(),v=d.low,g=d.high;0<=v||g<o.indicesToRequest.length;){var f=n.currentImageIdIndex,m=f-o.indicesToRequest[v]>fs.maxImagesToPrefetch,y=o.indicesToRequest[g]-f>fs.maxImagesToPrefetch,x=!m&&0<=v,T=!y&&g<o.indicesToRequest.length;if(!T&&!x)break;x&&(u=o.indicesToRequest[v--],c=n.imageIds[u],Ao.addRequest(e,c,gs,!1,b,E)),T&&(u=o.indicesToRequest[g++],c=n.imageIds[u],Ao.addRequest(e,c,gs,!1,b,E))}Ao.startGrabbing()}}}function C(e){var t=o.indicesToRequest.indexOf(e);-1<t&&o.indicesToRequest.splice(t,1)}function b(e){hs.log("prefetch done: %s",e.imageId),C(n.imageIds.indexOf(e.imageId))}function E(t){hs.log("prefetch errored: %o",t),h&&h(e,c,t,"stackPrefetch")}}function Ts(e){return function(t){var n,a=t.detail;try{n=ve(e,"stack")}catch(e){return}if(n&&n.data&&n.data.length){var o=n.data[0].imageIds.indexOf(a.imageId);if(!(0>o)){var i=ve(e,vs);i&&i.data&&i.data.length&&i.data[0].indicesToRequest.push(o)}}}}function Cs(e){clearTimeout(ds),ds=setTimeout(function(){var t=e.target;try{xs(t)}catch(e){return}},ms)}var bs={enable:function(e){ve(e,vs).data=[];var t=ve(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var a={indicesToRequest:function(e,t){e=_Mathround(e)||0;var n=[],a=(t=_Mathround(t)||0)-e+1;if(0>=a)return n;for(;a--;)n[a]=t--;return n}(0,n.imageIds.length-1),enabled:!0,direction:1},o=a.indicesToRequest.indexOf(n.currentImageIdIndex);a.indicesToRequest.splice(o,1),he(e,vs,a),xs(e),e.removeEventListener(p.cornerstone.EVENTS.NEW_IMAGE,Cs),e.addEventListener(p.cornerstone.EVENTS.NEW_IMAGE,Cs);var i=Ts(e);p.cornerstone.events.removeEventListener(p.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,i),p.cornerstone.events.addEventListener(p.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,i)}else hs.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(ds),e.removeEventListener(p.cornerstone.EVENTS.NEW_IMAGE,Cs);var t=Ts(e);p.cornerstone.events.removeEventListener(p.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=ve(e,vs);n&&n.data.length&&(n.data[0].enabled=!1,Ao.clearRequestStack(gs))},getConfiguration:function(){return fs},setConfiguration:function(e){var t;fs=e,e.maxSimultaneousRequests&&(t=e.maxSimultaneousRequests,ro=t)}},Es=function(){function e(){i()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return s()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=ve(e,"stack").data);var a=p.cornerstone,o=t[0],i=o.imageIds[this.currentImageIdIndex],r=t.slice(1,t.length);a.loadAndCacheImage(i).then(function(t){var s=n.layerIds[0];s?a.setLayerImage(e,t,s):(s=a.addLayer(e,t,o.options),n.layerIds.push(s)),a.displayImage(e,t),r.forEach(function(t,o){var r=n.findImageFn(t.imageIds,i),l=o+1,c=n.layerIds[l];c||(c=a.addLayer(e,void 0,t.options),n.layerIds.push(c)),r?a.loadAndCacheImage(r).then(function(t){a.setLayerImage(e,t,c),a.updateImage(e)}):(a.setLayerImage(e,void 0,c),a.setActiveLayer(e,s),a.updateImage(e))})})}}]),e}(),Ms={};Ms.FusionRenderer=Es;var ws=Ms,ks="playClip";function Is(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function _s(e,t){var n,a;if(void 0===e)throw new Error("playClip: element must not be undefined");var o=ve(e,"stack");if(o&&o.data&&o.data.length){var i,r=p.cornerstone;if(1<o.data.length){var s=ve(e,"stackRenderer");s&&s.data&&s.data.length&&(i=s.data[0])}var l=o.data[0],c=ve(e,ks);c&&c.data&&c.data.length?Is(n=c.data[0]):he(e,ks,n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0}),(0>t||0<t)&&(n.framesPerSecond=+t,n.reverse=0>n.framesPerSecond,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===l.imageIds.length&&(a=function(e,t){var n,a,o,i=0,r=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||0>=t)&&(t=1),n=1;n<r;n++)o=0|+e[n]/t,s.push(o),1===n?a=o:o!==a&&(s.isTimeVarying=!0),i+=o;return 0<s.length&&(o=s.isTimeVarying?0|i/s.length:s[0],s.push(o)),s}(n.frameTimeVector,n.speed));var u=function(){var t,a,s,c=l.currentImageIdIndex,u=l.imageIds.length;if(n.reverse?c--:c++,!n.loop&&(0>c||c>=u))return Is(n),void function(e){var t={element:e};C(e,T.CLIP_STOPPED,t)}(e);c>=u&&(c=0),0>c&&(c=u-1),c!==l.currentImageIdIndex&&(t=Aa.getStartLoadHandler(),a=Aa.getEndLoadHandler(),s=Aa.getErrorLoadingHandler(),t&&t(e),(!0===l.preventCache?r.loadImage(l.imageIds[c]):r.loadAndCacheImage(l.imageIds[c])).then(function(t){try{l.currentImageIdIndex=c,i?(i.currentImageIdIndex=c,i.render(e,o.data)):r.displayImage(e,t),a&&a(e,t)}catch(e){return}},function(t){var n=l.imageIds[c];s&&s(e,n,t)}))};a&&0<a.length&&a.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout(function e(){n.intervalId=setTimeout(e,a[l.currentImageIdIndex]),u()},0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(u,1e3/_Mathabs(n.framesPerSecond)))}}function Ss(e){var t=ve(e,ks);t&&t.data&&t.data.length&&Is(t.data[0])}var Ps=function(e,t){var n=D.state.tools.findIndex(function(n){return n.element===e&&n.name===t});0<=n&&D.state.tools.splice(n,1)},Os=function(e){Ds(e),D.state.enabledElements.forEach(function(t){Ps(t,e)})},Ds=function(e){D.modules.globalConfiguration.state.globalToolSyncEnabled&&D.state.globalTools[e]&&delete D.state.globalTools[e]},Ls=function(e,t,n){var a=L(e,t);a&&a.mergeOptions(n)},As=function(e,t){S.enabledElements.forEach(function(e){Ls(e,t)})};function Rs(e,t){var n={};return{get:function(a,o){return 0<=e.indexOf(o)?(!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o]):t.get(a,o)},add:function(a,o,i){if(!(0<=e.indexOf(o)))return t.add(a,o,i);!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o].data.push(i)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var Hs=[];function Us(e,t){var n=de(e);n||(n=ue);var a=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(a=a.concat(t));var o=Rs(a,n);Hs.push(o),me(e,o)}var Ns={newStackSpecificToolStateManager:Rs,addStackStateManager:Us};function Bs(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var a=e[t];if(!1!==a.hasOwnProperty(n))return a[n]}},add:function(t,n,a){!1===e.hasOwnProperty(t)&&(e[t]={});var o=e[t];!1===o.hasOwnProperty(n)&&(o[n]={data:[]}),o[n].data.push(a)},remove:function(t,n,a){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n)){for(var i=o[n],r=-1,s=0;s<i.data.length;s++)i.data[s]===a&&(r=s);-1!==r&&i.data.splice(r,1)}}}}}var Fs=Bs(),Vs={getOrientationString:function(e){for(var t=Ra(e),n="",a=0>t.x?"R":"L",o=0>t.y?"A":"P",i=0>t.z?"F":"H",r=new p.cornerstoneMath.Vector3(_Mathabs(t.x),_Mathabs(t.y),_Mathabs(t.z)),s=0;3>s;s++)if(1e-4<r.x&&r.x>r.y&&r.x>r.z)n+=a,r.x=0;else if(1e-4<r.y&&r.y>r.x&&r.y>r.z)n+=o,r.y=0;else{if(!(1e-4<r.z&&r.z>r.x&&r.z>r.y))break;n+=i,r.z=0}return n},invertOrientationString:function(e){var t=e.replace("H","f");return t=(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},qs=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"image/png",a=e.querySelector("canvas");if(a.msToBlob){var o=a.msToBlob();return window.navigator.msSaveBlob(o,t)}var i=document.createElement("a");if(i.download=t,i.href=a.toDataURL(n,1),document.createEvent){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(r)}else i.fireEvent&&i.fireEvent("onclick")},js=V("thirdParty:registerModule"),zs=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=function(e){return void 0!==O[e]}(e);!a||n?(a&&js.warn("Overwriting module %s",e),O[e]=t):js.warn("A module with the name %s is already registered",e)},Ws=V("thirdParty:registerMixin"),Gs=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=function(e){return void 0!==re[e]}(e);!a||n?(a&&Ws.warn("Overwriting mixins/%s",e),re[e]=t,ui["mixins/".concat(e)]=re[e]):Ws.warn("mixins/%s is already registered",e)},Ys=V("thirdParty:registerType"),Xs=function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o="".concat(e,"/").concat(t),i=function(e){return void 0!==ui[e]}(o);!i||a?(i&&Ys.warn("Overwriting %s",o),ui[o]=n):Ys.warn("%s is already registered",o)},Ks=V("thirdParty:register"),Zs=function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(function(e,t,n){if(!e)return Ks.warn("The type must be given in order to register."),!1;if(!t)return Ks.warn("The %s must have a name in order to register.",e),!1;if("object"!==x()(n)&&"function"!=typeof n)return Ks.warn("The %s is a %s, it should be an Object or a function.",n,x()(n)),!1;return!0}(e,t,n))switch(e){case"module":zs(t,n,a);break;case"mixin":Gs(t,n,a);break;default:Xs(e,t,n,a);}},$s=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e.forEach(function(e){var n=e.type,a=e.name,o=e.item;Zs(n,a,o,t)})},Js=function(e,t,n){if(n!==t){var a=p.cornerstone,o=a.getViewport(t),i=a.getViewport(n);i.voi.windowWidth===o.voi.windowWidth&&i.voi.windowCenter===o.voi.windowCenter&&i.invert===o.invert||(i.voi.windowWidth=o.voi.windowWidth,i.voi.windowCenter=o.voi.windowCenter,i.invert=o.invert,e.setViewport(n,i))}},Qs=function(e,t,n){n!==t&&p.cornerstone.updateImage(n)};function el(e){return e.filter(function(e,t,n){return n.indexOf(e)===t})}var tl=function(e,t){var n=p.cornerstone,a=this,o=[],i=[],r=!1,s={},l=t;function c(e,t){var n=!a.enabled,c=!o.length||!i.length;n||c||(r=!0,i.forEach(function(n){var r=i.indexOf(n);if(-1!==r){var c=s.imageIds.targetElements[r],u=o.indexOf(e);if(-1!==u){var d,h=s.imageIds.sourceElements[u];h===c?d=0:void 0!==s.distances[h]&&(d=s.distances[h][c]),l(a,e,n,t,d)}}}),r=!1)}function u(e){var t=e.detail;!0!==r&&c(e.currentTarget,t)}function d(e){var t=e.detail.element;a.remove(t),function(e){for(var t in Ba)Ba[t]=Ba[t].filter(function(t){return t.element!==e})}(t)}this.enabled=!0,this.setHandler=function(e){l=e},this.getHandler=function(){return l},this.getDistances=function(){o.length&&i.length&&(s.distances={},s.imageIds={sourceElements:[],targetElements:[]},o.forEach(function(e){var t=n.getEnabledElement(e);if(t&&t.image){var a=t.image.imageId,o=n.metaData.get("imagePlaneModule",a);if(o&&o.imagePositionPatient){var r=Ra(o.imagePositionPatient);s.hasOwnProperty(t)||(s.distances[a]={},s.imageIds.sourceElements.push(a),i.forEach(function(t){var o=n.getEnabledElement(t);if(o&&o.image){var i=o.image.imageId;if(s.imageIds.targetElements.push(i),e!==t&&a!==i&&!s.distances[a].hasOwnProperty(i)){var l=n.metaData.get("imagePlaneModule",i);if(l&&l.imagePositionPatient){var c=Ra(l.imagePositionPatient);s.distances[a][i]=c.clone().sub(r)}}}}),Object.keys(s.distances[a]).length||delete s.distances[a])}}}))},this.addSource=function(t){-1===o.indexOf(t)&&(o.push(t),e.split(" ").forEach(function(e){t.addEventListener(e,u)}),a.getDistances(),a.updateDisableHandlers())},this.addTarget=function(e){-1===i.indexOf(e)&&(i.push(e),a.getDistances(),l(a,e,e,0),a.updateDisableHandlers())},this.add=function(e){a.addSource(e),a.addTarget(e)},this.removeSource=function(t){var n=o.indexOf(t);-1!==n&&(o.splice(n,1),e.split(" ").forEach(function(e){t.removeEventListener(e,u)}),a.getDistances(),c(t),a.updateDisableHandlers())},this.removeTarget=function(e){var t=i.indexOf(e);-1!==t&&(i.splice(t,1),a.getDistances(),l(a,e,e,0),a.updateDisableHandlers())},this.remove=function(e){a.removeTarget(e),a.removeSource(e)},this.getSourceElements=function(){return o},this.getTargetElements=function(){return i},this.displayImage=function(e,t,a){r=!0,n.displayImage(e,t,a),r=!1},this.setViewport=function(e,t){r=!0,n.setViewport(e,t),r=!1},this.updateDisableHandlers=function(){el(o.concat(i)).forEach(function(e){e.removeEventListener(p.cornerstone.EVENTS.ELEMENT_DISABLED,d),e.addEventListener(p.cornerstone.EVENTS.ELEMENT_DISABLED,d)})},this.destroy=function(){el(o.concat(i)).forEach(function(e){a.remove(e)})}},nl=function(e,t,n,a){if(t!==n&&a&&a.direction){var o=p.cornerstone,i=ve(n,"stack").data[0],r=i.currentImageIdIndex+a.direction;if(r=be(r,0,i.imageIds.length-1),i.currentImageIdIndex!==r){var s=Aa.getStartLoadHandler(),l=Aa.getEndLoadHandler(),c=Aa.getErrorLoadingHandler();i.currentImageIdIndex=r;var u=i.imageIds[r];s&&s(n),(!0===i.preventCache?o.loadImage(u):o.loadAndCacheImage(u)).then(function(t){var a=o.getViewport(n);i.currentImageIdIndex===r&&(e.displayImage(n,t,a),l&&l(n,t))},function(e){var t=i.imageIds[r];c&&c(n,t,e)})}}},al=function(e,t,n){if(n!==t){var a=p.cornerstone,o=ve(t,"stack").data[0],i=o.imageIds[o.currentImageIdIndex],r=a.metaData.get("imagePlaneModule",i);if(void 0!==r&&void 0!==r.imagePositionPatient){var s=Ra(r.imagePositionPatient),l=ve(n,"stack").data[0],c=_NumberMAX_VALUE,u=-1;if(l.imageIds.forEach(function(e,t){var n=a.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var o=Ra(n.imagePositionPatient).distanceToSquared(s);o<c&&(c=o,u=t)}}),u!==l.currentImageIdIndex){var d=Aa.getStartLoadHandler(),h=Aa.getEndLoadHandler(),v=Aa.getErrorLoadingHandler();l.currentImageIdIndex=u;var g=l.imageIds[u];if(d&&d(n),-1!==u)(!0===l.preventCache?a.loadImage(g):a.loadAndCacheImage(g)).then(function(t){var o=a.getViewport(n);l.currentImageIdIndex===u&&(e.displayImage(n,t,o),h&&h(n,t))},function(e){var t=l.imageIds[u];v&&v(n,t,e)})}}}},ol=function(e,t,n,a,o){if(n!==t){var i=p.cornerstone,r=ve(t,"stack").data[0],s=r.imageIds[r.currentImageIdIndex],l=i.metaData.get("imagePlaneModule",s);if(void 0!==l&&void 0!==l.imagePositionPatient){var c=Ra(l.imagePositionPatient),u=ve(n,"stack").data[0],d=_NumberMAX_VALUE,h=-1;if(o){var v=c.clone().add(o);if(u.imageIds.forEach(function(e,t){var n=i.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var a=Ra(n.imagePositionPatient),o=v.distanceToSquared(a);o<d&&(d=o,h=t)}}),h!==u.currentImageIdIndex&&-1!==h){var g=Aa.getStartLoadHandler(),f=Aa.getEndLoadHandler(),m=Aa.getErrorLoadingHandler();u.currentImageIdIndex=h;var y=u.imageIds[h];g&&g(n),(!0===u.preventCache?i.loadImage(y):i.loadAndCacheImage(y)).then(function(t){var a=i.getViewport(n);u.currentImageIdIndex===h&&(e.displayImage(n,t,a),f&&f(n,t))},function(e){var t=u.imageIds[h];m&&m(n,t,e)})}}}}},il=function(e,t,n){if(n!==t){var a=p.cornerstone,o=ve(t,"stack").data[0],i=ve(n,"stack").data[0],r=o.currentImageIdIndex;if((r=be(r,0,i.imageIds.length-1))!==i.currentImageIdIndex){var s=Aa.getStartLoadHandler(),l=Aa.getEndLoadHandler(),c=Aa.getErrorLoadingHandler();s&&s(n),(!0===i.preventCache?a.loadImage(i.imageIds[r]):a.loadAndCacheImage(i.imageIds[r])).then(function(t){var o=a.getViewport(n);i.currentImageIdIndex=r,e.displayImage(n,t,o),l&&l(n,t)},function(e){var t=i.imageIds[r];c&&c(n,t,e)})}}},rl=function(e,t,n){if(n!==t){var a=p.cornerstone,o=a.getViewport(t),i=a.getViewport(n);i.scale===o.scale&&i.translation.x===o.translation.x&&i.translation.y===o.translation.y||(i.scale=o.scale,i.translation.x=o.translation.x,i.translation.y=o.translation.y,e.setViewport(n,i))}};n.d(t,"AngleTool",function(){return Ft}),n.d(t,"ArrowAnnotateTool",function(){return qt}),n.d(t,"BidirectionalTool",function(){return Cn}),n.d(t,"CobbAngleTool",function(){return bn}),n.d(t,"EllipticalRoiTool",function(){return Ln}),n.d(t,"FreehandMouseTool",function(){return oa}),n.d(t,"LengthTool",function(){return sa}),n.d(t,"ProbeTool",function(){return ua}),n.d(t,"RectangleRoiTool",function(){return ha}),n.d(t,"TextMarkerTool",function(){return pa}),n.d(t,"BrushTool",function(){return Ia}),n.d(t,"CrosshairsTool",function(){return qa}),n.d(t,"DoubleTapFitToWindowTool",function(){return ja}),n.d(t,"DragProbeTool",function(){return za}),n.d(t,"EraserTool",function(){return Ya}),n.d(t,"FreehandSculpterMouseTool",function(){return Ka}),n.d(t,"MagnifyTool",function(){return Za}),n.d(t,"PanMultiTouchTool",function(){return $a}),n.d(t,"PanTool",function(){return Ja}),n.d(t,"ReferenceLinesTool",function(){return lo}),n.d(t,"RotateTool",function(){return uo}),n.d(t,"RotateTouchTool",function(){return fo}),n.d(t,"ScaleOverlayTool",function(){return po}),n.d(t,"StackScrollMouseWheelTool",function(){return No}),n.d(t,"StackScrollMultiTouchTool",function(){return Bo}),n.d(t,"StackScrollTool",function(){return Fo}),n.d(t,"WwwcRegionTool",function(){return qo}),n.d(t,"WwwcTool",function(){return Go}),n.d(t,"ZoomMouseWheelTool",function(){return Zo}),n.d(t,"ZoomTool",function(){return Qo}),n.d(t,"ZoomTouchPinchTool",function(){return ii}),n.d(t,"init",function(){return us}),n.d(t,"stackPrefetch",function(){return bs}),n.d(t,"stackRenderers",function(){return ws}),n.d(t,"playClip",function(){return _s}),n.d(t,"stopClip",function(){return Ss}),n.d(t,"store",function(){return D}),n.d(t,"getToolForElement",function(){return L}),n.d(t,"addTool",function(){return Zr}),n.d(t,"addToolForElement",function(){return Kr}),n.d(t,"removeTool",function(){return Os}),n.d(t,"removeToolForElement",function(){return Ps}),n.d(t,"setToolOptions",function(){return As}),n.d(t,"setToolOptionsForElement",function(){return Ls}),n.d(t,"setToolActive",function(){return Y}),n.d(t,"setToolActiveForElement",function(){return G}),n.d(t,"setToolEnabled",function(){return $}),n.d(t,"setToolEnabledForElement",function(){return Z}),n.d(t,"setToolDisabled",function(){return K}),n.d(t,"setToolDisabledForElement",function(){return X}),n.d(t,"setToolPassive",function(){return Q}),n.d(t,"setToolPassiveForElement",function(){return J}),n.d(t,"addToolState",function(){return he}),n.d(t,"getToolState",function(){return ve}),n.d(t,"removeToolState",function(){return ge}),n.d(t,"clearToolState",function(){return fe}),n.d(t,"setElementToolStateManager",function(){return me}),n.d(t,"getElementToolStateManager",function(){return de}),n.d(t,"textStyle",function(){return ot}),n.d(t,"toolStyle",function(){return Ve}),n.d(t,"toolColors",function(){return We}),n.d(t,"toolCoordinates",function(){return on}),n.d(t,"stackSpecificStateManager",function(){return Ns}),n.d(t,"newStackSpecificToolStateManager",function(){return Rs}),n.d(t,"addStackStateManager",function(){return Us}),n.d(t,"loadHandlerManager",function(){return Aa}),n.d(t,"newImageIdSpecificToolStateManager",function(){return ce}),n.d(t,"globalImageIdSpecificToolStateManager",function(){return ue}),n.d(t,"newFrameOfReferenceSpecificToolStateManager",function(){return Bs}),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",function(){return Fs}),n.d(t,"forceEnabledElementResize",function(){return ls}),n.d(t,"orientation",function(){return Vs}),n.d(t,"SaveAs",function(){return qs}),n.d(t,"enableLogger",function(){return q}),n.d(t,"disableLogger",function(){return j}),n.d(t,"register",function(){return Zs}),n.d(t,"registerSome",function(){return $s}),n.d(t,"wwwcSynchronizer",function(){return Js}),n.d(t,"updateImageSynchronizer",function(){return Qs}),n.d(t,"Synchronizer",function(){return tl}),n.d(t,"stackScrollSynchronizer",function(){return nl}),n.d(t,"stackImagePositionSynchronizer",function(){return al}),n.d(t,"stackImagePositionOffsetSynchronizer",function(){return ol}),n.d(t,"stackImageIndexSynchronizer",function(){return il}),n.d(t,"panZoomSynchronizer",function(){return rl}),n.d(t,"requestPoolManager",function(){return Ao}),n.d(t,"external",function(){return p}),n.d(t,"EVENTS",function(){return T}),n.d(t,"version",function(){return"3.7.0"}),n.d(t,"import",function(){return di});var sl={AngleTool:Ft,ArrowAnnotateTool:qt,BidirectionalTool:Cn,CobbAngleTool:bn,EllipticalRoiTool:Ln,FreehandMouseTool:oa,LengthTool:sa,ProbeTool:ua,RectangleRoiTool:ha,TextMarkerTool:pa,BrushTool:Ia,CrosshairsTool:qa,DoubleTapFitToWindowTool:ja,DragProbeTool:za,EraserTool:Ya,FreehandSculpterMouseTool:Ka,MagnifyTool:Za,PanMultiTouchTool:$a,PanTool:Ja,ReferenceLinesTool:lo,RotateTool:uo,RotateTouchTool:fo,ScaleOverlayTool:po,StackScrollMouseWheelTool:No,StackScrollMultiTouchTool:Bo,StackScrollTool:Fo,WwwcRegionTool:qo,WwwcTool:Go,ZoomMouseWheelTool:Zo,ZoomTool:Qo,ZoomTouchPinchTool:ii,init:us,stackPrefetch:bs,stackRenderers:ws,playClip:_s,stopClip:Ss,store:D,getToolForElement:L,addTool:Zr,addToolForElement:Kr,removeTool:Os,removeToolForElement:Ps,setToolOptions:As,setToolOptionsForElement:Ls,setToolActive:Y,setToolActiveForElement:G,setToolEnabled:$,setToolEnabledForElement:Z,setToolDisabled:K,setToolDisabledForElement:X,setToolPassive:Q,setToolPassiveForElement:J,addToolState:he,getToolState:ve,removeToolState:ge,clearToolState:fe,setElementToolStateManager:me,getElementToolStateManager:de,textStyle:ot,toolStyle:Ve,toolColors:We,toolCoordinates:on,stackSpecificStateManager:Ns,newStackSpecificToolStateManager:Rs,addStackStateManager:Us,loadHandlerManager:Aa,newImageIdSpecificToolStateManager:ce,globalImageIdSpecificToolStateManager:ue,newFrameOfReferenceSpecificToolStateManager:Bs,globalFrameOfReferenceSpecificToolStateManager:Fs,forceEnabledElementResize:ls,orientation:Vs,SaveAs:qs,enableLogger:q,disableLogger:j,import:di,register:Zs,registerSome:$s,wwwcSynchronizer:Js,updateImageSynchronizer:Qs,Synchronizer:tl,stackScrollSynchronizer:nl,stackImagePositionSynchronizer:al,stackImagePositionOffsetSynchronizer:ol,stackImageIndexSynchronizer:il,panZoomSynchronizer:rl,requestPoolManager:Ao,external:p,EVENTS:T,version:"3.7.0"};t.default=sl},function(e,t){!function(t){"use strict";var n,a=Object.prototype,o=a.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=T;var d="suspendedStart",h="suspendedYield",v="executing",g="completed",f={},m={};m[r]=function(){return this};var p=Object.getPrototypeOf,y=p&&p(p(O([])));y&&y!==a&&o.call(y,r)&&(m=y);var x=M.prototype=b.prototype=Object.create(m);E.prototype=x.constructor=M,M.constructor=E,M[l]=E.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,M):(e.__proto__=M,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(x),e},u.awrap=function(e){return{__await:e}},w(k.prototype),k.prototype[s]=function(){return this},u.AsyncIterator=k,u.async=function(e,t,n,a){var o=new k(T(e,t,n,a));return u.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},w(x),x[l]="Generator",x[r]=function(){return this},x.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},u.values=O,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(a,o){return s.type="throw",s.arg=e,t.next=a,o&&(t.method="next",t.arg=n),!!o}for(var i=this.tryEntries.length-1;0<=i;--i){var r=this.tryEntries[i],s=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var l=o.call(r,"catchLoc"),c=o.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1,a;0<=n;--n){a=this.tryEntries[n];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1,n;0<=t;--t){n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),f}},catch:function(e){for(var t=this.tryEntries.length-1,n;0<=t;--t){n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var o=a.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:O(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=n),f}}}function T(e,t,n,a){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),r=new P(a||[]);return i._invoke=function(e,t,n){var a=d;return function(o,i){if(a===v)throw new Error("Generator is already running");if(a===g){if("throw"===o)throw i;return D()}for(n.method=o,n.arg=i;;){var r=n.delegate;if(r){var s=I(r,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=v;var l=C(e,t,n);if("normal"===l.type){if(a=n.done?g:h,l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(a=g,n.method="throw",n.arg=l.arg)}}}(e,n,r),i}function C(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function b(){}function E(){}function M(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function k(e){var t;this._invoke=function(n,a){function i(){return new Promise(function(t,i){!function t(n,a,i,r){var s=C(e[n],e,a);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,i,r)},function(e){t("throw",e,i,r)}):Promise.resolve(c).then(function(e){l.value=e,i(l)},function(e){return t("throw",e,i,r)})}r(s.arg)}(n,a,t,i)})}return t=t?t.then(i,i):i()}}function I(e,t){var a=e.iterator[t.method];if(a===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,I(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var o=C(a,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(o.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}return{next:D}}function D(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){var a=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=a.regeneratorRuntime&&0<=Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime"),i=o&&a.regeneratorRuntime;if(a.regeneratorRuntime=void 0,e.exports=n(12),o)a.regeneratorRuntime=i;else try{delete a.regeneratorRuntime}catch(e){a.regeneratorRuntime=void 0}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){var n=1e3,a=60*n,o=60*a,i=24*o,r=7*i,s=365.25*i;function l(e,t,n,a){var o=t>=1.5*n;return _Mathround(e/n)+" "+a+(o?"s":"")}e.exports=function(e,t){t=t||{};var c=typeof e;if("string"===c&&0<e.length)return function(e){if(100<(e=e+"").length)return;var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var l=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*r;case"days":case"day":case"d":return l*i;case"hours":case"hour":case"hrs":case"hr":case"h":return l*o;case"minutes":case"minute":case"mins":case"min":case"m":return l*a;case"seconds":case"second":case"secs":case"sec":case"s":return l*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return;}}(e);if("number"===c&&!1===isNaN(e))return t.long?function(e){var t=_Mathabs(e);if(t>=i)return l(e,t,i,"day");if(t>=o)return l(e,t,o,"hour");if(t>=a)return l(e,t,a,"minute");if(t>=n)return l(e,t,n,"second");return e+" ms"}(e):function(e){var t=_Mathabs(e);if(t>=i)return _Mathround(e/i)+"d";if(t>=o)return _Mathround(e/o)+"h";if(t>=a)return _Mathround(e/a)+"m";if(t>=n)return _Mathround(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){e.exports=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return a.colors[_Mathabs(t)%a.colors.length]}function a(e){let n;function r(...e){if(!r.enabled)return;const t=r,o=+new Date,i=o-(n||o);t.diff=i,t.prev=n,t.curr=o,n=o,e[0]=a.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,o)=>{if("%%"===n)return n;s++;const i=a.formatters[o];if("function"==typeof i){const a=e[s];n=i.call(t,a),e.splice(s,1),s--}return n}),a.formatArgs.call(t,e),(t.log||a.log).apply(t,e)}return r.namespace=e,r.enabled=a.enabled(e),r.useColors=a.useColors(),r.color=t(e),r.destroy=o,r.extend=i,"function"==typeof a.init&&a.init(r),a.instances.push(r),r}function o(){const e=a.instances.indexOf(this);return-1!==e&&(a.instances.splice(e,1),!0)}function i(e,t){const n=a(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return a.debug=a,a.default=a,a.coerce=function(e){return e instanceof Error?e.stack||e.message:e},a.disable=function(){const e=[...a.names.map(r),...a.skips.map(r).map(e=>"-"+e)].join(",");return a.enable(""),e},a.enable=function(e){let t;a.save(e),a.names=[],a.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(t=0;t<o;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^"+e.substr(1)+"$")):a.names.push(new RegExp("^"+e+"$")));for(t=0;t<a.instances.length;t++){const e=a.instances[t];e.enabled=a.enabled(e.namespace)}},a.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=a.skips.length;t<n;t++)if(a.skips[t].test(e))return!1;for(t=0,n=a.names.length;t<n;t++)if(a.names[t].test(e))return!0;return!1},a.humanize=n(17),Object.keys(e).forEach(t=>{a[t]=e[t]}),a.instances=[],a.names=[],a.skips=[],a.formatters={},a.selectColor=t,a.enable(a.load()),a}},function(e,t){var n,a,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{a="function"==typeof clearTimeout?clearTimeout:r}catch(e){a=r}}();var l,c=[],u=!1,d=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&v())}function v(){if(!u){var e=s(h);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===r||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new g(e,t)),1!==c.length||u||s(v)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=f,o.addListener=f,o.once=f,o.off=f,o.removeListener=f,o.removeAllListeners=f,o.emit=f,o.prependListener=f,o.prependOnceListener=f,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){function n(t,a){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,a)}e.exports=n}])});